---
title: "Measuring Underemployment - Hours"
subtitle: 'Trends from 2006 to 2022'
author: "The Underemployment Project"
date: '`r Sys.Date()`'

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
	warning = FALSE,
  embed_fonts = TRUE,
  fig.align = "center",
  fig_caption= TRUE,
  use_bookdown= TRUE,
  toc= FALSE,
  toc_depth= 3
)
```

```{r libraries, include=FALSE}

#### packages needed
if(!require(tidyverse)) install.packages("tidyverse", repos = "http://cran.us.r-project.org")
if(!require(gridExtra)) install.packages("girdExtra", repos = "http://cran.us.r-project.org")
if(!require(Hmisc)) install.packages("Hmisc", repos = "http://cran.us.r-project.org")
if(!require(sjlabelled)) install.packages("sjlabelled", repos = "http://cran.us.r-project.org")
if(!require(ggthemes)) install.packages("ggthemes", repos = "http://cran.us.r-project.org")
if(!require(ggtext)) install.packages("ggtext", repos = "http://cran.us.r-project.org")
if(!require(ggrepel)) install.packages("ggrepel", repos = "http://cran.us.r-project.org")
if(!require(doBy)) install.packages("doBy", repos = "http://cran.us.r-project.org")
if(!require(sjmisc)) install.packages("sjmisc", repos = "http://cran.us.r-project.org")
if(!require(plotly)) install.packages("plotly", repos = "http://cran.us.r-project.org")
if(!require(flextable)) install.packages("flextable", repos = "http://cran.us.r-project.org")
if(!require(scales)) install.packages("scales", repos = "http://cran.us.r-project.org")
if(!require(ggalt)) install.packages("ggalt", repos = "http://cran.us.r-project.org")
if(!require(janitor)) install.packages("janitor", repos = "http://cran.us.r-project.org")
if(!require(bookdown)) install.packages("bookdown", repos = "http://cran.us.r-project.org")
if(!require(rmdformats)) install.packages("rmdformats", repos = "http://cran.us.r-project.org")
if(!require(htmlwidgets)) install.packages("htmlwidgets", repos = "http://cran.us.r-project.org")
if(!require(widgetframe)) install.packages("widgetframe", repos = "http://cran.us.r-project.org")
if(!require(officer)) install.packages("officer", repos = "http://cran.us.r-project.org")
if(!require(showtext)) install.packages("showtext", repos = "http://cran.us.r-project.org")
if(!require(colorspace)) install.packages("colorspace", repos = "http://cran.us.r-project.org")
if(!require(patchwork)) install.packages("patchwork", repos = "http://cran.us.r-project.org")
if(!require(ggpubr)) install.packages("ggpubr", repos = "http://cran.us.r-project.org")

library(ggalt) # contingency table
library(tidyverse) # several tools for data manipulation
library(haven) # read SPSS, Stata, and SAS data
library(gridExtra) # arrange multiple grid-based plots on a page
library(Hmisc) # many functions useful for data analysis
library(sjmisc) # useful to set Na's
library(sjlabelled) # get_labels function
library(ggthemes) # themes for ggplot2
library(ggtext) # fancy text
library(ggrepel) # help with the position of the labels on ggplot2 graph
library(doBy) # 'do' something to data stratified 'by' some variables
library(plotly) # interactive plots
library(flextable) # formatting tables 
library(scales) # add scale symbols and colour to axis
library(janitor) # add totals to tables
library(rmdformats)
library(htmlwidgets)
library(widgetframe)
library(colorspace) # colour blind friendly pallettes 
library(officer) # to add additional formatting to tables 
library(patchwork) # to put graphs side by side
library(ggpubr)
library(showtext)
  font_add_google("Lato")
  showtext_auto()


```

```{r load data, include=FALSE}

load("../data/LFS_clean.rda")

```



# Background

This report aims at mapping underemployment trends for employees and self-employed workers in the UK. We use the UKâ€™s largest study on employment circumstances, the Labour Force Survey (LFS), drawing on analysis from the 2006 to 2022 releases (calendar quarters). Our analyses consider only those in employment  between 18 and 64 years old.


```{r sample, echo=FALSE}

N_total <- LFS_clean %>% 
  group_by(as_factor(year), 
           as_label(quarter)) %>%
  summarise(Population = sum(na.omit(PWT[AGE >= 18 & AGE <= 64])), # everyone between 18 to 64
            Active = sum(PWT[ILODEFR <=2 & AGE >= 18 & AGE <= 64]), # in employment and unemployed between 18 to 64
            Workers = sum(PWT[ILODEFR == 1 & INECAC05 <= 2 & AGE >= 18 & AGE <= 64])) %>% # employee and self-employees between 18 to 64
  rename(Year = `as_factor(year)`,
         Quarter = `as_label(quarter)`) # Total population estimates
  

```


# Indicator 1: Involuntary part-time

## Overall trends

```{r involuntary part time table, echo=FALSE}

options(digits = 3)

t_ptime <- LFS_clean %>% # summary table
  filter(AGE >= 18 & AGE <= 64) %>% 
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c(1, 2)) %>% #only employees and self-employed
  filter(FTPTWK == 2) %>% # only part-timers
  group_by(year, sequence, quarter, SEX, YPTJOB) %>% 
  summarise(count = sum(PWT)) %>% 
  group_by(year, sequence, quarter, SEX) %>% 
  # percentage part-time per quarter
  mutate(percentage = count/sum(count)) %>% 
  filter(!is.na(YPTJOB)) %>%  # omit no answers and no apply
  filter(YPTJOB == 3) %>% # could not find full time only
  as_label(.)


```


```{r plot involuntary part time, fig.width=9, fig.height=6, fig.fullwidth=TRUE, fig.cap= " Part-time workers who could not find a full-time job"}

p_ptime <- t_ptime %>% 
  ggplot() + 
  geom_line(aes(x = sequence, y = percentage, colour = factor(SEX)), size = 0.5, show.legend = FALSE) +  
  geom_point(aes(x = sequence, y = percentage, colour = factor(SEX)), shape = 15, show.legend = TRUE) +
  geom_vline(xintercept = 4.5, color = "#c9c9c9") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "#c9c9c9") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "#c9c9c9") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "#c9c9c9") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "#c9c9c9") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "#c9c9c9") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "#c9c9c9") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "#c9c9c9") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "#c9c9c9") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "#c9c9c9") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "#c9c9c9") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "#c9c9c9") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "#c9c9c9") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "#c9c9c9") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "#c9c9c9") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "#c9c9c9") + # gridline 2021

  # scale and colour
  scale_color_discrete_qualitative(palette = "Dark 3") +
  scale_y_continuous(breaks = seq(0,0.50, 0.05), limits = c(0, 0.50), labels =
                       scales::percent_format(accuracy = 1L), expand = c(0,0), sec.axis = dup_axis()) +
  scale_x_continuous(breaks=c(1:68), position = "top",
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
  # annotation
  labs(x = "", 
       y = "Percentage", 
       title ="Part-time workers who could not find a full-time job",
       subtitle  = "",
       caption = c("Note: Could not find a full-time job as a percentage of all part-time workers")
       ) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0, 0), "lines"),
        plot.title = element_text(size = 14, margin = ggplot2::margin(5, 0, 0, 0)),
        plot.subtitle = element_text(size = 12, hjust = 0, margin = ggplot2::margin(5, 0, 15, 0)),
        plot.caption = element_text(size = 10, hjust = 1, margin = ggplot2::margin(2, 0, 2, 0)),
        axis.title.x = element_text(margin = ggplot2::margin(t = 8), size = 12),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 12),
        axis.text.x = element_text(size = 12, margin = margin(t = 2)),
        axis.text.y = element_text(size = 12),
        axis.text.y.right =  element_text(margin = margin(l = 4)),
        axis.title.y.right = element_blank(),
        axis.ticks.length.x = unit(0.1, "cm"), 
        legend.position = "top", 
        legend.title = element_blank(),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(color = "gray90", linewidth = .5)) +
  guides(col = guide_legend(nrow = 1, byrow = TRUE, override.aes = list(size = 5)))


p_ptime_total <- t_ptime %>% 
  ggplot() + 
  geom_bar(aes(x = sequence, y = count, fill = factor(SEX)), stat="identity", position = "dodge", width=0.9) +  
  geom_vline(xintercept = 4.5, color = "#c9c9c9") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "#c9c9c9") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "#c9c9c9") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "#c9c9c9") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "#c9c9c9") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "#c9c9c9") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "#c9c9c9") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "#c9c9c9") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "#c9c9c9") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "#c9c9c9") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "#c9c9c9") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "#c9c9c9") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "#c9c9c9") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "#c9c9c9") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "#c9c9c9") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "#c9c9c9") + # gridline 2021

  # scale and colour
  scale_fill_discrete_qualitative(palette = "Dark 3") +
  scale_y_continuous(breaks = seq(0,2000000, 200000), limits = c(0, 2000000), labels = comma, expand = c(0,0), sec.axis = dup_axis()) +
  scale_x_continuous(breaks=c(1:68),
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
  # annotation
  labs(x = "Year", 
       y = "Total", 
       title ="",
       #subtitle  = "Totals based on people in employment between 2006 and 2022",
       #caption = c("Note: People in employment (employees and self-employed) between 2006 and 2022")
       ) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0, 0), "lines"),
        plot.title = element_text(size = 14, margin = ggplot2::margin(5, 0, 0, 0)),
        plot.subtitle = element_text(size = 12, hjust = 0, margin = ggplot2::margin(5, 0, 2, 0)),
        plot.caption = element_text(size = 10, hjust = 1, margin = ggplot2::margin(2, 0, 2, 0)),
        axis.title.x = element_text(margin = ggplot2::margin(t = 8), size = 12),
        axis.title.y = element_text(margin = ggplot2::margin(r = 2), size = 12),
        axis.text.x = element_text(size = 12, margin = margin(t = 2)),
        axis.text.y = element_text(size = 12),
        axis.ticks.length.x = unit(0.1, "cm"), 
        axis.text.y.right =  element_text(margin = margin(l = 4)),
        axis.title.y.right = element_blank(),
        legend.position = "none", 
        legend.title = element_blank(),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(color = "gray90", linewidth = .5)) +
  guides(col = guide_legend(nrow = 1, byrow = TRUE, override.aes = list(size = 5)))


p_ptime / p_ptime_total



```


### Trends by occupational category


```{r involuntary part time table NSEC, echo=FALSE}

options(digits = 3)

t_ptime_nsec <- LFS_clean %>% # summary table
  filter(AGE >= 18 & AGE <= 64) %>% 
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c(1, 2)) %>% #only employees and self-employed
  filter(FTPTWK == 2) %>% # only part-timers
  group_by(year, sequence, quarter, NSEC2, YPTJOB) %>% 
  summarise(count = sum(PWT)) %>% 
  group_by(year, sequence, quarter, NSEC2) %>% 
  # percentage part-time per quarter
  mutate(percentage = count/sum(count)) %>% 
  filter(!is.na(NSEC2) & !NSEC2 == 6) %>%  # omit no answers and no apply
  filter(YPTJOB == 3) %>% # could not find  
  as_label(.)


```


```{r plot involuntary part time nsec, fig.width=9, fig.height=3.5, fig.fullwidth=TRUE, fig.cap= ""}

p_ptime_nsec <- t_ptime_nsec %>% 
  ggplot() + 
  geom_line(aes(x = sequence, y = percentage, colour = factor(NSEC2)), size = 0.5, show.legend = FALSE) +  
  geom_point(aes(x = sequence, y = percentage, colour = factor(NSEC2)), size = 0.5, shape = 15, show.legend = TRUE) +
  geom_vline(xintercept = 4.5, color = "#c9c9c9") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "#c9c9c9") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "#c9c9c9") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "#c9c9c9") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "#c9c9c9") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "#c9c9c9") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "#c9c9c9") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "#c9c9c9") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "#c9c9c9") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "#c9c9c9") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "#c9c9c9") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "#c9c9c9") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "#c9c9c9") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "#c9c9c9") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "#c9c9c9") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "#c9c9c9") + # gridline 2021

  # scale and colour
  scale_color_discrete_qualitative(palette = "Dynamic") +
  scale_y_continuous(breaks = seq(0,0.50, 0.05), limits = c(0, 0.50), labels =
                       scales::percent_format(accuracy = 1L), expand = c(0,0), sec.axis = dup_axis()) +
  scale_x_continuous(breaks=c(1:68), position = "top",
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
  # annotation
  labs(x = "", 
       y = "Percentage", 
       title ="Part-time workers who could not find a full-time job by occupational category",
       subtitle  = "",
       caption = c("Note: Could not find a full-time job as a percentage of part-time workers in the category")
       ) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0.2, 0), "lines"),
        plot.title = element_text(size = 14, margin = ggplot2::margin(5, 0, 0, 0)),
        plot.subtitle = element_text(size = 12, hjust = 0, margin = ggplot2::margin(5, 0, 15, 0)),
        plot.caption = element_text(size = 10, hjust = 1, margin = ggplot2::margin(2, 0, 2, 0)),
        axis.title.x = element_text(margin = ggplot2::margin(t = 8), size = 12),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 12),
        axis.text.x = element_text(size = 12, margin = margin(t = 2)),
        axis.text.y = element_text(size = 12),
        axis.text.y.right =  element_text(margin = margin(l = 4)),
        axis.title.y.right = element_blank(),
        axis.ticks.length.x = unit(0.1, "cm"), 
        legend.position = "top", 
        legend.title = element_blank(),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(color = "gray90", linewidth = .5)) +
  guides(col = guide_legend(nrow = 1, byrow = TRUE, override.aes = list(size = 5)))



p_ptime_nsec


```


### Trends by education level


```{r involuntary part time table education, echo=FALSE}

options(digits = 3)

t_ptime_quali <- LFS_clean %>% # summary table
  filter(AGE >= 18 & AGE <= 64) %>% 
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c(1, 2)) %>% #only employees and self-employed
  filter(FTPTWK == 2) %>% # only part-timers
  group_by(year, sequence, quarter, quali, YPTJOB) %>% 
  summarise(count = sum(PWT)) %>% 
  group_by(year, sequence, quarter, quali) %>% 
  # percentage part-time per quarter
  mutate(percentage = count/sum(count)) %>% 
  filter(YPTJOB %in% c("3") & !is.na(quali) & !quali %in% c("7")) %>% # could not find
  filter(YPTJOB == 3) %>% # could not find  
  as_label(.)


```


```{r plot involuntary part time , fig.width=9, fig.height=3.5, fig.fullwidth=TRUE, fig.cap= ""}

p_ptime_nsec <- t_ptime_quali %>% 
  ggplot() + 
  geom_line(aes(x = sequence, y = percentage, colour = factor(quali)), size = 0.5, show.legend = FALSE) +  
  geom_point(aes(x = sequence, y = percentage, colour = factor(quali)), size = 0.5, shape = 15, show.legend = TRUE) +
  geom_vline(xintercept = 4.5, color = "#c9c9c9") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "#c9c9c9") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "#c9c9c9") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "#c9c9c9") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "#c9c9c9") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "#c9c9c9") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "#c9c9c9") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "#c9c9c9") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "#c9c9c9") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "#c9c9c9") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "#c9c9c9") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "#c9c9c9") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "#c9c9c9") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "#c9c9c9") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "#c9c9c9") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "#c9c9c9") + # gridline 2021

  # scale and colour
  scale_color_discrete_qualitative(palette = "Dynamic") +
  scale_y_continuous(breaks = seq(0,0.50, 0.05), limits = c(0, 0.50), labels =
                       scales::percent_format(accuracy = 1L), expand = c(0,0), sec.axis = dup_axis()) +
  scale_x_continuous(breaks=c(1:68), position = "top",
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
  # annotation
  labs(x = "", 
       y = "Percentage", 
       title ="Part-time workers who could not find a full-time job by occupational category",
       subtitle  = "",
       caption = c("Note: Could not find a full-time job as a percentage of part-time workers in the category")
       ) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0.2, 0), "lines"),
        plot.title = element_text(size = 14, margin = ggplot2::margin(5, 0, 0, 0)),
        plot.subtitle = element_text(size = 12, hjust = 0, margin = ggplot2::margin(5, 0, 15, 0)),
        plot.caption = element_text(size = 10, hjust = 1, margin = ggplot2::margin(2, 0, 2, 0)),
        axis.title.x = element_text(margin = ggplot2::margin(t = 8), size = 12),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 12),
        axis.text.x = element_text(size = 12, margin = margin(t = 2)),
        axis.text.y = element_text(size = 12),
        axis.text.y.right =  element_text(margin = margin(l = 4)),
        axis.title.y.right = element_blank(),
        axis.ticks.length.x = unit(0.1, "cm"), 
        legend.position = "top", 
        legend.title = element_blank(),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(color = "gray90", linewidth = .5)) +
  guides(col = guide_legend(nrow = 1, byrow = TRUE, override.aes = list(size = 5)))



p_ptime_nsec


```


# Indicator 2: Workers wo would like to work longer hours


## Overall trends

```{r under gender table, echo=FALSE}

options(digits = 3)

# Would like to work longer hours, at current basic rate of pay, given the opportunity

t_undemp <- LFS_clean %>% # summary table
  filter(AGE >= 18 & AGE <= 64) %>% 
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c(1, 2)) %>% #only employees and self-employed
  filter(DIFJOB == 2) %>% # Applies to all respondents who are not looking for a different or additional job
  group_by(year, sequence, quarter, SEX, UNDEMP) %>% 
  summarise(count = sum(PWT)) %>% 
  group_by(year, sequence, quarter, SEX) %>% 
  # percentage part-time per quarter
  mutate(percentage = count/sum(count)) %>% 
  filter(!is.na(UNDEMP)) %>% # remove NAs. Only responses to the question
  filter(UNDEMP == 1) %>% # only those wating to work additional hours
  as_label(.)


```



```{r index 1, fig.width= 9, fig.height=6, fig.fullwidth=TRUE, fig.cap= "Would like to work longer hours, at current basic rate of pay, given the opportunity"}

p_undemp_rate <- t_undemp %>% 
  ggplot() + 
  geom_line(aes(x = sequence, y = percentage, colour = factor(SEX)), size = 0.5, show.legend = FALSE) +  
  geom_point(aes(x = sequence, y = percentage, colour = factor(SEX)), shape = 15, show.legend = TRUE) +
  geom_vline(xintercept = 4.5, color = "#c9c9c9") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "#c9c9c9") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "#c9c9c9") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "#c9c9c9") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "#c9c9c9") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "#c9c9c9") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "#c9c9c9") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "#c9c9c9") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "#c9c9c9") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "#c9c9c9") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "#c9c9c9") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "#c9c9c9") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "#c9c9c9") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "#c9c9c9") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "#c9c9c9") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "#c9c9c9") + # gridline 2021

  # scale and colour
  scale_color_discrete_qualitative(palette = "Dark 3") +
  scale_y_continuous(breaks = seq(0,0.20, 0.02), limits = c(0, 0.20), labels =
                       scales::percent_format(accuracy = 1L), expand = c(0,0), sec.axis = dup_axis()) +
  scale_x_continuous(breaks=c(1:68), position = "top",
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
  # annotation
  labs(x = "", 
       y = "Percentage", 
       title ="Wants to work more hours in current job",
       subtitle  = " ",
       caption = c("")
       ) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0, 0), "lines"),
        plot.title = element_text(size = 14, margin = ggplot2::margin(5, 0, 0, 0)),
        plot.subtitle = element_text(size = 12, hjust = 0, margin = ggplot2::margin(5, 0, 2, 0)),
        plot.caption = element_text(size = 10, hjust = 1, margin = ggplot2::margin(2, 0, 2, 0)),
        axis.title.x = element_text(margin = ggplot2::margin(t = 8), size = 12),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 12),
        axis.text.x = element_text(size = 12, margin = margin(t = 2)),
        axis.text.y = element_text(size = 12),
        axis.text.y.right =  element_text(margin = margin(l = 4)),
        axis.title.y.right = element_blank(),
        axis.ticks.length.x = unit(0.1, "cm"), 
        legend.position = "top", 
        legend.title = element_blank(),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(color = "gray90", linewidth = .5)) +
  guides(col = guide_legend(nrow = 1, byrow = TRUE, override.aes = list(size = 5)))


p_undemp_total <- t_undemp %>% 
  ggplot() + 
  geom_bar(aes(x = sequence, y = count, fill = factor(SEX)), stat="identity", position = "dodge", width=0.8) +  
  geom_vline(xintercept = 4.5, color = "#c9c9c9") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "#c9c9c9") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "#c9c9c9") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "#c9c9c9") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "#c9c9c9") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "#c9c9c9") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "#c9c9c9") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "#c9c9c9") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "#c9c9c9") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "#c9c9c9") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "#c9c9c9") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "#c9c9c9") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "#c9c9c9") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "#c9c9c9") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "#c9c9c9") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "#c9c9c9") + # gridline 2021

  # scale and colour
  scale_fill_discrete_qualitative(palette = "Dark 3") +
  scale_y_continuous(breaks = seq(0,2000000, 200000), limits = c(0, 2000000), labels = comma, expand = c(0,0), sec.axis = dup_axis()) +
  scale_x_continuous(breaks=c(1:68),
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
  # annotation
  labs(x = "Year", 
       y = "Total", 
       title ="",
       #subtitle  = "",
       #caption = c("Note: Only workers who are not looking for a different or additional job")
       ) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0, 0), "lines"),
        plot.title = element_text(size = 14, margin = ggplot2::margin(5, 0, 0, 0)),
        plot.subtitle = element_text(size = 12, hjust = 0, margin = ggplot2::margin(5, 0, 2, 0)),
        plot.caption = element_text(size = 10, hjust = 1, margin = ggplot2::margin(2, 0, 2, 0)),
        axis.title.x = element_text(margin = ggplot2::margin(t = 8), size = 12),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 12),
        axis.text.x = element_text(size = 12, margin = margin(t = 2)),
        axis.text.y = element_text(size = 12),
        axis.text.y.right =  element_text(margin = margin(l = 4)),
        axis.title.y.right = element_blank(),
        axis.ticks.length.x = unit(0.1, "cm"), 
        legend.position = "none", 
        legend.title = element_blank(),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(color = "gray90", linewidth = .5)) +
  guides(col = guide_legend(nrow = 1, byrow = TRUE, override.aes = list(size = 5)))


p_undemp_rate / p_undemp_total



```


## Trends by occupational category


```{r extra hours table by nsec, echo=FALSE}

options(digits = 3)

# Would like to work longer hours, at current basic rate of pay, given the opportunity

t_undemp_nsec <- LFS_clean %>% # summary table
  filter(AGE >= 18 & AGE <= 64) %>% 
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c(1, 2)) %>% #only employees and self-employed
  filter(DIFJOB == 2) %>% # Applies to all respondents who are not looking for a different or additional job
  group_by(year, sequence, quarter, NSEC2, UNDEMP) %>% 
  summarise(count = sum(PWT)) %>% 
  group_by(year, sequence, quarter, NSEC2) %>% 
  # percentage part-time per quarter
  mutate(percentage = count/sum(count)) %>% 
  filter(!is.na(UNDEMP)) %>% # remove NAs. Only responses to the question
  filter(!is.na(NSEC2) & !NSEC2 == 6) %>%  # omit no answers and no apply
  filter(UNDEMP == 1) %>% # only those wating to work additional hours
  as_label(.)

```



```{r plot involuntary part time nsec, fig.width=9, fig.height=3.5, fig.fullwidth=TRUE, fig.cap= ""}

p_undemp_nsec <- t_undemp_nsec %>% 
  ggplot() + 
  geom_line(aes(x = sequence, y = percentage, colour = factor(NSEC2)), size = 0.5, show.legend = FALSE) +  
  geom_point(aes(x = sequence, y = percentage, colour = factor(NSEC2)), size = 0.5, shape = 15, show.legend = TRUE) +
  geom_vline(xintercept = 4.5, color = "#c9c9c9") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "#c9c9c9") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "#c9c9c9") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "#c9c9c9") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "#c9c9c9") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "#c9c9c9") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "#c9c9c9") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "#c9c9c9") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "#c9c9c9") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "#c9c9c9") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "#c9c9c9") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "#c9c9c9") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "#c9c9c9") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "#c9c9c9") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "#c9c9c9") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "#c9c9c9") + # gridline 2021

  # scale and colour
  scale_color_discrete_qualitative(palette = "Dynamic") +
  scale_y_continuous(breaks = seq(0,0.50, 0.05), limits = c(0, 0.50), labels =
                       scales::percent_format(accuracy = 1L), expand = c(0,0), sec.axis = dup_axis()) +
  scale_x_continuous(breaks=c(1:68), position = "top",
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
  # annotation
  labs(x = "", 
       y = "Percentage", 
       title ="Wants to work more hours in current job by occupational category",
       subtitle  = "",
       caption = c("")
       ) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0, 0), "lines"),
        plot.title = element_text(size = 14, margin = ggplot2::margin(5, 0, 0, 0)),
        plot.subtitle = element_text(size = 12, hjust = 0, margin = ggplot2::margin(5, 0, 15, 0)),
        plot.caption = element_text(size = 10, hjust = 1, margin = ggplot2::margin(2, 0, 2, 0)),
        axis.title.x = element_text(margin = ggplot2::margin(t = 8), size = 12),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 12),
        axis.text.x = element_text(size = 12, margin = margin(t = 2)),
        axis.text.y = element_text(size = 12),
        axis.text.y.right =  element_text(margin = margin(l = 4)),
        axis.title.y.right = element_blank(),
        axis.ticks.length.x = unit(0.1, "cm"), 
        legend.position = "top", 
        legend.title = element_blank(),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(color = "gray90", linewidth = .5)) +
  guides(col = guide_legend(nrow = 2, byrow = TRUE, override.aes = list(size = 5)))


p_undemp_nsec


```


## Trends for part-time and full time workers

```{r under ptime/ftime table, echo=FALSE}

options(digits = 3)

t_undemp_ptime <- LFS_clean %>% # summary table
  filter(AGE >= 18 & AGE <= 64) %>% 
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c(1, 2)) %>% #only employees and self-employed
  filter(DIFJOB == 2) %>% # Applies to all respondents who are not looking for a different or additional job
  group_by(year, sequence, quarter, SEX, FTPTWK, YPTJOB, UNDEMP) %>% 
  summarise(count = sum(PWT)) %>% 
  group_by(year, sequence, quarter, SEX, FTPTWK, YPTJOB) %>% 
  # percentage part-time per quarter
  mutate(percentage = count/sum(count)) %>% 
  filter(!is.na(UNDEMP) & !is.na(FTPTWK)) %>% # remove NAs. Only responses to the question
  filter(UNDEMP == 1) %>%
  as_label(.)

t_undemp_ptime <- t_undemp_ptime %>% 
  mutate(YPTJOB = case_when(FTPTWK == "Full-time" ~ "Full-time", TRUE ~  YPTJOB)) %>% 
  filter(YPTJOB %in% c("Full-time", "Could not find full-time job", "Did not want full-time job"))


```


```{r index 1, fig.width= 8, fig.height=6, fig.fullwidth=TRUE, fig.cap= ""}

p_undemp_rate_ptime <- t_undemp_ptime %>% 
  ggplot() + 
  geom_line(aes(x = sequence, y = percentage, colour = factor(YPTJOB)), size = 0.5, show.legend = FALSE) +  
  geom_point(aes(x = sequence, y = percentage, colour = factor(YPTJOB)), shape = 15, size = 1, show.legend = TRUE) +
  geom_vline(xintercept = 4.5, color = "#c9c9c9") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "#c9c9c9") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "#c9c9c9") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "#c9c9c9") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "#c9c9c9") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "#c9c9c9") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "#c9c9c9") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "#c9c9c9") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "#c9c9c9") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "#c9c9c9") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "#c9c9c9") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "#c9c9c9") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "#c9c9c9") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "#c9c9c9") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "#c9c9c9") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "#c9c9c9") + # gridline 2021
  facet_wrap(. ~ SEX, ncol=1, strip.position = "top") +
  
  # scale and colour
  scale_color_discrete_qualitative(palette = "Harmonic") +
  scale_y_continuous(breaks = seq(0,1, 0.1), limits = c(0, 1), labels =
                       scales::percent_format(accuracy = 1L), expand = c(0,0), sec.axis = dup_axis()) +
  scale_x_continuous(breaks=c(1:68), position = "bottom",
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
  # annotation
  labs(x = "", 
       y = "Percentage", 
       title ="Wants to work more hours in current job",
       subtitle  = "Part-time vs full-time employed and self-employed workers",
       caption = c("")
       ) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0, 0), "lines"),
        plot.title = element_text(size = 14, margin = ggplot2::margin(5, 0, 0, 0)),
        plot.subtitle = element_text(size = 12, hjust = 0, margin = ggplot2::margin(5, 0, 2, 0)),
        plot.caption = element_text(size = 10, hjust = 1, margin = ggplot2::margin(2, 0, 2, 0)),
        axis.title.x = element_text(margin = ggplot2::margin(t = 8), size = 12),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 12),
        axis.text.x = element_text(size = 12, margin = margin(t = 2)),
        axis.text.y = element_text(size = 12),
        axis.ticks.length.x = unit(0.1, "cm"), 
        axis.text.y.right =  element_text(margin = margin(l = 4)),
        axis.title.y.right = element_blank(),
        legend.position = "top", 
        legend.title = element_blank(),
        legend.text = element_text(size = 12),
        panel.spacing = unit(0.5, "cm"),
        strip.text = element_text(size = 14, face="bold", margin = margin(b = 2)),
        strip.background = element_blank(),
        panel.grid.major = element_line(color = "gray90", linewidth = .5)) +
  guides(col = guide_legend(nrow = 1, byrow = TRUE, override.aes = list(size = 5)))

p_undemp_rate_ptime



```


## Extra hours wanting to work by part-time and full-time workers


```{r table extra hours}

t_extra_hours <- LFS_clean %>% 
  filter(AGE >= 18 & AGE <= 64) %>%
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c(1, 2)) %>% #only employees and self-employed
  select(year, sequence, quarter, SEX, FTPTWK, YPTJOB, UNDEMP, UNDHRS) %>%
  filter(UNDEMP == 1) %>%
  filter(!is.na(UNDHRS)) %>%
  as_label(FTPTWK, YPTJOB, UNDEMP) %>%
  mutate(YPTJOB = case_when(FTPTWK == "Full-time" ~ "Full-time", TRUE ~  YPTJOB)) %>% 
  filter(YPTJOB %in% c("Full-time", "Could not find full-time job", "Did not want full-time job"))

t_extra_hours2 <- t_extra_hours %>% 
  group_by(year, sequence, quarter, SEX, YPTJOB) %>%
  summarise(median = median(UNDHRS), sd = sd(UNDHRS)) 


```



```{r extra hours line plot, fig.width=8, fig.height=6, fig.fullwidth=TRUE, fig.cap= "Median extra hours wished to work"}


p_more_hours2 <- t_extra_hours2 %>% 
  ggplot() +
  geom_line(aes(x = sequence, y = median, colour = factor(YPTJOB)), size = 0.5, show.legend = FALSE) +  
  geom_point(aes(x = factor(sequence), y = median, colour = factor(YPTJOB)), shape = 15, size = 1, show.legend = TRUE) +
  geom_vline(xintercept = 4.5, color = "#c9c9c9") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "#c9c9c9") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "#c9c9c9") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "#c9c9c9") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "#c9c9c9") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "#c9c9c9") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "#c9c9c9") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "#c9c9c9") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "#c9c9c9") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "#c9c9c9") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "#c9c9c9") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "#c9c9c9") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "#c9c9c9") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "#c9c9c9") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "#c9c9c9") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "#c9c9c9") + # gridline 2021
  facet_wrap(. ~ as_label(SEX), ncol=1, strip.position = "top") +

  # scale and colour
  scale_color_discrete_qualitative(palette = "Harmonic") + # Pastel 1, Dark 2, Dark 3, Set 2, Set 3, Warm, Cold, Harmonic, Dynamic
  scale_y_continuous(breaks = seq(0,25, 5), limits = c(0, 25), expand = c(0,0), sec.axis = dup_axis()) +
  scale_x_discrete(breaks=c(1:68), position = "bottom",
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
  # annotation
  labs(x = "", 
       y = "Hours", 
       title ="Median extra hours wished to work",
       #subtitle  = "Extra hours for those who could not find a full-time job",
       #caption = c("Note: People in employment (employees and self-employed) between 2006 and 2022")
       ) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0, 0), "lines"),
        plot.title = element_text(size = 14, margin = ggplot2::margin(5, 0, 0, 0)),
        plot.subtitle = element_text(size = 12, hjust = 0, margin = ggplot2::margin(5, 0, 15, 0)),
        plot.caption = element_text(size = 10, hjust = 1, margin = ggplot2::margin(2, 0, 2, 0)),
        axis.title.x = element_text(margin = ggplot2::margin(t = 8), size = 12),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 12),
        axis.text.x = element_text(size = 12, margin = margin(t = 2)),
        axis.text.y = element_text(size = 12),
        axis.ticks.length.x = unit(0.1, "cm"),
        axis.text.y.right =  element_text(margin = margin(l = 4)),
        axis.title.y.right = element_blank(),
        legend.position = "top", 
        legend.title = element_blank(),
        strip.text = element_text(size = 14, face="bold", margin = margin(b = 2)),
        strip.background = element_blank(),
        panel.spacing = unit(0.5, "cm"),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(color = "gray90", linewidth = .5)) +
  guides(col = guide_legend(nrow = 1, byrow = TRUE, override.aes = list(size = 5)))

p_more_hours2


```


# Indicator 3: Seeking replacement job


```{r table seeking job, echo=FALSE}

options(digits = 3)

t_seeking <- LFS_clean %>% # summary table
  filter(AGE >= 18 & AGE <= 64) %>% 
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c(1, 2)) %>% #only employees and self-employed
  group_by(year, sequence, quarter, SEX, DIFJOB, ADDJOB) %>% 
  summarise(count = sum(PWT)) %>% 
  group_by(year, sequence, quarter, SEX, DIFJOB) %>% 
  # percentage part-time per quarter
  mutate(percentage = count/sum(count)) %>% 
  filter(!is.na(DIFJOB) & !is.na(ADDJOB)) %>%
  filter(DIFJOB == 1) %>%
  filter(ADDJOB == 1) %>%
  as_label(.)

#t_seeking <-  t_seeking %>% pivot_wider(names_from = SEX, values_from = count)



```



```{r plot seeking job, fig.width=9, fig.height=3, fig.fullwidth=TRUE, fig.cap= ""}

p_seeking <- t_seeking %>% 
  ggplot() + 
  geom_bar(aes(x = sequence, y = count, fill = SEX), stat="identity", position = "dodge", width=0.8) +
  geom_vline(xintercept = 4.5, color = "#c9c9c9") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "#c9c9c9") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "#c9c9c9") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "#c9c9c9") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "#c9c9c9") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "#c9c9c9") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "#c9c9c9") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "#c9c9c9") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "#c9c9c9") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "#c9c9c9") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "#c9c9c9") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "#c9c9c9") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "#c9c9c9") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "#c9c9c9") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "#c9c9c9") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "#c9c9c9") + # gridline 2021

  # scale and colour
  scale_fill_discrete_qualitative(palette = "Dark 3") +
  scale_y_continuous(breaks = seq(0,2000000, 200000), limits = c(0, 2000000), labels = comma, expand = c(0,0), sec.axis = dup_axis()) +
  scale_x_continuous(breaks=c(1:68), position = "bottom", 
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
  # annotation
  labs(x = "Year", 
       y = "Total", 
       title ="Seeking replacement job",
       #subtitle  = "Totals based on people in employment between 2006 and 2022",
       caption = c("")
       ) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0, 0), "lines"),
        plot.title = element_text(size = 14, margin = ggplot2::margin(5, 0, 0, 0)),
        plot.subtitle = element_text(size = 12, hjust = 0, margin = ggplot2::margin(5, 0, 2, 0)),
        plot.caption = element_text(size = 10, hjust = 1, margin = ggplot2::margin(2, 0, 2, 0)),
        axis.title.x = element_text(margin = ggplot2::margin(t = 8), size = 12),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 12),
        axis.text.x = element_text(size = 12, margin = margin(t = 2)),
        axis.text.y = element_text(size = 12),
        axis.text.y.right =  element_text(margin = margin(l = 4)),
        axis.title.y.right = element_blank(),
        axis.ticks.length.x = unit(0.1, "cm"), 
        legend.position = "top", 
        legend.title = element_blank(),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(color = "gray90", linewidth = .5)) +
  guides(col = guide_legend(nrow = 1, byrow = TRUE, override.aes = list(size = 5)))


p_seeking


```



## Preferred working hours in the job being looked for


```{r additional job hours}

t_seeking_hours <- LFS_clean %>% 
  filter(AGE >= 18 & AGE <= 64) %>%
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c(1, 2)) %>% #only employees and self-employed
  filter(DIFJOB == 1) %>%
  filter(ADDJOB == 1) %>%
  group_by(year, sequence, quarter, PREFHR) %>% 
  summarise(count = sum(PWT)) %>% 
  group_by(year, sequence, quarter) %>% 
  # percentage part-time per quarter
  mutate(percentage = count/sum(count)) %>% 
  filter(!is.na(PREFHR) & PREFHR %in% c("1", "2", "3")) %>% 
  as_label(.)


```


```{r additional job hours, fig.width=8, fig.height=4, fig.fullwidth=TRUE, fig.cap= "Extra hours wished to work"}


p_seeking_hours <- t_seeking_hours %>% 
  ggplot() + 
  geom_line(aes(x = sequence, y = percentage, colour = factor(PREFHR)), size = 0.5, show.legend = FALSE) +  
  geom_point(aes(x = sequence, y = percentage, colour = factor(PREFHR)), shape = 15, size = 1, show.legend = TRUE) +
  geom_vline(xintercept = 4.5, color = "#c9c9c9") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "#c9c9c9") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "#c9c9c9") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "#c9c9c9") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "#c9c9c9") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "#c9c9c9") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "#c9c9c9") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "#c9c9c9") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "#c9c9c9") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "#c9c9c9") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "#c9c9c9") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "#c9c9c9") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "#c9c9c9") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "#c9c9c9") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "#c9c9c9") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "#c9c9c9") + # gridline 2021
  #facet_wrap(. ~ SEX, ncol=1, strip.position = "top") +
  
  # scale and colour
  scale_color_discrete_qualitative(palette = "Set 2") + # Pastel 1, Dark 2, Dark 3, Set 2, Set 3, Warm, Cold, Harmonic, Dynamic
  scale_y_continuous(breaks = seq(0,1, 0.1), limits = c(0, 1), labels =
                       scales::percent_format(accuracy = 1L), expand = c(0,0), sec.axis = dup_axis()) +
  scale_x_continuous(breaks=c(1:68), position = "bottom",
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
  # annotation
  labs(x = "", 
       y = "Percentage", 
       title ="Preferred working hours in new job being looked for",
       #subtitle  = " ",
       caption = c("")
       ) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0, 0), "lines"),
        plot.title = element_text(size = 14, margin = ggplot2::margin(5, 0, 8, 0)),
        plot.subtitle = element_text(size = 12, hjust = 0, margin = ggplot2::margin(5, 0, 2, 0)),
        plot.caption = element_text(size = 10, hjust = 1, margin = ggplot2::margin(2, 0, 2, 0)),
        axis.title.x = element_text(margin = ggplot2::margin(t = 8), size = 12),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 12),
        axis.text.x = element_text(size = 12, margin = margin(t = 2)),
        axis.text.y = element_text(size = 12),
        axis.text.y.right =  element_text(margin = margin(l = 4)),
        axis.title.y.right = element_blank(),
        axis.ticks.length.x = unit(0.1, "cm"), 
        legend.position = "top", 
        legend.title = element_blank(),
        legend.text = element_text(size = 12),
        panel.spacing = unit(0.5, "cm"),
        strip.text = element_text(size = 14, face="bold", margin = margin(b = 2)),
        strip.background = element_blank(),
        panel.grid.major = element_line(color = "gray90", linewidth = .5)) +
  guides(col = guide_legend(nrow = 1, byrow = TRUE, override.aes = list(size = 5)))


p_seeking_hours

```
