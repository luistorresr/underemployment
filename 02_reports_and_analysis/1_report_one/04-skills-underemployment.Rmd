
```{r setup-2, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
	warning = FALSE,
  embed_fonts = TRUE,
  fig.fullwidth = TRUE,
  fig.align = "center",
  use_bookdown= TRUE,
  toc= TRUE,
  toc_depth= 4
)
```

```{r libraries-2, include=FALSE}

#### packages needed
if(!require(tidyverse)) install.packages("tidyverse", repos = "http://cran.us.r-project.org")
if(!require(gridExtra)) install.packages("girdExtra", repos = "http://cran.us.r-project.org")
if(!require(Hmisc)) install.packages("Hmisc", repos = "http://cran.us.r-project.org")
if(!require(sjlabelled)) install.packages("sjlabelled", repos = "http://cran.us.r-project.org")
if(!require(ggthemes)) install.packages("ggthemes", repos = "http://cran.us.r-project.org")
if(!require(ggtext)) install.packages("ggtext", repos = "http://cran.us.r-project.org")
if(!require(ggrepel)) install.packages("ggrepel", repos = "http://cran.us.r-project.org")
if(!require(doBy)) install.packages("doBy", repos = "http://cran.us.r-project.org")
if(!require(sjmisc)) install.packages("sjmisc", repos = "http://cran.us.r-project.org")
if(!require(webshot)) install.packages("webshot", repos = "http://cran.us.r-project.org")
if(!require(scales)) install.packages("scales", repos = "http://cran.us.r-project.org")
if(!require(ggalt)) install.packages("ggalt", repos = "http://cran.us.r-project.org")
if(!require(janitor)) install.packages("janitor", repos = "http://cran.us.r-project.org")
if(!require(bookdown)) install.packages("bookdown", repos = "http://cran.us.r-project.org")
if(!require(htmlwidgets)) install.packages("htmlwidgets", repos = "http://cran.us.r-project.org")
if(!require(widgetframe)) install.packages("widgetframe", repos = "http://cran.us.r-project.org")
if(!require(officer)) install.packages("officer", repos = "http://cran.us.r-project.org")
if(!require(showtext)) install.packages("showtext", repos = "http://cran.us.r-project.org")
if(!require(colorspace)) install.packages("colorspace", repos = "http://cran.us.r-project.org")
if(!require(patchwork)) install.packages("patchwork", repos = "http://cran.us.r-project.org")
if(!require(ggpubr)) install.packages("ggpubr", repos = "http://cran.us.r-project.org")
if(!require(gt)) install.packages("gt", repos = "http://cran.us.r-project.org")
if(!require(htmltools)) install.packages("htmltools", repos = "http://cran.us.r-project.org")
if(!require(yaml)) install.packages("yaml", repos = "http://cran.us.r-project.org")
if(!require(grid)) install.packages("grid", repos = "http://cran.us.r-project.org")

library(ggalt) # contingency table
library(tidyverse) # several tools for data manipulation
library(haven) # read SPSS, Stata, and SAS data
library(gridExtra) # arrange multiple grid-based plots on a page
library(Hmisc) # many functions useful for data analysis
library(sjmisc) # useful to set Na's
library(sjlabelled) # get_labels function
library(ggthemes) # themes for ggplot2
library(ggtext) # fancy text
library(ggrepel) # help with the position of the labels on ggplot2 graph
library(doBy) # 'do' something to data stratified 'by' some variables
library(scales) # add scale symbols and colour to axis
library(janitor) # add totals to tables
library(bookdown) # add totals to tables
library(htmlwidgets)
library(widgetframe)
library(colorspace) # colour blind friendly pallettes 
library(officer) # to add additional formatting to tables 
library(patchwork) # to put graphs side by side
library(ggpubr) # easy-to-use functions for creating and customizing ‘ggplot2’- based publication ready plots.
library(gt) #  creation of interactive data tables
library(htmltools) # tools for creating, manipulating, and writing HTML 
library(grid)
library(webshot)
library(yaml)
library(showtext)
  font_add_google("Lato")
  showtext_auto()

```

```{r load-data-2, include=FALSE}

load("../../data/LFS_clean.rda")

```


```{r copyright-2, include=FALSE}

# top left
copyright = grobTree(textGrob("(c) The Underemployment Project\n      underemployment.info", x=0.008, y= 0.94, hjust=0, gp=gpar(col="gray40", fontsize=8, lineheight = .6, fill="white", alpha = 1))) 

# top right
copyright2 = grobTree(textGrob("(c) The Underemployment Project\n      underemployment.info", x=0.99, y= 0.94, hjust=1, gp=gpar(col="gray40", fontsize=8, lineheight = .6, fill="white", alpha = 1))) 

# bottom left 
copyright3 = grobTree(textGrob("(c) The Underemployment Project\n      underemployment.info", x=0.008, y= 0.05, hjust=0, gp=gpar(col="gray40", fontsize=8, lineheight = .6, fill="white", alpha = 1))) 

```


# Skills-related underemployment

<p align="justify">Skills-related underemployment, skills underutilisation or overqualification is defined  as a situation of mismatch between the skills needed for a job and the skills available in the labour market, in which skills from individuals surpasses the requirements of a job [@Rafferty2020]. Skills-related underemployment is measured through a proxy that compares the relation between the highest qualification held by an employee and their current occupation [@Green2016]. In national surveys such as the LFS, this can be measured through a normative approach or a statistical approach [@ILO2014].</p>

<p align="justify"> We use the normative approach in this report because it allows to standardise the categories of “overqualified”, “matched” and “underqualified” through time. The normative approach is operationalised as follows:</p>

- <p align="justify">Employees' highest qualification is categorised according to the first digit of the International Standard Classification of Education (ISCED-97) and then classified into thee categories. Later, ISCED levels 1 and 2 are assigned as "Low-skilled", levels 3 and 4 are considered "Intermediate", and levels 5 and 6 as "High-skilled".</p>
- <p align="justify">Whilst occupations are classified based on the first digit of the International Standard Classification of Occupations (ISCO-88) and categorised into three groups. In this case, occupations with 9 ISCO code are considered "low-skilled", occupations related to ISCO codes 4, 5, 6, 7 and 8 are assigned to "intermediate" and occupations coded 1, 2 and 3 as "high-skilled".</p>
- <p align="justify">Then, employees are considered as "overeducated" when their educational level is higher to the occupational group of their current job.</p> 

## Male and female workers

<p align="justify"> Figure \@ref(fig:plot-overqualified-employees-sex) shows that the proportion of individuals categorised as skill underemployed has steadily increased between 2006 to 2022. In this regard, from the start of the period and until 2008 the percentage of overqualified male and female workers was similar, however since 2009 the gap between women and men has widened.</p>   

```{r overqualification-by-men-and-women-table, include=FALSE}

options(digits = 3)

n_skills <- LFS_clean %>% # summary table
  filter(AGE >= 18 & AGE <= 64) %>% 
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c(1, 2)) %>% #only employees and self-employed
  group_by(year, sequence, quarter, SEX, sk_mm) %>% 
  summarise(count = sum(PWT)) %>% 
  group_by(year, sequence, quarter, SEX) %>% 
  # percentage per quarter
  mutate(percentage = count/sum(count)) %>% 
  filter(sk_mm == 1) %>%  #filtering by overqualified
  as_label(.)

```


```{r plot-overqualified-employees-sex, fig.width = 7.5, fig.asp = 0.7, out.width = '100%', fig.cap= "Workers who have a qualification above the required for their occupation"}

p_nskills <- n_skills %>% 
  ggplot(aes(x = sequence, y = percentage, colour = factor(SEX))) + 
  geom_line(linewidth = 0.7, show.legend = FALSE) +  
  geom_point(shape = 20, show.legend = TRUE) +
  geom_vline(xintercept = 4.5, color = "#c9c9c9") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "#c9c9c9") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "#c9c9c9") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "#c9c9c9") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "#c9c9c9") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "#c9c9c9") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "#c9c9c9") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "#c9c9c9") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "#c9c9c9") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "#c9c9c9") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "#c9c9c9") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "#c9c9c9") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "#c9c9c9") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "#c9c9c9") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "#c9c9c9") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "#c9c9c9") + # gridline 2021

  # scale and colour
  scale_color_discrete_qualitative(palette = "Dark 3") +
  scale_y_continuous(breaks = seq(0,0.3, 0.05), limits = c(0, 0.3), labels =
                       scales::percent_format(accuracy = 1L), expand = c(0,0)) +
  scale_x_continuous(breaks=c(1:68), position = "top",
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
  # annotation
  labs(x = "", 
       y = "Percentage", 
       #title ="Figure 1. Overqualified workers by gender (percentages and totals)",
       subtitle  = "",
       caption = ""
       ) +
  annotate('rect', xmin=10, xmax=14, ymin=0, ymax=0.3, alpha=.2, fill='brown1') + # Great Recession
  annotate(geom = "text", x = 10, y = 0.25, label = "Great Recession", hjust = 0, size = 5, colour = "darkred") +
  annotate('rect', xmin=30.5, xmax=31.5, ymin=0, ymax=0.3, alpha=.2, fill='darkgreen') + # back to pre-recession
  annotate(geom = "text", x = 31.2, y = 0.25, label = "UK economy gets back\nto pre-downturn size", hjust = 0, size = 5, colour = "darkgreen", lineheight = .6) +
  annotate('rect', xmin=56.5, xmax=58, ymin=0, ymax=0.3, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 56.5, y = 0.25, label = "Covid-19\nrecession", hjust = 0, size = 5, colour = "darkred", lineheight = .6) +
  annotate('rect', xmin=63, xmax=68, ymin=0, ymax=0.3, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 63, y = 0.25, label = "Cost of\nliving crisis", hjust = 0, size = 5, colour = "darkred", lineheight = .6) +
  annotation_custom(copyright) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0, 0.3), "cm"),
        plot.title = element_text(size = 15, margin = ggplot2::margin(0, 0, 0, 0)),
        plot.subtitle = element_text(size = 13, hjust = 0, margin = ggplot2::margin(0, 0, 0, 0), colour = "gray50"),
        plot.caption = element_text(size = 12, hjust = 1, margin = ggplot2::margin(4, 0, 5, 0), colour = "gray50"),
        axis.title.x = element_text(margin = ggplot2::margin(t = 10), size = 13),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 13),
        axis.text.x = element_text(size = 14, margin = margin(t = 2)),
        axis.text.y = element_text(size = 14),
        axis.text.y.left = element_text(margin = margin(r = 4)),
        axis.ticks.length.x = unit(0.1, "cm"), 
        legend.position = "none", 
        legend.title = element_blank(),
        legend.text = element_text(size = 14),
        panel.spacing = unit(.2, "cm"),
        panel.grid.major = element_line(color = "gray90", linewidth = .06)) +
  guides(col = guide_legend(nrow = 1, byrow = TRUE, override.aes = list(size = 5)))

pskills_total <- n_skills %>% 
  ggplot(aes(x = sequence, y = count, fill = factor(SEX))) + 
  geom_bar(stat = "identity", position = "dodge", width=0.8) +   
  geom_vline(xintercept = 4.5, color = "#c9c9c9") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "#c9c9c9") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "#c9c9c9") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "#c9c9c9") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "#c9c9c9") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "#c9c9c9") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "#c9c9c9") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "#c9c9c9") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "#c9c9c9") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "#c9c9c9") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "#c9c9c9") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "#c9c9c9") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "#c9c9c9") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "#c9c9c9") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "#c9c9c9") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "#c9c9c9") + # gridline 2021

  # scale and colour
  scale_fill_discrete_qualitative(palette = "Dark 3") +
  scale_y_continuous(breaks = seq(0,3000000, 250000), limits = c(0,3000000), labels = comma, expand = c(0,0)) +
  scale_x_continuous(breaks=c(1:68),
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +

  
  # annotation
  labs(x = "Year", 
       y = "Total", 
       #title = "",
       #subtitle  = "Totals based on people in employment between 2006 and 2022",
       #caption = c("Note: People in employment (employees and self-employed) between 2006 and 2022")
       ) +
  annotate('rect', xmin=10, xmax=14, ymin=0, ymax=3000000, alpha=.2, fill='brown1') + # Great Recession
  annotate(geom = "text", x = 10, y = 2300000, label = "Great Recession", hjust = 0, size = 5, colour = "darkred") +
  annotate('rect', xmin=30.5, xmax=31.5, ymin=0, ymax=3000000, alpha=.2, fill='darkgreen') + # back to pre-recession
  annotate(geom = "text", x = 31.2, y = 2300000, label = "UK economy gets back\nto pre-downturn size", hjust = 0, size = 5, colour = "darkgreen", lineheight = .7) +
  annotate('rect', xmin=56.5, xmax=58, ymin=0, ymax=3000000, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 56.5, y = 2300000, label = "Covid-19\nrecession", hjust = 0, size = 5, colour = "darkred", lineheight = .7) +
  annotate('rect', xmin=63, xmax=68, ymin=0, ymax=3000000, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 63, y = 2300000, label = "Cost of\nliving crisis", hjust = 0, size = 5, colour = "darkred", lineheight = .7) +
  annotation_custom(copyright) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0, 0.3), "cm"),
        plot.title = element_text(size = 15, margin = ggplot2::margin(0, 0, 0, 0)),
        plot.subtitle = element_text(size = 13, hjust = 0, margin = ggplot2::margin(0, 0, 0, 0), colour = "gray50"),
        plot.caption = element_text(size = 12, hjust = 1, margin = ggplot2::margin(0, 0, 0, 0), colour = "gray50"),
        axis.title.x = element_text(margin = ggplot2::margin(t = 10), size = 13),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 13),
        axis.text.x = element_text(size = 14, margin = margin(t = 2)),
        axis.text.y = element_text(size = 14),
        axis.text.y.left = element_text(margin = margin(r = 4)),
        axis.ticks.length.x = unit(0.1, "cm"), 
        legend.position = "top", 
        legend.title = element_blank(),
        legend.text = element_text(size = 14),
        panel.spacing = unit(.2, "cm"),
        panel.grid.major = element_line(color = "gray90", linewidth = .06)) +
  guides(col = guide_legend(nrow = 1, byrow = TRUE, override.aes = list(size = 5)))

p_nskills / pskills_total


```


## Workers by age group

<p align="justify"> Similarly to time-related underemployment, Figure \@ref(fig:plot-overqualified-employees-age) shows that the younger the workers are, the more likely to be overqualified in their current jobs. Particularly, the age group between 18 to 24 years old has a higher proportion of workers holding a qualification above than the one required at their jobs.</p>  

```{r overqualification-by-age-table, include=FALSE}

options(digits = 3)

n_skills_age <- LFS_clean %>% # summary table
  filter(AGE >= 18 & AGE <= 64) %>% 
  #creating age categories
  mutate(AGE_cat = case_when(AGE %in% 18:24 ~ "Between 18 and 24",
                             AGE %in% 25:34 ~ "Between 25 and 34",
                             AGE %in% 35:44 ~ "Between 35 and 44",
                             AGE %in% 45:54 ~ "Between 45 and 54",
                             AGE %in% 55:64 ~ "Between 55 and 64",
                             is.na(AGE) ~ NA)) %>%
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c(1, 2)) %>% #only employees and self-employed
  group_by(year, sequence, quarter, AGE_cat, sk_mm) %>% 
  summarise(count = sum(PWT)) %>% 
  group_by(year, sequence, quarter, AGE_cat) %>% 
  # percentage per quarter
  mutate(percentage = count/sum(count)) %>% 
  filter(sk_mm == 1) %>%  #filtering by overqualified
  as_label(.)

```

```{r plot-overqualified-employees-age, fig.width = 7, fig.asp = 0.5, out.width = '100%', fig.fullwidth = TRUE, fig.cap= "Younger workers are more likely to be overqualified in their jobs"}

p_nskills_age <- n_skills_age %>% 
  ggplot(aes(x = sequence, y = percentage, colour = factor(AGE_cat))) + 
  geom_line(linewidth = 0.7, show.legend = FALSE) +  
  geom_point(shape = 20, show.legend = TRUE) +
  geom_vline(xintercept = 4.5, color = "#c9c9c9") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "#c9c9c9") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "#c9c9c9") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "#c9c9c9") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "#c9c9c9") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "#c9c9c9") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "#c9c9c9") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "#c9c9c9") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "#c9c9c9") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "#c9c9c9") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "#c9c9c9") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "#c9c9c9") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "#c9c9c9") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "#c9c9c9") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "#c9c9c9") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "#c9c9c9") + # gridline 2021

  # scale and colour
  scale_color_discrete_qualitative(palette = "Dark 3") +
  scale_y_continuous(breaks = seq(0,0.5, 0.05), limits = c(0, 0.5), labels =
                       scales::percent_format(accuracy = 1L), expand = c(0,0)) +
  scale_x_continuous(breaks=c(1:68), position = "bottom",
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
  # annotation
  labs(x = "", 
       y = "Percentage", 
       #title ="Figure 2. Overqualified workers by age (percentages and totals)",
       #subtitle  = "",
       #caption = ""
       ) +
  annotate('rect', xmin=10, xmax=14, ymin=0, ymax=0.5, alpha=.2, fill='brown1') + # Great Recession
  annotate(geom = "text", x = 10, y = 0.40, label = "Great Recession", hjust = 0, size = 5, colour = "darkred") +
  annotate('rect', xmin=30.5, xmax=31.5, ymin=0, ymax=0.5, alpha=.2, fill='darkgreen') + # back to pre-recession
  annotate(geom = "text", x = 31.2, y = 0.40, label = "UK economy gets back\nto pre-downturn size", hjust = 0, size = 5, colour = "darkgreen", lineheight = .7) +
  annotate('rect', xmin=56.5, xmax=58, ymin=0, ymax=0.5, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 56.5, y = 0.40, label = "Covid-19\nrecession", hjust = 0, size = 5, colour = "darkred", lineheight = .7) +
  annotate('rect', xmin=63, xmax=68, ymin=0, ymax=0.5, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 63, y = 0.40, label = "Cost of\nliving crisis", hjust = 0, size = 5, colour = "darkred", lineheight = .7) +
  annotation_custom(copyright) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0, 0.3), "cm"),
        plot.title = element_text(size = 15, margin = ggplot2::margin(0, 0, 0, 0)),
        plot.subtitle = element_text(size = 13, hjust = 1, margin = ggplot2::margin(0, 0, 4, 0), colour = "gray50"),
        plot.caption = element_text(size = 12, hjust = 1, margin = ggplot2::margin(0, 0, 2, 0), colour = "gray50"),
        axis.title.x = element_text(margin = ggplot2::margin(t = 10), size = 13),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 13),
        axis.text.x = element_text(size = 14, margin = margin(t = 2)),
        axis.text.y = element_text(size = 14),
        axis.text.y.left = element_text(margin = margin(r = 4)),
        axis.ticks.length.x = unit(0.1, "cm"), 
        legend.position = "top", 
        legend.title = element_blank(),
        legend.text = element_text(size = 15),
        panel.spacing = unit(.2, "cm"),
        panel.grid.major = element_line(color = "gray90", linewidth = .06)) +
  guides(col = guide_legend(nrow = 1, byrow = TRUE, override.aes = list(size = 6)))

p_nskills_age

```


## Ethnicity

<p align="justify">In addition, Figure \@ref(fig:plot-overqualified-employees-eth) shows ethnic-minority groups are more likely to find themselves in jobs for which they are overqualified. Furthermore, after the great recession the percentage of overqualified ethnic-minority groups sharply increased and has remained steady since then, while the proportion of white groups has constantly increased since 2010.</p>


```{r overqualification-by-ethnicity-table, include=FALSE}

LFS_clean <- LFS_clean %>% mutate(ETH2 = case_match(ETH, 
                                        1 ~ "White",
                                        2 ~ "Minority-ethnic", 
                                        3 ~ "Minority-ethnic", 
                                        4 ~ "Minority-ethnic", 
                                        5 ~ "Minority-ethnic",
                                        6 ~ "Minority-ethnic")) %>% 
                                    as_numeric(., keep.labels = TRUE)

options(digits = 3)

n_skills_eth <- LFS_clean %>% # summary table
  filter(AGE >= 18 & AGE <= 64) %>% 
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c(1, 2)) %>% #only employees and self-employed
  group_by(year, sequence, quarter, ETH2, sk_mm) %>% 
  summarise(count = sum(PWT)) %>% 
  group_by(year, sequence, quarter, ETH2) %>% 
  # percentage per quarter
  mutate(percentage = count/sum(count)) %>% 
  filter(sk_mm == 1) %>%  #filtering by overqualified
  filter(!is.na(ETH2)) %>%  # remove NAs from the ethnicity variable
  as_label(.)

```


```{r plot-overqualified-employees-eth, fig.width = 7, fig.asp = 0.5, out.width = '100%', fig.fullwidth = TRUE, fig.cap= "Ethnic-minority groups are more likely to find themselves in jobs for which they are overqualified"}

p_nskills_eth <- n_skills_eth %>% 
  ggplot(aes(x = sequence, y = percentage, colour = factor(ETH2))) + 
  geom_line(linewidth = 0.7, show.legend = FALSE) +  
  geom_point(shape = 20, show.legend = TRUE) +
  geom_vline(xintercept = 4.5, color = "#c9c9c9") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "#c9c9c9") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "#c9c9c9") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "#c9c9c9") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "#c9c9c9") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "#c9c9c9") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "#c9c9c9") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "#c9c9c9") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "#c9c9c9") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "#c9c9c9") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "#c9c9c9") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "#c9c9c9") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "#c9c9c9") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "#c9c9c9") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "#c9c9c9") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "#c9c9c9") + # gridline 2021

  # scale and colour
  scale_color_discrete_qualitative(palette = "Dark 3") +
  scale_y_continuous(breaks = seq(0,0.5,0.05), limits = c(0, 0.5), labels =
                       scales::percent_format(accuracy = 1L), expand = c(0,0)) +
  scale_x_continuous(breaks=c(1:68), position = "bottom",
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
  # annotation
  labs(x = " ", 
       y = "Percentage", 
       #title ="Figure 3. Overqualified workers by ethnic groups (percentages and totals)",
       #subtitle  = "",
       #caption = ""
       ) +
  annotate('rect', xmin=10, xmax=14, ymin=0, ymax=0.50, alpha=.2, fill='brown1') + # Great Recession
  annotate(geom = "text", x = 10, y = 0.35, label = "Great Recession", hjust = 0, size = 5, colour = "darkred") +
  annotate('rect', xmin=30.5, xmax=31.5, ymin=0, ymax=0.50, alpha=.2, fill='darkgreen') + # back to pre-recession
  annotate(geom = "text", x = 31.2, y = 0.35, label = "UK economy gets back\nto pre-downturn size", hjust = 0, size = 5, colour = "darkgreen", lineheight = .7) +
  annotate('rect', xmin=56.5, xmax=58, ymin=0, ymax=0.50, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 56.5, y = 0.35, label = "Covid-19\nrecession", hjust = 0, size = 5, colour = "darkred", lineheight = .7) +
  annotate('rect', xmin=63, xmax=68, ymin=0, ymax=0.50, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 63, y = 0.35, label = "Cost of\nliving crisis", hjust = 0, size = 5, colour = "darkred", lineheight = .7) +
  annotation_custom(copyright) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0, 0.3), "cm"),
        plot.title = element_text(size = 15, margin = ggplot2::margin(0, 0, 0, 0)),
        plot.subtitle = element_text(size = 13, hjust = 1, margin = ggplot2::margin(0, 0, 4, 0), colour = "gray50"),
        plot.caption = element_text(size = 12, hjust = 1, margin = ggplot2::margin(0, 0, 2, 0), colour = "gray50"),
        axis.title.x = element_text(margin = ggplot2::margin(t = 10), size = 13),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 13),
        axis.text.x = element_text(size = 14, margin = margin(t = 2)),
        axis.text.y = element_text(size = 14),
        axis.text.y.left = element_text(margin = margin(r = 4)),
        axis.ticks.length.x = unit(0.1, "cm"), 
        legend.position = "top", 
        legend.title = element_blank(),
        legend.text = element_text(size = 15),
        panel.spacing = unit(.2, "cm"),
        panel.grid.major = element_line(color = "gray90", linewidth = .06),
        legend.spacing = unit(0.2, 'cm')) +
  guides(col = guide_legend(nrow = 1, byrow = TRUE, override.aes = list(size = 6)))

p_nskills_eth

```


## Qualification level

<p align="justify">In terms of educational level, Figure \@ref(fig:plot-overqualified-employees-qualification) highlights that those with a degree or equivalent are more likely to be overqualified for their current job. Furthermore, although the number of overqualified workers that hold a “Higher education” and “GCE, A-level or equivalent” has not experienced relevant changes in this period, the percentage of overqualified employees with a degree or equivalent experienced an important growth after the great recession and has not gone back to pre-crisis levels.</p>

```{r overqualification-by-educational-level-table, include=FALSE}

options(digits = 3)

n_skills_quali <- LFS_clean %>% # summary table
  filter(AGE >= 18 & AGE <= 64) %>% 
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c(1, 2)) %>% #only employees and self-employed
  group_by(year, sequence, quarter, quali, sk_mm) %>% 
  summarise(count = sum(PWT)) %>% 
  group_by(year, sequence, quarter, quali) %>% 
  # percentage per quarter
  mutate(percentage = count/sum(count)) %>% 
  filter(!is.na(quali) & !quali %in% c("7")) %>% 
  filter(sk_mm == 1) %>%  #filtering by overqualified
  as_label(.)

```


```{r plot-overqualified-employees-qualification, fig.width = 7.5, fig.asp = 0.6, out.width = '100%', fig.fullwidth = TRUE, fig.cap= "Those workers with a degree are more likely to be overqualified for their jobs"}

p_nskills_quali <- n_skills_quali %>% 
  ggplot() + 
  geom_line(aes(x = sequence, y = percentage, colour = factor(quali)), linewidth = 0.7, show.legend = FALSE) +  
  geom_point(aes(x = sequence, y = percentage, colour = factor(quali)), shape = 20, show.legend = TRUE) +
  geom_vline(xintercept = 4.5, color = "#c9c9c9") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "#c9c9c9") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "#c9c9c9") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "#c9c9c9") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "#c9c9c9") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "#c9c9c9") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "#c9c9c9") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "#c9c9c9") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "#c9c9c9") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "#c9c9c9") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "#c9c9c9") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "#c9c9c9") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "#c9c9c9") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "#c9c9c9") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "#c9c9c9") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "#c9c9c9") + # gridline 2021

  # scale and colour
  scale_color_discrete_qualitative(palette = "Dark 3") +
  scale_y_continuous(breaks = seq(0,0.5,0.05), limits = c(0, 0.5), labels =
                       scales::percent_format(accuracy = 1L), expand = c(0,0)) +
  scale_x_continuous(breaks=c(1:68), position = "bottom",
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
  # annotation
  labs(x = "", 
       y = "Percentage", 
       #title ="Figure 4. Overqualified workers by educational level (percentages and totals)",
       #subtitle  = "",
       #caption = ""
       ) +
  annotate('rect', xmin=10, xmax=14, ymin=0, ymax=0.5, alpha=.2, fill='brown1') + # Great Recession
  annotate(geom = "text", x = 10, y = 0.40, label = "Great Recession", hjust = 0, size = 5, colour = "darkred") +
  annotate('rect', xmin=30.5, xmax=31.5, ymin=0, ymax=0.5, alpha=.2, fill='darkgreen') + # back to pre-recession
  annotate(geom = "text", x = 31.2, y = 0.40, label = "UK economy gets back\nto pre-downturn size", hjust = 0, size = 5, colour = "darkgreen", lineheight = .7) +
  annotate('rect', xmin=56.5, xmax=58, ymin=0, ymax=0.5, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 56.5, y = 0.40, label = "Covid-19", hjust = 0, size = 5, colour = "darkred") +
  annotate('rect', xmin=63, xmax=68, ymin=0, ymax=0.5, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 63, y = 0.40, label = "Cost of\nliving crisis", hjust = 0, size = 5, colour = "darkred", lineheight = .7) +
  annotation_custom(copyright) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0, 0.3), "cm"),
        plot.title = element_text(size = 15, margin = ggplot2::margin(0, 0, 0, 0)),
        plot.subtitle = element_text(size = 13, hjust = 1, margin = ggplot2::margin(0, 0, 4, 0), colour = "gray50"),
        plot.caption = element_text(size = 12, hjust = 1, margin = ggplot2::margin(0, 0, 2, 0), colour = "gray50"),
        axis.title.x = element_text(margin = ggplot2::margin(t = 10), size = 13),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 13),
        axis.text.x = element_text(size = 14, margin = margin(t = 2)),
        axis.text.y = element_text(size = 14),
        axis.text.y.left = element_text(margin = margin(r = 4)),
        axis.ticks.length.x = unit(0.1, "cm"), 
        legend.position = "top", 
        legend.title = element_blank(),
        legend.text = element_text(size = 15),
        panel.spacing = unit(.2, "cm"),
        panel.grid.major = element_line(color = "gray90", linewidth = .06)) +
 guides(col = guide_legend(nrow = 1, byrow = TRUE, override.aes = list(size = 6)))

p_nskills_quali

```

## Occupational group

<p align="justify">In contrast to the indicators reviewed in the previous section, Figure \@ref(fig:plot-overqualified-employees-nsec) shows that intermediate occupations (such as secretary, personal assistant, clerical worker, office clerk, call centre agent, nursing auxiliary or nursery nurse) have a larger proportion of overqualified employees than those in a routine and semi-routine occupations. However, in 2022 the proportion of workers in both categories is matched. Nonetheless, between 2006 and 2022 only managerial positions have not experienced a relevant increase of employees that have higher qualifications than those required for their roles.</p>

```{r overqualification-by-occupational-category-table, include=FALSE}

options(digits = 3)

n_skills_nsec <- LFS_clean %>% # summary table
  filter(AGE >= 18 & AGE <= 64) %>% 
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c(1, 2)) %>% #only employees and self-employed
  group_by(year, sequence, quarter, NSEC2,sk_mm) %>% 
  summarise(count = sum(PWT)) %>% 
  group_by(year, sequence, quarter, NSEC2) %>% 
  # percentage per quarter
  mutate(percentage = count/sum(count)) %>% 
  filter(!is.na(NSEC2) & !NSEC2 %in% c(3,6)) %>%  # omit no answers and no apply
  filter(sk_mm == 1) %>%  #filtering by overqualified
  as_label(.)

```

```{r plot-overqualified-employees-nsec, fig.width = 7.5, fig.asp = 0.6, out.width = '100%', fig.fullwidth = TRUE, fig.cap= "Intermediate occupations represent the largest proportion of overqualified employees"}

p_nskills_nsec <- n_skills_nsec %>% 
  ggplot() + 
  geom_line(aes(x = sequence, y = percentage, colour = factor(NSEC2)), linewidth = 0.7, show.legend = FALSE) +  
  geom_point(aes(x = sequence, y = percentage, colour = factor(NSEC2)), shape = 20, show.legend = TRUE) +
  geom_vline(xintercept = 4.5, color = "#c9c9c9") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "#c9c9c9") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "#c9c9c9") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "#c9c9c9") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "#c9c9c9") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "#c9c9c9") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "#c9c9c9") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "#c9c9c9") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "#c9c9c9") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "#c9c9c9") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "#c9c9c9") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "#c9c9c9") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "#c9c9c9") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "#c9c9c9") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "#c9c9c9") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "#c9c9c9") + # gridline 2021

  # scale and colour
  scale_color_discrete_qualitative(palette = "Dynamic") +
  scale_y_continuous(breaks = seq(0,0.5,0.05), limits = c(0, 0.5), labels =
                       scales::percent_format(accuracy = 1L), expand = c(0,0)) +
  scale_x_continuous(breaks=c(1:68), position = "bottom",
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
  # annotation
  labs(x = "Year", 
       y = "Percentage", 
       #title ="Figure 5. Overqualified workers by occupational category (percentages and totals)",
       #subtitle  = "",
      #caption = ""
       ) +
  annotate('rect', xmin=10, xmax=14, ymin=0, ymax=0.5, alpha=.2, fill='brown1') + # Great Recession
  annotate(geom = "text", x = 10, y = 0.40, label = "Great Recession", hjust = 0, size = 5, colour = "darkred") +
  annotate('rect', xmin=30.5, xmax=31.5, ymin=0, ymax=0.5, alpha=.2, fill='darkgreen') + # back to pre-recession
  annotate(geom = "text", x = 31.2, y = 0.40, label = "UK economy gets back\nto pre-downturn size", hjust = 0, size = 5, colour = "darkgreen", lineheight = .7) +
  annotate('rect', xmin=56.5, xmax=58, ymin=0, ymax=0.5, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 56.5, y = 0.40, label = "Covid-19", hjust = 0, size = 5, colour = "darkred") +
  annotate('rect', xmin=63, xmax=68, ymin=0, ymax=0.5, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 63, y = 0.40, label = "Cost of\nliving crisis", hjust = 0, size = 5, colour = "darkred", lineheight = .7) +
  annotation_custom(copyright) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0, 0.3), "cm"),
        plot.title = element_text(size = 15, margin = ggplot2::margin(0, 0, 0, 0)),
        plot.subtitle = element_text(size = 13, hjust = 1, margin = ggplot2::margin(0, 0, 4, 0), colour = "gray50"),
        plot.caption = element_text(size = 12, hjust = 1, margin = ggplot2::margin(0, 0, 2, 0), colour = "gray50"),
        axis.title.x = element_text(margin = ggplot2::margin(t = 10), size = 13),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 13),
        axis.text.x = element_text(size = 14, margin = margin(t = 2)),
        axis.text.y = element_text(size = 14),
        axis.text.y.left = element_text(margin = margin(r = 4)),
        axis.ticks.length.x = unit(0.1, "cm"), 
        legend.position = "top", 
        legend.title = element_blank(),
        legend.text = element_text(size = 15),
        panel.spacing = unit(.2, "cm"),
        panel.grid.major = element_line(color = "gray90", linewidth = .06)) +
  guides(col = guide_legend(nrow = 1, byrow = TRUE, override.aes = list(size = 6)))

p_nskills_nsec

```

##  Permanent and non-permanent jobs  

<p align="justify">As Figure \@ref(fig:plot-overqualified-employees-JOBTYP) shows, the proportion of overqualified employees is larger among those in a non-permanent job than those with a permanent contract. Nonetheless, in both work arrangements the proportion of overqualified workers has significantly increased during this period.</p>   

```{r overqualification-by-work-arrangement-table, include=FALSE}

options(digits = 3)

t_skills_temp <- LFS_clean %>% # summary table
  filter(AGE >= 18 & AGE <= 64) %>% 
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c(1, 2)) %>% #only employees and self-employed
  group_by(year, sequence, quarter, JOBTYP,sk_mm) %>% 
  summarise(count = sum(PWT)) %>% 
  group_by(year, sequence, quarter, JOBTYP) %>% 
  # percentage per quarter
  mutate(percentage = count/sum(count)) %>% 
  filter(!is.na(JOBTYP)) %>%  # omit no answers and no apply
  filter(sk_mm == 1) %>%  #filtering by overqualified
  as_label(.)

```


```{r plot-overqualified-employees-JOBTYP, fig.width = 7, fig.asp = 0.5, out.width = '100%', fig.fullwidth = TRUE, fig.cap= "Workers in non-permanent jobs liketly to be overqualified "}

p_nskills_temp <- t_skills_temp %>% 
  ggplot() + 
  geom_line(aes(x = sequence, y = percentage, colour = factor(JOBTYP)), size = 0.7, show.legend = FALSE) +  
  geom_point(aes(x = sequence, y = percentage, colour = factor(JOBTYP)), shape = 20, show.legend = TRUE) +
  geom_vline(xintercept = 4.5, color = "#c9c9c9") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "#c9c9c9") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "#c9c9c9") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "#c9c9c9") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "#c9c9c9") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "#c9c9c9") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "#c9c9c9") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "#c9c9c9") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "#c9c9c9") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "#c9c9c9") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "#c9c9c9") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "#c9c9c9") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "#c9c9c9") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "#c9c9c9") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "#c9c9c9") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "#c9c9c9") + # gridline 2021

  # scale and colour
  scale_color_discrete_qualitative(palette = "Dark 3") +
  scale_y_continuous(breaks = seq(0,0.5,0.05), limits = c(0, 0.5), labels =
                       scales::percent_format(accuracy = 1L), expand = c(0,0)) +
  scale_x_continuous(breaks=c(1:68), position = "bottom",
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
  # annotation
  labs(x = "", 
       y = "Percentage", 
       #title ="Figure 6. Overqualified workers by work arrangement (percentages and totals)",
       #subtitle  = "",
       #caption = ""
       ) +

  # theme
  annotate('rect', xmin=10, xmax=14, ymin=0, ymax=0.5, alpha=.2, fill='brown1') + # Great Recession
  annotate(geom = "text", x = 10, y = 0.40, label = "Great Recession", hjust = 0, size = 5, colour = "darkred") +
  annotate('rect', xmin=30.5, xmax=31.5, ymin=0, ymax=0.5, alpha=.2, fill='darkgreen') + # back to pre-recession
  annotate(geom = "text", x = 31.2, y = 0.40, label = "UK economy gets back\nto pre-downturn size", hjust = 0, size = 5, colour = "darkgreen", lineheight = .7) +
  annotate('rect', xmin=56.5, xmax=58, ymin=0, ymax=0.5, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 56.5, y = 0.40, label = "Covid-19", hjust = 0, size = 5, colour = "darkred") +
  annotate('rect', xmin=63, xmax=68, ymin=0, ymax=0.5, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 63, y = 0.40, label = "Cost of\nliving crisis", hjust = 0, size = 5, colour = "darkred", lineheight = .7) +
  annotation_custom(copyright) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0, 0.3), "cm"),
        plot.title = element_text(size = 15, margin = ggplot2::margin(0, 0, 0, 0)),
        plot.subtitle = element_text(size = 13, hjust = 1, margin = ggplot2::margin(0, 0, 4, 0), colour = "gray50"),
        plot.caption = element_text(size = 12, hjust = 1, margin = ggplot2::margin(0, 0, 2, 0), colour = "gray50"),
        axis.title.x = element_text(margin = ggplot2::margin(t = 10), size = 13),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 13),
        axis.text.x = element_text(size = 14, margin = margin(t = 2)),
        axis.text.y = element_text(size = 14),
        axis.text.y.left = element_text(margin = margin(r = 4)),
        axis.ticks.length.x = unit(0.1, "cm"), 
        legend.position = "top", 
        legend.title = element_blank(),
        legend.text = element_text(size = 15),
        panel.spacing = unit(.2, "cm"),
        panel.grid.major = element_line(color = "gray90", linewidth = .06)) +
  guides(col = guide_legend(nrow = 1, byrow = TRUE, override.aes = list(size = 6)))

p_nskills_temp

```

## Zero-hours contracts

<p align="justify">Economic crisis could lead employees working in positions that require lower qualifications than those they have and accept more precarious working arrangements to avoid unemployment. As Figure \@ref(fig:plot-overqualified-fled) show, un the UK this can be observed in the increase of flexible employment arrangements, in which the proportion of overqualified workers with zero-hours contracts has significantly increased during the cost-of-living crisis.</p>

```{r overqualified-table-fled, include=FALSE}

# 7 "On call working" is not presente before 2010

# "Flexi-time" = 1,
# "Annualised hours contract" = 2,
# "Term-time working" = 3,
# "Job sharing" = 4,
# "Condensed or compressed hours" = 5,
# "Zero hours contract" = 6, 
# "On call working" = 7,
# "None of these" = 8

options(digits = 3)

t_nskills_fled <- LFS_clean %>% # summary table
  filter(!sequence %in% c(1, 3, 5, 7, 9, 13, 17, 19, 21, 23, 
                        25, 27, 31, 33, 35, 37, 39, 41, 43,
                        45, 47, 49, 51, 53, 55)) %>%
  filter(AGE >= 18 & AGE <= 64) %>% 
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c(1, 2)) %>% #only employees and self-employed
  filter(FTPTWK == 2) %>% # only part-timers
  group_by(year, sequence, quarter, FLED, sk_mm) %>% 
  summarise(count = sum(PWT)) %>% 
  group_by(year, sequence, quarter, FLED) %>% 
  # percentage part-time per quarter
  mutate(percentage = count/sum(count)) %>% 
  filter(!is.na(FLED) & !FLED %in% c(5, 7, 8)) %>%  # omit compressed, none, and on call
  filter(sk_mm == 1) %>%  #filtering by overqualified
  as_label(.)

```

```{r plot-overqualified-fled, fig.width = 7, fig.asp = 0.5, out.width = '100%', fig.fullwidth = TRUE, fig.cap= "Zero-hours workers are more likely to be overqualified"}

p_nskills_fled <- t_nskills_fled %>% 
  ggplot(aes(x = sequence, y = percentage, colour = factor(FLED))) + 
  geom_line(linewidth = 0.7, show.legend = FALSE) +  
  geom_point(size = 1, shape = 20, show.legend = TRUE) +
  geom_vline(xintercept = 4.5, color = "#c9c9c9") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "#c9c9c9") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "#c9c9c9") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "#c9c9c9") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "#c9c9c9") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "#c9c9c9") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "#c9c9c9") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "#c9c9c9") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "#c9c9c9") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "#c9c9c9") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "#c9c9c9") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "#c9c9c9") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "#c9c9c9") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "#c9c9c9") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "#c9c9c9") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "#c9c9c9") + # gridline 2021

  # scale and colour
  scale_color_discrete_qualitative(palette = "Dynamic") +
  scale_y_continuous(breaks = seq(0,1, 0.1), limits = c(0, 1), labels =
                       scales::percent_format(accuracy = 1L), expand = c(0,0)) +
  scale_x_continuous(breaks=c(1:68), 
                     labels=c("","","2006","",
                              "","2007","","",
                              "","2008","","",
                              "","2009","","",
                              "","2010","","",
                              "","2011","","",
                              "","2012","","",
                              "","2013","","",
                              "","2014","","",
                              "","2015","","",
                              "","2016","","",
                              "","2017","","",
                              "","2018","","",
                              "","2019","","",
                              "","2020","","",
                              "","2021","","",
                              "","2022","",""),
                     expand = c(0,0)) +

   # annotation
  labs(x = "", 
       y = "Percentage", 
       #title ="",
       #subtitle  = "",
       caption = c("Note: Could not find a full-time job as a percentage of part-time workers in the category")
       ) +
  annotate('rect', xmin=10, xmax=14, ymin=0, ymax=1, alpha=.2, fill='brown1') + # Great Recession
  annotate(geom = "text", x = 10, y = 0.80, label = "Great Recession", hjust = 0, size = 5, colour = "darkred") +
  annotate('rect', xmin=30.5, xmax=31.5, ymin=0, ymax=1, alpha=.2, fill='darkgreen') + # back to pre-recession
  annotate(geom = "text", x = 31.2, y = 0.80, label = "UK economy gets back\nto pre-downturn size", hjust = 0, size = 5, colour = "darkgreen", lineheight = .7) +
  annotate('rect', xmin=56.5, xmax=58, ymin=0, ymax=1, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 56.5, y = 0.80, label = "Covid-19", hjust = 0, size = 5, colour = "darkred") +
  annotate('rect', xmin=63, xmax=68, ymin=0, ymax=1, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 63, y = 0.80, label = "Cost of\nliving crisis", hjust = 0, size = 5, colour = "darkred", lineheight = .7) +
  annotation_custom(copyright) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0, 0.3), "cm"),
        plot.title = element_text(size = 15, margin = ggplot2::margin(0, 0, 0, 0)),
        plot.subtitle = element_text(size = 13, hjust = 1, margin = ggplot2::margin(0, 0, 4, 0), colour = "gray50"),
        plot.caption = element_text(size = 12, hjust = 1, margin = ggplot2::margin(0, 0, 2, 0), colour = "gray50"),
        axis.title.x = element_text(margin = ggplot2::margin(t = 10), size = 13),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 13),
        axis.text.x = element_text(size = 14, margin = margin(t = 2)),
        axis.text.y = element_text(size = 14),
        axis.text.y.left = element_text(margin = margin(r = 4)),
        axis.ticks.length.x = unit(0.1, "cm"), 
        legend.position = "top", 
        legend.title = element_blank(),
        legend.text = element_text(size = 15),
        panel.spacing = unit(.2, "cm"),
        panel.grid.major = element_line(color = "gray90", linewidth = .06)) +
  guides(col = guide_legend(nrow = 1, byrow = TRUE, override.aes = list(size = 6)))

p_nskills_fled

```


## Regional trends

<p align="justify">Figure \@ref(fig:plot-skills-overqualified-employees-region) shows that the mismatch between skills and job requirements have increased steady in all regions. Scotland (including Glasgow) shows a slightly higher proportion of overqualified workers in most periods between 2006 and 2022 while the East Midlands (including Nottingham) currently has one of the lowest levels of skills-related underemployment in the UK.</p>   

```{r overqualification-by-region-table, include=FALSE}

LFS_clean <- LFS_clean %>% mutate(GOVTOF3 = case_match(GOVTOF2, 
                                            1 ~ "Rest of England",
                                            2 ~ "North West", 
                                            4 ~ "Rest of England",
                                            5 ~ "East Midlands", 
                                            6 ~ "Rest of England", 
                                            7 ~ "Rest of England",
                                            8 ~ "Rest of England", 
                                            9 ~ "Rest of England",
                                            10 ~ "South West",
                                            11 ~ "Wales",
                                            12 ~ "Scotland",
                                            13 ~ "Northern Ireland")) %>% 
                                                as_numeric(., keep.labels = TRUE)

LFS_clean$GOVTOF3 <- set_labels(LFS_clean$GOVTOF3, labels = c(
                                                      "East Midlands (incl. Nottingham)" = 1,
                                                      "North West (incl. Salford)" = 2, 
                                                      "Northern Ireland" = 3,
                                                      "Rest of England" = 4, 
                                                      "Scotland (incl. Glasgow)" = 5, 
                                                      "South West (incl. Bristol)" = 6,
                                                      "Wales" = 7))


options(digits = 3)

t_skills_region <- LFS_clean %>% # summary table
  filter(AGE >= 18 & AGE <= 64) %>% 
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c(1, 2)) %>% #only employees and self-employed
  group_by(year, sequence, quarter, GOVTOF3,sk_mm) %>% 
  summarise(count = sum(PWT)) %>% 
  group_by(year, sequence, quarter, GOVTOF3) %>% 
  # percentage per quarter
  mutate(percentage = count/sum(count)) %>% 
  filter(!is.na(GOVTOF3)) %>%  # omit no answers and no apply
  filter(sk_mm == 1) %>%  #filtering by overqualified
  as_label(.)

```


```{r plot-skills-overqualified-employees-region, fig.width = 7.5, fig.asp = 0.6, out.width = '100%', fig.fullwidth = TRUE, fig.cap= "The mismatch between skills and job requirements have increased steady in all regions"}

p_nskills_region <- t_skills_region %>% 
  ggplot() + 
  geom_line(aes(x = sequence, y = percentage, colour = factor(GOVTOF3)), size = 0.7, show.legend = FALSE) +  
  geom_point(aes(x = sequence, y = percentage, colour = factor(GOVTOF3)), shape = 20, show.legend = TRUE) +
  geom_vline(xintercept = 4.5, color = "#c9c9c9") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "#c9c9c9") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "#c9c9c9") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "#c9c9c9") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "#c9c9c9") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "#c9c9c9") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "#c9c9c9") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "#c9c9c9") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "#c9c9c9") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "#c9c9c9") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "#c9c9c9") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "#c9c9c9") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "#c9c9c9") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "#c9c9c9") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "#c9c9c9") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "#c9c9c9") + # gridline 2021

  # scale and colour
  scale_color_discrete_qualitative(palette = "Dark 3") +
  scale_y_continuous(breaks = seq(0,0.30,0.02), limits = c(0, 0.30), labels =
                       scales::percent_format(accuracy = 1L), expand = c(0,0)) +
  scale_x_continuous(breaks=c(1:68), position = "top",
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
  # annotation
  labs(x = "", 
       y = "Percentage", 
       #title ="Figure 8. Overqualified workers by region (percentages and totals)",
       #subtitle  = "",
       #caption = ""
       ) +
  annotate('rect', xmin=10, xmax=14, ymin=0, ymax=0.3, alpha=.2, fill='brown1') + # Great Recession
  annotate(geom = "text", x = 10, y = 0.22, label = "Great Recession", hjust = 0, size = 5, colour = "darkred") +
  annotate('rect', xmin=30.5, xmax=31.5, ymin=0, ymax=0.3, alpha=.2, fill='darkgreen') + # back to pre-recession
  annotate(geom = "text", x = 31.2, y = 0.22, label = "UK economy gets back\nto pre-downturn size", hjust = 0, size = 5, colour = "darkgreen", lineheight = .7) +
  annotate('rect', xmin=56.5, xmax=58, ymin=0, ymax=0.3, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 56.5, y = 0.22, label = "Covid-19", hjust = 0, size = 5, colour = "darkred") +
  annotate('rect', xmin=63, xmax=68, ymin=0, ymax=0.3, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 63, y = 0.22, label = "Cost of\nliving crisis", hjust = 0, size = 5, colour = "darkred", lineheight = .7) +
  annotation_custom(copyright) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0, 0.3), "cm"),
        plot.title = element_text(size = 15, margin = ggplot2::margin(0, 0, 0, 0)),
        plot.subtitle = element_text(size = 13, hjust = 1, margin = ggplot2::margin(0, 0, 0, 0), colour = "gray50"),
        plot.caption = element_text(size = 12, hjust = 1, margin = ggplot2::margin(0, 0, 4, 0), colour = "gray50"),
        axis.title.x = element_text(margin = ggplot2::margin(t = 10), size = 13),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 13),
        axis.text.x = element_text(size = 14, margin = margin(t = 2)),
        axis.text.y = element_text(size = 14),
        axis.text.y.left = element_text(margin = margin(r = 4)),
        axis.ticks.length.x = unit(0.1, "cm"), 
        legend.position = "top", 
        legend.title = element_blank(),
        legend.text = element_text(size = 15),
        panel.spacing = unit(.2, "cm"),
        panel.grid.major = element_line(color = "gray90", linewidth = .06)) +
  guides(col = guide_legend(nrow = 2, byrow = TRUE, override.aes = list(size = 6)))

p_nskills_region

```


## Industry trends 

<p align="justify"> During this period, the proportion of overqualified employees has steadily increased in the six industries related to the provision of services. In this regard, the Hospitality (accommodation and food service) has been the industry with the highest increase of employees with a qualification higher than the one required in their jobs (Figure \@ref(fig:plot-overqualification-ind1)).</p> 


```{r overqualification-by-industry-sector-table, include=FALSE}

options(digits = 3)

t_skills_ind1 <- LFS_clean %>% # summary table
  filter(AGE >= 18 & AGE <= 64) %>% 
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c(1, 2)) %>% #only employees and self-employed
  group_by(year, sequence, quarter, ind1,sk_mm) %>% 
  summarise(count = sum(PWT)) %>% 
  group_by(year, sequence, quarter, ind1) %>% 
  # percentage per quarter
  mutate(percentage = count/sum(count)) %>% 
  filter(!is.na(ind1) & ind1 %in% c(7, 17, 11, 16, 10, 9)) %>%  # omit no answers and no apply
  filter(sk_mm == 1) %>%  #filtering by overqualified
  as_label(.)

```


```{r plot-overqualification-ind1, fig.width = 7.5, fig.asp = 0.6, out.width = '100%', fig.fullwidth = TRUE, fig.cap= "Involuntary part-time is concentrated in the Retail and Hospitality sectors"}

p_skills_ind1 <- t_skills_ind1 %>% 
  ggplot(aes(x = sequence, y = percentage, colour = factor(ind1))) + 
  geom_line(size = 0.7, show.legend = FALSE) +  
  geom_point(size = 1, shape = 20, show.legend = TRUE) +
  geom_vline(xintercept = 4.5, color = "#c9c9c9") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "#c9c9c9") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "#c9c9c9") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "#c9c9c9") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "#c9c9c9") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "#c9c9c9") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "#c9c9c9") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "#c9c9c9") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "#c9c9c9") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "#c9c9c9") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "#c9c9c9") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "#c9c9c9") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "#c9c9c9") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "#c9c9c9") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "#c9c9c9") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "#c9c9c9") + # gridline 2021

  # scale and colour
  scale_color_discrete_qualitative(palette = "Dark 3") +
  scale_y_continuous(breaks = seq(0,1, 0.1), limits = c(0, 1), labels =
                       scales::percent_format(accuracy = 1L), expand = c(0,0)) +
  scale_x_continuous(breaks=c(1:68), 
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
  # annotation
  labs(x = "", 
       y = "Percentage", 
       #title ="",
       #subtitle  = "",
       caption = c("Note: Could not find a full-time job as a percentage of part-time workers in the category")
       ) +
  annotate('rect', xmin=10, xmax=14, ymin=0, ymax=1, alpha=.2, fill='brown1') + # Great Recession
  annotate(geom = "text", x = 10, y = 0.80, label = "Great Recession", hjust = 0, size = 5, colour = "darkred") +
  annotate('rect', xmin=30.5, xmax=31.5, ymin=0, ymax=1, alpha=.2, fill='darkgreen') + # back to pre-recession
  annotate(geom = "text", x = 31.2, y = 0.80, label = "UK economy gets back\nto pre-downturn size", hjust = 0, size = 5, colour = "darkgreen", lineheight = .7) +
  annotate('rect', xmin=56.5, xmax=58, ymin=0, ymax=1, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 56.5, y = 0.80, label = "Covid-19", hjust = 0, size = 5, colour = "darkred") +
  annotate('rect', xmin=63, xmax=68, ymin=0, ymax=1, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 63, y = 0.80, label = "Cost of\nliving crisis", hjust = 0, size = 5, colour = "darkred", lineheight = .7) +
  annotation_custom(copyright) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0, 0.3), "cm"),
        plot.title = element_text(size = 15, margin = ggplot2::margin(0, 0, 0, 0)),
        plot.subtitle = element_text(size = 13, hjust = 1, margin = ggplot2::margin(0, 0, 4, 0), colour = "gray50"),
        plot.caption = element_text(size = 12, hjust = 1, margin = ggplot2::margin(0, 0, 2, 0), colour = "gray50"),
        axis.title.x = element_text(margin = ggplot2::margin(t = 10), size = 13),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 13),
        axis.text.x = element_text(size = 14, margin = margin(t = 2)),
        axis.text.y = element_text(size = 14),
        axis.text.y.left = element_text(margin = margin(r = 4)),
        axis.ticks.length.x = unit(0.1, "cm"), 
        legend.position = "top", 
        legend.title = element_blank(),
        legend.text = element_text(size = 15),
        panel.spacing = unit(.2, "cm"),
        panel.grid.major = element_line(color = "gray90", linewidth = .06)) +
  guides(col = guide_legend(nrow = 3, byrow = TRUE, override.aes = list(size = 5)))

p_skills_ind1

```

