
```{r setup-3, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
	warning = FALSE,
  embed_fonts = TRUE,
  fig.fullwidth = TRUE,
  fig.align = "center",
  use_bookdown= TRUE,
  toc= TRUE,
  toc_depth= 4
)
```

```{r libraries-3, include=FALSE}

#### packages needed
if(!require(tidyverse)) install.packages("tidyverse", repos = "http://cran.us.r-project.org")
if(!require(gridExtra)) install.packages("girdExtra", repos = "http://cran.us.r-project.org")
if(!require(Hmisc)) install.packages("Hmisc", repos = "http://cran.us.r-project.org")
if(!require(sjlabelled)) install.packages("sjlabelled", repos = "http://cran.us.r-project.org")
if(!require(ggthemes)) install.packages("ggthemes", repos = "http://cran.us.r-project.org")
if(!require(ggtext)) install.packages("ggtext", repos = "http://cran.us.r-project.org")
if(!require(ggrepel)) install.packages("ggrepel", repos = "http://cran.us.r-project.org")
if(!require(doBy)) install.packages("doBy", repos = "http://cran.us.r-project.org")
if(!require(sjmisc)) install.packages("sjmisc", repos = "http://cran.us.r-project.org")
if(!require(webshot)) install.packages("webshot", repos = "http://cran.us.r-project.org")
if(!require(scales)) install.packages("scales", repos = "http://cran.us.r-project.org")
if(!require(ggalt)) install.packages("ggalt", repos = "http://cran.us.r-project.org")
if(!require(janitor)) install.packages("janitor", repos = "http://cran.us.r-project.org")
if(!require(bookdown)) install.packages("bookdown", repos = "http://cran.us.r-project.org")
if(!require(htmlwidgets)) install.packages("htmlwidgets", repos = "http://cran.us.r-project.org")
if(!require(widgetframe)) install.packages("widgetframe", repos = "http://cran.us.r-project.org")
if(!require(officer)) install.packages("officer", repos = "http://cran.us.r-project.org")
if(!require(showtext)) install.packages("showtext", repos = "http://cran.us.r-project.org")
if(!require(colorspace)) install.packages("colorspace", repos = "http://cran.us.r-project.org")
if(!require(patchwork)) install.packages("patchwork", repos = "http://cran.us.r-project.org")
if(!require(ggpubr)) install.packages("ggpubr", repos = "http://cran.us.r-project.org")
if(!require(gt)) install.packages("gt", repos = "http://cran.us.r-project.org")
if(!require(htmltools)) install.packages("htmltools", repos = "http://cran.us.r-project.org")
if(!require(yaml)) install.packages("yaml", repos = "http://cran.us.r-project.org")
if(!require(grid)) install.packages("grid", repos = "http://cran.us.r-project.org")
if(!require(sjstats)) install.packages("sjstats", repos = "http://cran.us.r-project.org")
if(!require(RColorBrewer)) install.packages("RColorBrewer", repos = "http://cran.us.r-project.org")
if(!require(see)) install.packages("see", repos = "http://cran.us.r-project.org")

library(see) # colorblind-friendly ‘Okabe-Ito’ palette
library(ggalt) # contingency table
library(tidyverse) # several tools for data manipulation
library(haven) # read SPSS, Stata, and SAS data
library(gridExtra) # arrange multiple grid-based plots on a page
library(Hmisc) # many functions useful for data analysis
library(sjmisc) # useful to set Na's
library(sjlabelled) # get_labels function
library(ggthemes) # themes for ggplot2
library(ggtext) # fancy text
library(ggrepel) # help with the position of the labels on ggplot2 graph
library(doBy) # 'do' something to data stratified 'by' some variables
library(scales) # add scale symbols and colour to axis
library(janitor) # add totals to tables
library(bookdown) # add totals to tables
library(htmlwidgets)
library(widgetframe)
library(colorspace) # colour blind friendly pallettes 
library(RColorBrewer)
library(officer) # to add additional formatting to tables 
library(patchwork) # to put graphs side by side
library(ggpubr) # easy-to-use functions for creating and customizing ‘ggplot2’- based publication ready plots.
library(gt) #  creation of interactive data tables
library(htmltools) # tools for creating, manipulating, and writing HTML 
library(sjstats) # add weights 
library(grid)
library(webshot)
library(yaml)
library(showtext)
  font_add_google("Lato")
  showtext_auto()
  
```

```{r load-data-3, include=FALSE}

load("../../data/LFS_clean.rda")

```


```{r copyright-3, include=FALSE}

# top left
copyright = grobTree(textGrob("(c) The Underemployment Project\n      underemployment.info", x=0.008, y= 0.94, hjust=0, gp=gpar(col="gray40", fontsize=8, lineheight = .6, fill="white", alpha = 1))) 

# top right
copyright2 = grobTree(textGrob("(c) The Underemployment Project\n      underemployment.info", x=0.99, y= 0.94, hjust=1, gp=gpar(col="gray40", fontsize=8, lineheight = .6, fill="white", alpha = 1))) 

# bottom left 
copyright3 = grobTree(textGrob("(c) The Underemployment Project\n      underemployment.info", x=0.008, y= 0.05, hjust=0, gp=gpar(col="gray40", fontsize=8, lineheight = .6, fill="white", alpha = 1))) 

```


# Wage-related underemployment

<p align="justify">Wage-related underemployment occurs when workers are underpaid for the work that they are doing. This is a complex notion. It is not typically reported in national statistics, and there is no one standard method for its estimation. We measure wage-related underemployment as being underpaid in comparison to other employees in the same occupation. An underpaid employee is defined as someone earning wages at least 20% lower than the median in their occupational category (See [Technical Appendix 4: Wage-related underemployment] for details).</p> 


## Wage-related underemployment by sex

<p align="justify">Female employees are more likely to be underpaid than are male. Figure \@ref(fig:plot-underpaid-sex) shows the underpayment rate and totals for women and men: underpayment levels stood at just above 20% for men and just below 30% for women in most time periods. However, almost a third (32%) of women were underpaid in April/June 2020. The highest wage-underemployment level for men reached 24% (in April/June 2010). This rate represented a difference of up to 960,516 more underpaid female than male employees in the UK.</p> 

```{r underpaid-sex-table, include=FALSE}

options(digits = 3)

t_underpaid_sex1 <- LFS_clean %>% # summary table for totals by gender
  filter(AGE >= 18 & AGE <= 64) %>% 
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c("1")) %>% #only employees
  filter(HOURPAY > 0 & HOURPAY < 100) %>% # Average gross hourly pay
  filter(!is.na(occu1)) %>%
  group_by(year, sequence, quarter, occu1) %>%
  summarise(Men = sum(PIWT[SEX == 1]),
            Women = sum(PIWT[SEX == 2]),
            ) %>%
  pivot_longer(c(Men, Women), names_to = "SEX", values_to = "total") %>% 
  select(year, sequence, quarter, occu1, SEX, total) %>% 
  as_label(.)

t_underpaid_sex2 <- LFS_clean %>% # summary table for underpaid totals by gender
  filter(AGE >= 18 & AGE <= 64) %>% 
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c("1")) %>% #only employees
  filter(HOURPAY > 0 & HOURPAY < 100) %>% # Average gross hourly pay
  filter(!is.na(occu1)) %>%
  group_by(year, sequence, quarter, occu1) %>%
  summarise(median_underpaid_total = (weighted_median(HOURPAY, weights = PIWT))*0.8,
            Men = sum(PIWT[SEX == 1 & HOURPAY <= median_underpaid_total]),
            Women = sum(PIWT[SEX == 2 & HOURPAY <= median_underpaid_total]),
            ) %>%
  pivot_longer(c(Men, Women), names_to = "SEX", values_to = "underpaid") %>%  
  select(year, sequence, quarter, occu1, SEX, underpaid) %>%
  as_label(.)

t_underpaid_sex <- left_join(t_underpaid_sex1, t_underpaid_sex2, by = c("year", "sequence", "quarter", "occu1", "SEX")) %>% 
  group_by(year, sequence, quarter, SEX) %>% 
  summarise(total = sum(total),
            underpaid = sum(underpaid),
            percentage = underpaid/total) 

rm(t_underpaid_sex1, t_underpaid_sex2)


```


```{r plot-underpaid-sex, fig.width = 7.5, fig.asp = 0.7, out.width = '100%', fig.cap= "Female employees are the most affected by wage-related underemployment"}

p_underpaid_sex_rate <- t_underpaid_sex %>%
  ggplot(aes(x = sequence, y = percentage, colour = factor(SEX))) + 
  geom_line(size = 0.7, show.legend = FALSE) +  
  geom_point(size = 1, shape = 20, show.legend = TRUE) +
  geom_vline(xintercept = 4.5, color = "gray80") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "gray80") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "gray80") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "gray80") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "gray80") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "gray80") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "gray80") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "gray80") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "gray80") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "gray80") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "gray80") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "gray80") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "gray80") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "gray80") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "gray80") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "gray80") + # gridline 2021

  # scale and colour
  #scale_color_discrete_qualitative(palette = "Dark 3") +
  scale_colour_okabeito(palette = "full") + 
  scale_y_continuous(breaks = seq(0,1, 0.1), limits = c(0, 1), labels =
                       scales::percent_format(accuracy = 1L), expand = c(0,0)) +
  scale_x_continuous(breaks=c(1:68), position = "top",
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
    # annotation
  labs(x = "", 
       y = "Underpaid rate", 
       #title ="",
       #subtitle  = "",
       #caption = c(")
       ) +
  annotate('rect', xmin=10, xmax=14, ymin=0, ymax=1, alpha=.2, fill='brown1') + # Great Recession
  annotate(geom = "text", x = 10, y = 0.75, label = "Great Recession", hjust = 0, size = 5, colour = "darkred") +
  annotate('rect', xmin=30.5, xmax=31.5, ymin=0, ymax=1, alpha=.2, fill='darkgreen') + # back to pre-recession
  annotate(geom = "text", x = 31.2, y = 0.75, label = "UK economy gets back\nto pre-downturn size", hjust = 0, size = 5, colour = "darkgreen", lineheight = .6) +
  annotate('rect', xmin=56.5, xmax=58, ymin=0, ymax=1, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 56.5, y = 0.75, label = "Covid-19\nrecession", hjust = 0, size = 5, colour = "darkred", lineheight = .6) +
  annotate('rect', xmin=63, xmax=68, ymin=0, ymax=1, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 63, y = 0.75, label = "Cost of\nliving crisis", hjust = 0, size = 5, colour = "darkred", lineheight = .6) +
  annotation_custom(copyright) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0.3, 0.3), "cm"),
        plot.title = element_text(size = 15, margin = ggplot2::margin(0, 0, 0, 0)),
        plot.subtitle = element_text(size = 13, hjust = 0, margin = ggplot2::margin(0, 0, 0, 0), colour = "gray50"),
        plot.caption = element_text(size = 12, hjust = 1, margin = ggplot2::margin(4, 0, 5, 0), colour = "gray50"),
        axis.title.x = element_text(margin = ggplot2::margin(t = 10), size = 13),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 13),
        axis.text.x = element_text(size = 14, margin = margin(t = 2)),
        axis.text.y = element_text(size = 14),
        axis.text.y.left = element_text(margin = margin(r = 4)),
        axis.ticks.length.x = unit(0.1, "cm"), 
        legend.position = "none", 
        legend.title = element_blank(),
        legend.text = element_text(size = 14),
        panel.spacing = unit(.2, "cm"),
        panel.grid.major = element_line(color = "gray90", linewidth = .06)) +
  guides(col = guide_legend(nrow = 1, byrow = TRUE, override.aes = list(size = 5)))


p_underpaid_sex_total <- t_underpaid_sex %>%
  ggplot() + 
  geom_bar(aes(x = sequence, y = underpaid, fill = factor(SEX)), stat="identity", position = "dodge", width=0.8) +  
  geom_vline(xintercept = 4.5, color = "gray80") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "gray80") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "gray80") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "gray80") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "gray80") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "gray80") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "gray80") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "gray80") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "gray80") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "gray80") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "gray80") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "gray80") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "gray80") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "gray80") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "gray80") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "gray80") + # gridline 2021

  # scale and colour
  #scale_fill_discrete_qualitative(palette = "Dark 3") +
  scale_fill_okabeito(palette = "full") + 
  scale_y_continuous(breaks = seq(0,5000000, 500000), limits = c(0, 5000000), labels = comma, expand = c(0,0)) +
  scale_x_continuous(breaks=c(1:68),
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
  # annotation
  labs(x = "", 
       y = "Underpaid total", 
       #title ="",
       #subtitle  = "",
       caption = c("Note: Based on the percentage of employees with wages equal or below 20% of the median hourly wage in the occupational track")
       ) +
  annotate('rect', xmin=10, xmax=14, ymin=0, ymax=5000000, alpha=.2, fill='brown1') + # Great Recession
  annotate(geom = "text", x = 10, y = 4500000, label = "Great Recession", hjust = 0, size = 5, colour = "darkred") +
  annotate('rect', xmin=30.5, xmax=31.5, ymin=0, ymax=5000000, alpha=.2, fill='darkgreen') + # back to pre-recession
  annotate(geom = "text", x = 31.2, y = 4500000, label = "UK economy gets back\nto pre-downturn size", hjust = 0, size = 5, colour = "darkgreen", lineheight = .7) +
  annotate('rect', xmin=56.5, xmax=58, ymin=0, ymax=5000000, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 56.5, y = 4500000, label = "Covid-19\nrecession", hjust = 0, size = 5, colour = "darkred", lineheight = .7) +
  annotate('rect', xmin=63, xmax=68, ymin=0, ymax=5000000, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 63, y = 4500000, label = "Cost of\nliving crisis", hjust = 0, size = 5, colour = "darkred", lineheight = .7) +
  annotation_custom(copyright) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0.4, 0.3), "cm"),
        plot.title = element_text(size = 15, margin = ggplot2::margin(0, 0, 0, 0)),
        plot.subtitle = element_text(size = 13, hjust = 0, margin = ggplot2::margin(0, 0, 0, 0), colour = "gray50"),
        plot.caption = element_text(size = 12, hjust = 1, margin = ggplot2::margin(0, 0, 0, 0), colour = "gray50"),
        axis.title.x = element_text(margin = ggplot2::margin(t = 10), size = 13),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 13),
        axis.text.x = element_text(size = 14, margin = margin(t = 2)),
        axis.text.y = element_text(size = 14),
        axis.text.y.left = element_text(margin = margin(r = 4)),
        axis.ticks.length.x = unit(0.1, "cm"), 
        legend.position = "top", 
        legend.title = element_blank(),
        legend.text = element_text(size = 14),
        panel.spacing = unit(.2, "cm"),
        panel.grid.major = element_line(color = "gray90", linewidth = .06)) +
  guides(col = guide_legend(nrow = 1, byrow = TRUE, override.aes = list(size = 5)))

p_underpaid_sex_rate / p_underpaid_sex_total

```


## Wage-related underemployment by age group

<p align="justify">Figure \@ref(fig:plot-underpaid-age) shows that younger employees are by far the most affected by wage-related underemployment. This is particularly the case for employees between 18 to 24 who experience rates approaching and even above 50% in some periods. Yet other age groups are not fully protected against being underpaid either: levels of a fifth or more of wage-underemployment persist among the older workforce.</p>

```{r underpaid-by-age-table, include=FALSE}

options(digits = 3)

t_underpaid_age1 <- LFS_clean %>% # summary table
  filter(AGE >= 18 & AGE <= 64) %>% 
  #creating age categories
  mutate(AGE_cat = case_when(AGE %in% 18:24 ~ "Aged 18 to 24",
                             AGE %in% 25:34 ~ "Aged 25 to 34",
                             AGE %in% 35:44 ~ "Aged 35 to 44",
                             AGE %in% 45:54 ~ "Aged 45 to 54",
                             AGE %in% 55:64 ~ "Aged 55 to 64",
                             is.na(AGE) ~ NA)) %>%
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c("1")) %>% #only employees
  filter(HOURPAY > 0 & HOURPAY < 100) %>% # Average gross hourly pay
  filter(!is.na(occu1)) %>%
  group_by(year, sequence, quarter, occu1) %>%
  summarise("Aged 18 to 24" = sum(PIWT[AGE_cat == "Aged 18 to 24"]),
            "Aged 25 to 34" = sum(PIWT[AGE_cat == "Aged 25 to 34"]),
            "Aged 35 to 44" = sum(PIWT[AGE_cat == "Aged 35 to 44"]),
            "Aged 45 to 54" = sum(PIWT[AGE_cat == "Aged 45 to 54"]),
            "Aged 55 to 64" = sum(PIWT[AGE_cat == "Aged 55 to 64"]),
            ) %>%
  pivot_longer(c("Aged 18 to 24", 
                "Aged 25 to 34",
                "Aged 35 to 44",
                "Aged 45 to 54",
                "Aged 55 to 64"), names_to = "AGE_cat", values_to = "total") %>% 
  select(year, sequence, quarter, occu1, AGE_cat, total) %>% 
  as_label(.)

t_underpaid_age2 <- LFS_clean %>% # summary table
  filter(AGE >= 18 & AGE <= 64) %>% 
  #creating age categories
  mutate(AGE_cat = case_when(AGE %in% 18:24 ~ "Aged 18 to 24",
                             AGE %in% 25:34 ~ "Aged 25 to 34",
                             AGE %in% 35:44 ~ "Aged 35 to 44",
                             AGE %in% 45:54 ~ "Aged 45 to 54",
                             AGE %in% 55:64 ~ "Aged 55 to 64",
                             is.na(AGE) ~ NA)) %>%
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c("1")) %>% #only employees
  filter(HOURPAY > 0 & HOURPAY < 100) %>% # Average gross hourly pay
  filter(!is.na(occu1)) %>%
  group_by(year, sequence, quarter, occu1) %>%
  summarise(median_underpaid_total = (weighted_median(HOURPAY, weights = PIWT))*0.8,
            "Aged 18 to 24" = sum(PIWT[AGE_cat == "Aged 18 to 24" & HOURPAY <= median_underpaid_total]),
            "Aged 25 to 34" = sum(PIWT[AGE_cat == "Aged 25 to 34" & HOURPAY <= median_underpaid_total]),
            "Aged 35 to 44" = sum(PIWT[AGE_cat == "Aged 35 to 44" & HOURPAY <= median_underpaid_total]),
            "Aged 45 to 54" = sum(PIWT[AGE_cat == "Aged 45 to 54" & HOURPAY <= median_underpaid_total]),
            "Aged 55 to 64" = sum(PIWT[AGE_cat == "Aged 55 to 64" & HOURPAY <= median_underpaid_total]),
            ) %>%
  pivot_longer(c("Aged 18 to 24", 
                "Aged 25 to 34",
                "Aged 35 to 44",
                "Aged 45 to 54",
                "Aged 55 to 64"), names_to = "AGE_cat", values_to = "underpaid") %>% 
  select(year, sequence, quarter, occu1, AGE_cat, underpaid) %>% 
  as_label(.)

t_underpaid_age <- left_join(t_underpaid_age1, t_underpaid_age2, by = c("year", "sequence", "quarter", "occu1", "AGE_cat"))

t_underpaid_age <- t_underpaid_age %>% 
  group_by(year, sequence, quarter, AGE_cat) %>% 
  summarise(total = sum(total),
            underpaid = sum(underpaid),
            percentage = underpaid/total) 

rm(t_underpaid_age1, t_underpaid_age2)

```


```{r plot-underpaid-age, fig.width = 7, fig.asp = 0.5, out.width = '100%', fig.fullwidth = TRUE, out.width = '100%', fig.cap= "Employees ages under 25 are more likely to be underpaid"}

p_underpaid_age  <- t_underpaid_age  %>% 
  ggplot(aes(x = sequence, y = percentage, colour = factor(AGE_cat))) + 
  geom_line(linewidth = 0.7, show.legend = FALSE) +  
  geom_point(size = 1, shape = 20, show.legend = TRUE) +
  geom_vline(xintercept = 4.5, color = "#c9c9c9") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "#c9c9c9") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "#c9c9c9") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "#c9c9c9") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "#c9c9c9") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "#c9c9c9") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "#c9c9c9") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "#c9c9c9") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "#c9c9c9") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "#c9c9c9") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "#c9c9c9") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "#c9c9c9") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "#c9c9c9") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "#c9c9c9") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "#c9c9c9") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "#c9c9c9") + # gridline 2021

  # scale and colour
  #scale_color_discrete_qualitative(palette = "Dark 3") +
  scale_colour_okabeito(palette = "full") + 
  scale_y_continuous(breaks = seq(0,1, 0.1), limits = c(0, 1), labels =
                       scales::percent_format(accuracy = 1L), expand = c(0,0)) +
  scale_x_continuous(breaks=c(1:68), position = "bottom",
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
  # annotation
  labs(x = "", 
       y = "Underpaid rate", 
       #title ="",
       #subtitle  = "",
       caption = "Note: Based on the perecentage of employees with wages equal or below 20% of the median hourly wage in the occupational track"
       ) +
  annotate('rect', xmin=10, xmax=14, ymin=0, ymax=1, alpha=.2, fill='brown1') + # Great Recession
  annotate(geom = "text", x = 10, y = 0.90, label = "Great Recession", hjust = 0, size = 5, colour = "darkred") +
  annotate('rect', xmin=30.5, xmax=31.5, ymin=0, ymax=1, alpha=.2, fill='darkgreen') + # back to pre-recession
  annotate(geom = "text", x = 31.2, y = 0.90, label = "UK economy gets back\nto pre-downturn size", hjust = 0, size = 5, colour = "darkgreen", lineheight = .7) +
  annotate('rect', xmin=56.5, xmax=58, ymin=0, ymax=1, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 56.5, y = 0.90, label = "Covid-19\nrecession", hjust = 0, size = 5, colour = "darkred", lineheight = .7) +
  annotate('rect', xmin=63, xmax=68, ymin=0, ymax=1, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 63, y = 0.90, label = "Cost of\nliving crisis", hjust = 0, size = 5, colour = "darkred", lineheight = .7) +
  annotation_custom(copyright) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0, 0.3), "cm"),
        plot.title = element_text(size = 15, margin = ggplot2::margin(0, 0, 0, 0)),
        plot.subtitle = element_text(size = 13, hjust = 1, margin = ggplot2::margin(0, 0, 4, 0), colour = "gray50"),
        plot.caption = element_text(size = 12, hjust = 1, margin = ggplot2::margin(0, 0, 2, 0), colour = "gray50"),
        axis.title.x = element_text(margin = ggplot2::margin(t = 10), size = 13),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 13),
        axis.text.x = element_text(size = 14, margin = margin(t = 2)),
        axis.text.y = element_text(size = 14),
        axis.text.y.left = element_text(margin = margin(r = 4)),
        axis.ticks.length.x = unit(0.1, "cm"), 
        legend.position = "top", 
        legend.title = element_blank(),
        legend.text = element_text(size = 15),
        panel.spacing = unit(.2, "cm"),
        panel.grid.major = element_line(color = "gray90", linewidth = .06)) +
  guides(col = guide_legend(nrow = 1, byrow = TRUE, override.aes = list(size = 6)))

p_underpaid_age 

```


## Wage-related underemployment by ethnic group

<p align="justify">Figure \@ref(fig:plot-underpaid-ethnicity) shows the rate of underpayment among employees according to their ethnic group. Overall, the gap is not large, though the proportion of underpaid minority-ethnic employees is slightly higher than the white majority employees for most periods. Even the small differences reduced after the Covid-19 pandemic hit.</p> 


```{r underpaid-ethnicity-table, include=FALSE}

t_underpaid_eth1 <- LFS_clean %>% # summary table for totals by gender
  filter(AGE >= 18 & AGE <= 64) %>% 
  mutate(ETH2 = case_match(ETH, 
                           1 ~ "White",
                           2 ~ "Minority-ethnic", 
                           3 ~ "Minority-ethnic", 
                           4 ~ "Minority-ethnic", 
                           5 ~ "Minority-ethnic",
                           6 ~ "Minority-ethnic")) %>% 
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c("1")) %>% #only employees
  filter(HOURPAY > 0 & HOURPAY < 100) %>% # Average gross hourly pay
  filter(!is.na(occu1)) %>%
  filter(!is.na(ETH2)) %>%  # remove NAs from the ethnicity variable
  group_by(year, sequence, quarter, occu1) %>%
  summarise("White" = sum(PIWT[ETH2 == "White"]),
            "Minority-ethnic" = sum(PIWT[ETH2== "Minority-ethnic"])
            ) %>%
  pivot_longer(c("White", "Minority-ethnic"), names_to = "ETH", values_to = "total") %>% 
  select(year, sequence, quarter, occu1, ETH, total) %>% 
  as_label(.)

t_underpaid_eth2 <- LFS_clean %>% # summary table for underpaid totals by gender
  filter(AGE >= 18 & AGE <= 64) %>% 
  mutate(ETH2 = case_match(ETH, 
                           1 ~ "White",
                           2 ~ "Minority-ethnic", 
                           3 ~ "Minority-ethnic", 
                           4 ~ "Minority-ethnic", 
                           5 ~ "Minority-ethnic",
                           6 ~ "Minority-ethnic")) %>%   
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c("1")) %>% #only employees
  filter(HOURPAY > 0 & HOURPAY < 100) %>% # Average gross hourly pay
  filter(!is.na(occu1)) %>%
  filter(!is.na(ETH2)) %>%  # remove NAs from the ethnicity variable
  group_by(year, sequence, quarter, occu1) %>%
  summarise(median_underpaid_total = (weighted_median(HOURPAY, weights = PIWT))*0.8,
            "White" = sum(PIWT[ETH2 == "White" & HOURPAY <= median_underpaid_total]),
            "Minority-ethnic" = sum(PIWT[ETH2== "Minority-ethnic" & HOURPAY <= median_underpaid_total]),
            ) %>%
  pivot_longer(c("White", "Minority-ethnic"), names_to = "ETH", values_to = "underpaid") %>% 
  select(year, sequence, quarter, occu1, ETH, underpaid) %>% 
  as_label(.)

t_underpaid_eth <- left_join(t_underpaid_eth1, t_underpaid_eth2, by = c("year", "sequence", "quarter", "occu1", "ETH")) %>% 
  group_by(year, sequence, quarter, ETH) %>% 
  summarise(total = sum(total),
            underpaid = sum(underpaid),
            percentage = underpaid/total) 

rm(t_underpaid_eth1, t_underpaid_eth2)

```


```{r plot-underpaid-ethnicity, fig.width = 7, fig.asp = 0.5, out.width = '100%', fig.fullwidth = TRUE, out.width = '100%', fig.cap= "The proportion of underpaid minority-ethnic employees is slightly higher than their white counterparts"}

p_underpaid_eth  <- t_underpaid_eth  %>% 
  ggplot(aes(x = sequence, y = percentage, colour = ETH)) + 
  geom_line(linewidth = 0.7, show.legend = FALSE) +  
  geom_point(size = 1, shape = 20, show.legend = TRUE) +
  geom_vline(xintercept = 4.5, color = "#c9c9c9") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "#c9c9c9") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "#c9c9c9") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "#c9c9c9") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "#c9c9c9") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "#c9c9c9") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "#c9c9c9") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "#c9c9c9") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "#c9c9c9") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "#c9c9c9") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "#c9c9c9") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "#c9c9c9") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "#c9c9c9") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "#c9c9c9") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "#c9c9c9") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "#c9c9c9") + # gridline 2021

  # scale and colour
  #scale_color_discrete_qualitative(palette = "Dark 3") +
  scale_colour_okabeito(palette = "full") + 
  scale_y_continuous(breaks = seq(0,1, 0.1), limits = c(0, 1), labels =
                       scales::percent_format(accuracy = 1L), expand = c(0,0)) +
  scale_x_continuous(breaks=c(1:68), position = "bottom",
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
  # annotation
  labs(x = "", 
       y = "Underpaid rate", 
       #title =" ",
       #subtitle  = "",
       caption = "Note: Based on the perecentage of employees with wages equal or below 20% of the median hourly wage in the occupational track"
       ) +
  annotate('rect', xmin=10, xmax=14, ymin=0, ymax=1, alpha=.2, fill='brown1') + # Great Recession
  annotate(geom = "text", x = 10, y = 0.75, label = "Great Recession", hjust = 0, size = 5, colour = "darkred") +
  annotate('rect', xmin=30.5, xmax=31.5, ymin=0, ymax=1, alpha=.2, fill='darkgreen') + # back to pre-recession
  annotate(geom = "text", x = 31.2, y = 0.75, label = "UK economy gets back\nto pre-downturn size", hjust = 0, size = 5, colour = "darkgreen", lineheight = .7) +
  annotate('rect', xmin=56.5, xmax=58, ymin=0, ymax=1, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 56.5, y = 0.75, label = "Covid-19\nrecession", hjust = 0, size = 5, colour = "darkred", lineheight = .7) +
  annotate('rect', xmin=63, xmax=68, ymin=0, ymax=1, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 63, y = 0.75, label = "Cost of\nliving crisis", hjust = 0, size = 5, colour = "darkred", lineheight = .7) +
  annotation_custom(copyright) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0, 0.3), "cm"),
        plot.title = element_text(size = 15, margin = ggplot2::margin(0, 0, 0, 0)),
        plot.subtitle = element_text(size = 13, hjust = 1, margin = ggplot2::margin(0, 0, 4, 0), colour = "gray50"),
        plot.caption = element_text(size = 12, hjust = 1, margin = ggplot2::margin(0, 0, 2, 0), colour = "gray50"),
        axis.title.x = element_text(margin = ggplot2::margin(t = 10), size = 13),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 13),
        axis.text.x = element_text(size = 14, margin = margin(t = 2)),
        axis.text.y = element_text(size = 14),
        axis.text.y.left = element_text(margin = margin(r = 4)),
        axis.ticks.length.x = unit(0.1, "cm"), 
        legend.position = "top", 
        legend.title = element_blank(),
        legend.text = element_text(size = 15),
        panel.spacing = unit(.2, "cm"),
        panel.grid.major = element_line(color = "gray90", linewidth = .06),
        legend.spacing = unit(0.2, 'cm')) +
  guides(col = guide_legend(nrow = 1, byrow = TRUE, override.aes = list(size = 6)))

p_underpaid_eth

```


## Wage-related underemployment by qualification level

<p align="justify">Employees with a degree and higher education qualifications are less affected by wage underemployment than are those without a qualification, as Figure \@ref(fig:plot-underpaid-education) shows. Levels for those employees without a qualification during 2022, but show again an increase in its last quarter.</p>


```{r underpaid-table-education, include=FALSE}

options(digits = 3)

t_underpaid_quali1 <- LFS_clean %>% # summary table
  filter(AGE >= 18 & AGE <= 64) %>% 
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c("1")) %>% #only employees
  filter(HOURPAY > 0 & HOURPAY < 100) %>% # Average gross hourly pay
  filter(!is.na(occu1)) %>%
  filter(!is.na(quali) & !quali %in% c("7")) %>% 
  group_by(year, sequence, quarter, occu1) %>%
  summarise("Degree or equivalent" = sum(PIWT[quali == 1]),
            "Higher education" = sum(PIWT[quali == 2]),
            "GCE, A-level or equivalent" = sum(PIWT[quali == 3]),
            "GCSE grades A*-C or equivalent" = sum(PIWT[quali == 4]),
            "Other qualifications" = sum(PIWT[quali == 5]),
            "No qualification" = sum(PIWT[quali == 6])
            ) %>%
  pivot_longer(c("Degree or equivalent",
                 "Higher education",
                 "GCE, A-level or equivalent",
                 "GCSE grades A*-C or equivalent",
                 "Other qualifications",
                 "No qualification"), 
               names_to = "quali", values_to = "total") %>% 
  select(year, sequence, quarter, occu1, quali, total) %>% 
  as_label(.)


t_underpaid_quali2 <- LFS_clean %>% # summary table
  filter(AGE >= 18 & AGE <= 64) %>% 
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c("1")) %>% #only employees
  filter(HOURPAY > 0 & HOURPAY < 100) %>% # Average gross hourly pay
  filter(!is.na(occu1)) %>%
  filter(!is.na(quali) & !quali %in% c("7")) %>% 
  group_by(year, sequence, quarter, occu1) %>%
  summarise(median_underpaid_total = (weighted_median(HOURPAY, weights = PIWT))*0.8,
            "Degree or equivalent" = sum(PIWT[quali == 1 & HOURPAY <= median_underpaid_total]),
            "Higher education" = sum(PIWT[quali == 2 & HOURPAY <= median_underpaid_total]),
            "GCE, A-level or equivalent" = sum(PIWT[quali == 3 & HOURPAY <= median_underpaid_total]),
            "GCSE grades A*-C or equivalent" = sum(PIWT[quali == 4 & HOURPAY <= median_underpaid_total]),
            "Other qualifications" = sum(PIWT[quali == 5 & HOURPAY <= median_underpaid_total]),
            "No qualification" = sum(PIWT[quali == 6 & HOURPAY <= median_underpaid_total])
            ) %>%
  pivot_longer(c("Degree or equivalent",
                 "Higher education",
                 "GCE, A-level or equivalent",
                 "GCSE grades A*-C or equivalent",
                 "Other qualifications",
                 "No qualification"), 
               names_to = "quali", values_to = "underpaid") %>% 
  select(year, sequence, quarter, occu1, quali, underpaid) %>% 
  as_label(.)

t_underpaid_quali <- left_join(t_underpaid_quali1, t_underpaid_quali2, by = c("year", "sequence", "quarter", "occu1", "quali"))

t_underpaid_quali <- t_underpaid_quali %>% 
  group_by(year, sequence, quarter, quali) %>% 
  summarise(total = sum(total),
            underpaid = sum(underpaid),
            percentage = underpaid/total) 

rm(t_underpaid_quali1, t_underpaid_quali2)

```


```{r plot-underpaid-education, fig.width = 7.5, fig.asp = 0.6, out.width = '100%', fig.fullwidth = TRUE, fig.cap= "More employees without qualification are underpaid compared to those with a degree"}

p_underpaid_quali <- t_underpaid_quali %>% 
  ggplot(aes(x = sequence, y = percentage, colour = factor(quali))) + 
  geom_line(linewidth = 0.7, show.legend = FALSE) +  
  geom_point(size = 1, shape = 20, show.legend = TRUE) +
  geom_vline(xintercept = 4.5, color = "#c9c9c9") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "#c9c9c9") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "#c9c9c9") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "#c9c9c9") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "#c9c9c9") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "#c9c9c9") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "#c9c9c9") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "#c9c9c9") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "#c9c9c9") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "#c9c9c9") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "#c9c9c9") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "#c9c9c9") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "#c9c9c9") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "#c9c9c9") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "#c9c9c9") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "#c9c9c9") + # gridline 2021

  # scale and colour
  #scale_color_discrete_qualitative(palette = "Dark 3") +
  scale_colour_okabeito(palette = "full") + 
  scale_y_continuous(breaks = seq(0,1, 0.1), limits = c(0, 1), labels =
                       scales::percent_format(accuracy = 1L), expand = c(0,0)) +
  scale_x_continuous(breaks=c(1:68), 
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
  # annotation
  labs(x = "", 
       y = "Underpaid rate", 
       #title =" ",
       #subtitle  = "",
       caption = c("Note: Based on the perecentage of employees with wages equal or below 20% of the median hourly wage in the occupational track")
       ) +
  annotate('rect', xmin=10, xmax=14, ymin=0, ymax=1, alpha=.2, fill='brown1') + # Great Recession
  annotate(geom = "text", x = 10, y = 0.80, label = "Great Recession", hjust = 0, size = 5, colour = "darkred") +
  annotate('rect', xmin=30.5, xmax=31.5, ymin=0, ymax=1, alpha=.2, fill='darkgreen') + # back to pre-recession
  annotate(geom = "text", x = 31.2, y = 0.80, label = "UK economy gets back\nto pre-downturn size", hjust = 0, size = 5, colour = "darkgreen", lineheight = .7) +
  annotate('rect', xmin=56.5, xmax=58, ymin=0, ymax=1, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 56.5, y = 0.80, label = "Covid-19", hjust = 0, size = 5, colour = "darkred") +
  annotate('rect', xmin=63, xmax=68, ymin=0, ymax=1, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 63, y = 0.80, label = "Cost of\nliving crisis", hjust = 0, size = 5, colour = "darkred", lineheight = .7) +
  annotation_custom(copyright) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0.4, 0.3), "cm"),
        plot.title = element_text(size = 15, margin = ggplot2::margin(0, 0, 0, 0)),
        plot.subtitle = element_text(size = 13, hjust = 1, margin = ggplot2::margin(0, 0, 4, 0), colour = "gray50"),
        plot.caption = element_text(size = 12, hjust = 1, margin = ggplot2::margin(0, 0, 2, 0), colour = "gray50"),
        axis.title.x = element_text(margin = ggplot2::margin(t = 10), size = 13),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 13),
        axis.text.x = element_text(size = 14, margin = margin(t = 2)),
        axis.text.y = element_text(size = 14),
        axis.text.y.left = element_text(margin = margin(r = 4)),
        axis.ticks.length.x = unit(0.1, "cm"), 
        legend.position = "top", 
        legend.title = element_blank(),
        legend.text = element_text(size = 15),
        panel.spacing = unit(.2, "cm"),
        panel.grid.major = element_line(color = "gray90", linewidth = .06)) +
 guides(col = guide_legend(nrow = 2, byrow = TRUE, override.aes = list(size = 6)))

p_underpaid_quali

```


## Wage-related underemployment by occupational group

<p align="justify">As Figure \@ref(fig:plot-underpaid-nsec) show, employees in managerial and professional occupations are more likely to experience wage-related underemployment than are other workers. Routine and semi-routine occupations are also affected, but this dimension of underemployment standards apart from time- and skills-related underemployment where levels were highest among this occupational group.</p>


```{r underpaid-table-nsec, include=FALSE}

options(digits = 3)

t_underpaid_nsec1 <- LFS_clean %>% # summary table
  filter(AGE >= 18 & AGE <= 64) %>% 
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c("1")) %>% #only employees
  filter(HOURPAY > 0 & HOURPAY < 100) %>% # Average gross hourly pay
  filter(!is.na(occu1)) %>%
  filter(!is.na(NSEC2) & !NSEC2 %in% c(3,6)) %>%  # omit no answers and no apply
  group_by(year, sequence, quarter, occu1) %>%
  summarise(
            "Management & professional" = sum(PIWT[NSEC2 == 1]),
            "Intermediate" = sum(PIWT[NSEC2 == 2]),
            "Lower supervisory & technical" = sum(PIWT[NSEC2 == 4]),
            "Routine & semi-routine" = sum(PIWT[NSEC2 == 5]),
            ) %>%
  pivot_longer(c(
                 "Management & professional",
                 "Intermediate",
                 "Lower supervisory & technical",
                 "Routine & semi-routine"), 
               names_to = "nsec", values_to = "total") %>% 
  select(year, sequence, quarter, occu1, nsec, total) %>% 
  as_label(.)

t_underpaid_nsec2 <- LFS_clean %>% # summary table
  filter(AGE >= 18 & AGE <= 64) %>% 
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c("1")) %>% #only employees
  filter(HOURPAY > 0 & HOURPAY < 100) %>% # Average gross hourly pay
  filter(!is.na(occu1)) %>%
  filter(!is.na(NSEC2) & !NSEC2 %in% c(3,6)) %>%  # omit no answers and no apply
  group_by(year, sequence, quarter, occu1) %>%
  summarise(median_underpaid_total = (weighted_median(HOURPAY, weights = PIWT))*0.8,
            "Management & professional" = sum(PIWT[NSEC2 == 1 & HOURPAY <= median_underpaid_total]),
            "Intermediate" = sum(PIWT[NSEC2 == 2 & HOURPAY <= median_underpaid_total]),
            "Lower supervisory & technical" = sum(PIWT[NSEC2 == 4 & HOURPAY <= median_underpaid_total]),
            "Routine & semi-routine" = sum(PIWT[NSEC2 == 5 & HOURPAY <= median_underpaid_total]),
            ) %>%
  pivot_longer(c(
                 "Management & professional",
                 "Intermediate",
                 "Lower supervisory & technical",
                 "Routine & semi-routine"), 
               names_to = "nsec", values_to = "underpaid") %>% 
  select(year, sequence, quarter, occu1, nsec, underpaid) %>% 
  as_label(.)

t_underpaid_nsec <- left_join(t_underpaid_nsec1, t_underpaid_nsec2, by = c("year", "sequence", "quarter", "occu1", "nsec"))

t_underpaid_nsec <- t_underpaid_nsec %>% 
  group_by(year, sequence, quarter, nsec) %>% 
  summarise(total = sum(total),
            underpaid = sum(underpaid),
            percentage = underpaid/total) 

rm(t_underpaid_nsec1, t_underpaid_nsec2)

```


```{r plot-underpaid-nsec, fig.width = 7.5, fig.asp = 0.6, out.width = '100%', fig.fullwidth = TRUE, fig.cap= "Higher proportion of underpaid employees among management and professional occupations"}

p_underpaid_nsec <- t_underpaid_nsec %>% 
  ggplot(aes(x = sequence, y = percentage, colour = nsec)) + 
  geom_line(size = 0.7, show.legend = FALSE) +  
  geom_point(size = 1, shape = 20, show.legend = TRUE) +
  geom_vline(xintercept = 4.5, color = "#c9c9c9") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "#c9c9c9") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "#c9c9c9") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "#c9c9c9") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "#c9c9c9") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "#c9c9c9") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "#c9c9c9") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "#c9c9c9") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "#c9c9c9") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "#c9c9c9") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "#c9c9c9") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "#c9c9c9") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "#c9c9c9") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "#c9c9c9") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "#c9c9c9") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "#c9c9c9") + # gridline 2021

  # scale and colour
  #scale_color_discrete_qualitative(palette = "Dynamic") +
  scale_colour_okabeito(palette = "full") + 
  scale_y_continuous(breaks = seq(0,1, 0.1), limits = c(0, 1), labels =
                       scales::percent_format(accuracy = 1L), expand = c(0,0)) +
  scale_x_continuous(breaks=c(1:68), 
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
  # annotation
  labs(x = "", 
       y = "Underpaid rate", 
       #title ="",
       #subtitle  = "",
       caption = c("Note: Based on the perecentage of employees with wages equal or below 20% of the median hourly wage in the occupational track")
       ) +
  annotate('rect', xmin=10, xmax=14, ymin=0, ymax=1, alpha=.2, fill='brown1') + # Great Recession
  annotate(geom = "text", x = 10, y = 0.80, label = "Great Recession", hjust = 0, size = 5, colour = "darkred") +
  annotate('rect', xmin=30.5, xmax=31.5, ymin=0, ymax=1, alpha=.2, fill='darkgreen') + # back to pre-recession
  annotate(geom = "text", x = 31.2, y = 0.80, label = "UK economy gets back\nto pre-downturn size", hjust = 0, size = 5, colour = "darkgreen", lineheight = .7) +
  annotate('rect', xmin=56.5, xmax=58, ymin=0, ymax=1, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 56.5, y = 0.80, label = "Covid-19", hjust = 0, size = 5, colour = "darkred") +
  annotate('rect', xmin=63, xmax=68, ymin=0, ymax=1, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 63, y = 0.80, label = "Cost of\nliving crisis", hjust = 0, size = 5, colour = "darkred", lineheight = .7) +
  annotation_custom(copyright) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0.4, 0.3), "cm"),
        plot.title = element_text(size = 15, margin = ggplot2::margin(0, 0, 0, 0)),
        plot.subtitle = element_text(size = 13, hjust = 1, margin = ggplot2::margin(0, 0, 4, 0), colour = "gray50"),
        plot.caption = element_text(size = 12, hjust = 1, margin = ggplot2::margin(0, 0, 2, 0), colour = "gray50"),
        axis.title.x = element_text(margin = ggplot2::margin(t = 10), size = 13),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 13),
        axis.text.x = element_text(size = 14, margin = margin(t = 2)),
        axis.text.y = element_text(size = 14),
        axis.text.y.left = element_text(margin = margin(r = 4)),
        axis.ticks.length.x = unit(0.1, "cm"), 
        legend.position = "top", 
        legend.title = element_blank(),
        legend.text = element_text(size = 15),
        panel.spacing = unit(.2, "cm"),
        panel.grid.major = element_line(color = "gray90", linewidth = .06)) +
  guides(col = guide_legend(nrow = 1, byrow = TRUE, override.aes = list(size = 6)))

p_underpaid_nsec


```


## Wage-related underemployment by region

<p align="justify">Wage-related underemployment is high across all UK regions, especially the East Midlands, North West and South West (Figure \@ref(fig:plot-underpaid-region)). Scotland shows slightly lower levels. These regional levels fluctuate greatly over time.</p>


```{r underpaid-table-region, include=FALSE}

LFS_clean <- LFS_clean %>% mutate(GOVTOF3 = case_match(GOVTOF2, 
                                            1 ~ "Rest of England",
                                            2 ~ "North West", 
                                            4 ~ "Rest of England",
                                            5 ~ "East Midlands", 
                                            6 ~ "Rest of England", 
                                            7 ~ "Rest of England",
                                            8 ~ "Rest of England", 
                                            9 ~ "Rest of England",
                                            10 ~ "South West",
                                            11 ~ "Wales",
                                            12 ~ "Scotland",
                                            13 ~ "Northern Ireland")) %>% 
                                                as_numeric(., keep.labels = TRUE)

LFS_clean$GOVTOF3 <- set_labels(LFS_clean$GOVTOF3, labels = c(
                                                      "East Midlands (incl. Nottingham)" = 1,
                                                      "North West (incl. Salford)" = 2, 
                                                      "Northern Ireland" = 3,
                                                      "Rest of England" = 4, 
                                                      "Scotland (incl. Glasgow)" = 5, 
                                                      "South West (incl. Bristol)" = 6,
                                                      "Wales" = 7))

options(digits = 3)

t_underpaid_region1 <- LFS_clean %>% # summary table
  filter(AGE >= 18 & AGE <= 64) %>% 
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c("1")) %>% #only employees
  filter(HOURPAY > 0 & HOURPAY < 100) %>% # Average gross hourly pay
  filter(!is.na(occu1)) %>%
  filter(!GOVTOF3 %in% c(3, 7)) %>%
  group_by(year, sequence, quarter, occu1) %>%
  summarise(
            "East Midlands (incl. Nottingham)" = sum(PIWT[GOVTOF3== 1]),
            "North West (incl. Salford)" = sum(PIWT[GOVTOF3 == 2]),
            "Rest of England" = sum(PIWT[GOVTOF3 == 4]),
            "Scotland (incl. Glasgow)" = sum(PIWT[GOVTOF3 == 5]),
            "South West (incl. Bristol)" = sum(PIWT[GOVTOF3 == 6])
            ) %>%
  pivot_longer(c(
                 "East Midlands (incl. Nottingham)",
                 "North West (incl. Salford)",
                 "Rest of England",
                 "Scotland (incl. Glasgow)",
                 "South West (incl. Bristol)"), 
               names_to = "region", values_to = "total") %>% 
  select(year, sequence, quarter, occu1, region, total) %>% 
  as_label(.)

t_underpaid_region2 <- LFS_clean %>% # summary table
  filter(AGE >= 18 & AGE <= 64) %>% 
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c("1")) %>% #only employees
  filter(HOURPAY > 0 & HOURPAY < 100) %>% # Average gross hourly pay
  filter(!is.na(occu1)) %>%
  filter(!GOVTOF3 %in% c("Northern Ireland","Wales")) %>%
  group_by(year, sequence, quarter, occu1) %>%
  summarise(median_underpaid_total = (weighted_median(HOURPAY, weights = PIWT))*0.8,
            "East Midlands (incl. Nottingham)" = sum(PIWT[GOVTOF3== 1 & HOURPAY <= median_underpaid_total]),
            "North West (incl. Salford)" = sum(PIWT[GOVTOF3 == 2 & HOURPAY <= median_underpaid_total]),
            "Rest of England" = sum(PIWT[GOVTOF3 == 4 & HOURPAY <= median_underpaid_total]),
            "Scotland (incl. Glasgow)" = sum(PIWT[GOVTOF3 == 5 & HOURPAY <= median_underpaid_total]),
            "South West (incl. Bristol)" = sum(PIWT[GOVTOF3 == 6 & HOURPAY <= median_underpaid_total])
            ) %>%
  pivot_longer(c(
                 "East Midlands (incl. Nottingham)",
                 "North West (incl. Salford)",
                 "Rest of England",
                 "Scotland (incl. Glasgow)",
                 "South West (incl. Bristol)"), 
               names_to = "region", values_to = "underpaid") %>% 
  select(year, sequence, quarter, occu1, region, underpaid) %>% 
  as_label(.)

t_underpaid_region <- left_join(t_underpaid_region1, t_underpaid_region2, by = c("year", "sequence", "quarter", "occu1", "region"))

t_underpaid_region <- t_underpaid_region %>% 
  group_by(year, sequence, quarter, region) %>% 
  summarise(total = sum(total),
            underpaid = sum(underpaid),
            percentage = underpaid/total) 

rm(t_underpaid_region1, t_underpaid_region2)

```


```{r plot-underpaid-region, fig.width = 7.5, fig.asp = 0.6, out.width = '100%', fig.fullwidth = TRUE, fig.cap= "All regions affected by wage-related underemployment"}

p_underpaid_region <- t_underpaid_region %>% 
  ggplot(aes(x = sequence, y = percentage, col = region)) + 
  geom_line(linewidth = 0.7, show.legend = FALSE) +  
  geom_point(size = 1, shape = 20, show.legend = TRUE) +
  geom_vline(xintercept = 4.5, color = "#c9c9c9") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "#c9c9c9") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "#c9c9c9") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "#c9c9c9") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "#c9c9c9") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "#c9c9c9") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "#c9c9c9") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "#c9c9c9") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "#c9c9c9") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "#c9c9c9") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "#c9c9c9") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "#c9c9c9") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "#c9c9c9") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "#c9c9c9") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "#c9c9c9") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "#c9c9c9") + # gridline 2021

  # scale and colour
  #scale_color_discrete_qualitative(palette = "Dynamic") +
  scale_colour_okabeito(palette = "full") + 
  scale_y_continuous(breaks = seq(0,0.5, 0.05), limits = c(0, 0.5), labels =
                       scales::percent_format(accuracy = 1L), expand = c(0,0)) +
  scale_x_continuous(breaks=c(1:68), 
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
  # annotation
  labs(x = "", 
       y = "Underpaid rate", 
       #title ="",
       #subtitle  = "",
       caption = c("Note: Could not find a full-time job as a percentage of part-time workers in the region")
       ) +
  annotate('rect', xmin=10, xmax=14, ymin=0, ymax=0.5, alpha=.2, fill='brown1') + # Great Recession
  annotate(geom = "text", x = 10, y = 0.42, label = "Great Recession", hjust = 0, size = 5, colour = "darkred") +
  annotate('rect', xmin=30.5, xmax=31.5, ymin=0, ymax=0.5, alpha=.2, fill='darkgreen') + # back to pre-recession
  annotate(geom = "text", x = 31.2, y = 0.42, label = "UK economy gets back\nto pre-downturn size", hjust = 0, size = 5, colour = "darkgreen", lineheight = .7) +
  annotate('rect', xmin=56.5, xmax=58, ymin=0, ymax=0.5, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 56.5, y = 0.42, label = "Covid-19", hjust = 0, size = 5, colour = "darkred") +
  annotate('rect', xmin=63, xmax=68, ymin=0, ymax=0.5, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 63, y = 0.42, label = "Cost of\nliving crisis", hjust = 0, size = 5, colour = "darkred", lineheight = .7) +
  annotation_custom(copyright) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0, 0.3), "cm"),
        plot.title = element_text(size = 15, margin = ggplot2::margin(0, 0, 0, 0)),
        plot.subtitle = element_text(size = 13, hjust = 1, margin = ggplot2::margin(0, 0, 0, 0), colour = "gray50"),
        plot.caption = element_text(size = 12, hjust = 1, margin = ggplot2::margin(0, 0, 4, 0), colour = "gray50"),
        axis.title.x = element_text(margin = ggplot2::margin(t = 10), size = 13),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 13),
        axis.text.x = element_text(size = 14, margin = margin(t = 2)),
        axis.text.y = element_text(size = 14),
        axis.text.y.left = element_text(margin = margin(r = 2)),
        axis.ticks.length.x = unit(0.1, "cm"), 
        legend.position = "top", 
        legend.title = element_blank(),
        legend.text = element_text(size = 15),
        panel.spacing = unit(.2, "cm"),
        panel.grid.major = element_line(color = "gray90", linewidth = .06)) +
  guides(col = guide_legend(nrow = 2, byrow = TRUE, override.aes = list(size = 6)))

p_underpaid_region

```


## Wage-related underemployment by industry

<p align="justify"> As Figure \@ref(fig:plot-underpaid-ind) shows, wage underemployment is most pervasive in the accommodation and food service sector where, in most years, over a third of workers are underpaid (earning at least 20% lower than the median in their occupational category). Employees in education, retail and human health and social work are also affected while the finance and insurance industry group stand out again with the lowest levels of underemployment.</p>

```{r underpaid-table-ind, include=FALSE}

options(digits = 3)

"Wholesale and retail trade" = 7
"Human health and social work" = 17
"Finance and insurance" = 11
"Education" = 16
"Information and communication" = 10
"Accommodation and food service" = 9

t_underpaid_ind1 <- LFS_clean %>% # summary table
  filter(AGE >= 18 & AGE <= 64) %>% 
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c("1")) %>% #only employees
  filter(HOURPAY > 0 & HOURPAY < 100) %>% # Average gross hourly pay
  filter(!is.na(occu1)) %>%
  filter(!is.na(ind1) & ind1 %in% c(7, 17, 11, 16, 10, 9)) %>%
  group_by(year, sequence, quarter, occu1) %>%
  summarise(
            "Wholesale and retail trade" = sum(PIWT[ind1 == 7]),
            "Human health and social work" = sum(PIWT[ind1 == 17]),
            "Finance and insurance" = sum(PIWT[ind1 == 11]),
            "Education" = sum(PIWT[ind1 == 16]),
            "Information and communication" = sum(PIWT[ind1 == 10]),
            "Accommodation and food service" = sum(PIWT[ind1 == 9])
            ) %>%
  pivot_longer(c(
            "Wholesale and retail trade",
            "Human health and social work",
            "Finance and insurance",
            "Education",
            "Information and communication",
            "Accommodation and food service"),
               names_to = "ind", values_to = "total") %>% 
  select(year, sequence, quarter, occu1, ind, total) %>% 
  as_label(.)

t_underpaid_ind2 <- LFS_clean %>% # summary table
  filter(AGE >= 18 & AGE <= 64) %>% 
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c("1")) %>% #only employees
  filter(HOURPAY > 0 & HOURPAY < 100) %>% # Average gross hourly pay
  filter(!is.na(occu1)) %>%
  filter(!is.na(ind1) & ind1 %in% c(7, 17, 11, 16, 10, 9)) %>%
  group_by(year, sequence, quarter, occu1) %>%
  summarise(median_underpaid_total = (weighted_median(HOURPAY, weights = PIWT))*0.8,
            "Wholesale and retail trade" = sum(PIWT[ind1 == 7 & HOURPAY <= median_underpaid_total]),
            "Human health and social work" = sum(PIWT[ind1 == 17 & HOURPAY <= median_underpaid_total]),
            "Finance and insurance" = sum(PIWT[ind1 == 11 & HOURPAY <= median_underpaid_total]),
            "Education" = sum(PIWT[ind1 == 16 & HOURPAY <= median_underpaid_total]),
            "Information and communication" = sum(PIWT[ind1 == 10 & HOURPAY <= median_underpaid_total]),
            "Accommodation and food service" = sum(PIWT[ind1 == 9 & HOURPAY <= median_underpaid_total])
            ) %>%
  pivot_longer(c(
            "Wholesale and retail trade",
            "Human health and social work",
            "Finance and insurance",
            "Education",
            "Information and communication",
            "Accommodation and food service"),
               names_to = "ind", values_to = "underpaid") %>% 
  select(year, sequence, quarter, occu1, ind, underpaid) %>% 
  as_label(.)


t_underpaid_ind <- left_join(t_underpaid_ind1, t_underpaid_ind2, by = c("year", "sequence", "quarter", "occu1", "ind"))

t_underpaid_ind <- t_underpaid_ind %>% 
  group_by(year, sequence, quarter, ind) %>% 
  summarise(total = sum(total),
            underpaid = sum(underpaid),
            percentage = underpaid/total) 

rm(t_underpaid_ind1, t_underpaid_ind2)

```


```{r plot-underpaid-ind, fig.width = 7.5, fig.asp = 0.6, out.width = '100%', fig.fullwidth = TRUE, fig.cap= "More underpaid employees in the hospitality, human health, education, and retail sectors"}

p_underpaid_ind <- t_underpaid_ind %>% 
  ggplot(aes(x = sequence, y = percentage, colour = ind)) + 
  geom_line(size = 0.7, show.legend = FALSE) +  
  geom_point(size = 1, shape = 20, show.legend = TRUE) +
  geom_vline(xintercept = 4.5, color = "#c9c9c9") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "#c9c9c9") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "#c9c9c9") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "#c9c9c9") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "#c9c9c9") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "#c9c9c9") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "#c9c9c9") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "#c9c9c9") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "#c9c9c9") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "#c9c9c9") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "#c9c9c9") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "#c9c9c9") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "#c9c9c9") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "#c9c9c9") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "#c9c9c9") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "#c9c9c9") + # gridline 2021

  # scale and colour
  #scale_color_discrete_qualitative(palette = "Dark 3") +
  scale_colour_okabeito(palette = "full") + 
  scale_y_continuous(breaks = seq(0,1, 0.1), limits = c(0, 1), labels =
                       scales::percent_format(accuracy = 1L), expand = c(0,0)) +
  scale_x_continuous(breaks=c(1:68), 
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
  # annotation
  labs(x = "", 
       y = "Underpaid rate", 
       #title ="",
       #subtitle  = "",
       caption = c("Note: Applies to all respondents who are not looking for a different or additional job")
       ) +
  annotate('rect', xmin=10, xmax=14, ymin=0, ymax=1, alpha=.2, fill='brown1') + # Great Recession
  annotate(geom = "text", x = 10, y = 0.76, label = "Great Recession", hjust = 0, size = 5, colour = "darkred") +
  annotate('rect', xmin=30.5, xmax=31.5, ymin=0, ymax=1, alpha=.2, fill='darkgreen') + # back to pre-recession
  annotate(geom = "text", x = 31.2, y = 0.76, label = "UK economy gets back\nto pre-downturn size", hjust = 0, size = 5, colour = "darkgreen", lineheight = .7) +
  annotate('rect', xmin=56.5, xmax=58, ymin=0, ymax=1, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 56.5, y = 0.76, label = "Covid-19", hjust = 0, size = 5, colour = "darkred") +
  annotate('rect', xmin=63, xmax=68, ymin=0, ymax=1, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 63, y = 0.76, label = "Cost of\nliving crisis", hjust = 0, size = 5, colour = "darkred", lineheight = .7) +
  annotation_custom(copyright) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0, 0.3), "cm"),
        plot.title = element_text(size = 15, margin = ggplot2::margin(0, 0, 0, 0)),
        plot.subtitle = element_text(size = 13, hjust = 1, margin = ggplot2::margin(0, 0, 4, 0), colour = "gray50"),
        plot.caption = element_text(size = 12, hjust = 1, margin = ggplot2::margin(0, 0, 2, 0), colour = "gray50"),
        axis.title.x = element_text(margin = ggplot2::margin(t = 10), size = 13),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 13),
        axis.text.x = element_text(size = 14, margin = margin(t = 2)),
        axis.text.y = element_text(size = 14),
        axis.text.y.left = element_text(margin = margin(r = 4)),
        axis.ticks.length.x = unit(0.1, "cm"), 
        legend.position = "top", 
        legend.title = element_blank(),
        legend.text = element_text(size = 15),
        panel.spacing = unit(.2, "cm"),
        panel.grid.major = element_line(color = "gray90", linewidth = .06)) +
  guides(col = guide_legend(nrow = 3, byrow = TRUE, override.aes = list(size = 6)))

p_underpaid_ind

```


##	Summary: Wage-related underemployment 

<p align="justify">The wage-related underemployed are workers who are underpaid for what they do. In this report, we compare the wages of workers with others in their occupational grouping: we define being underpaid as earning wages that are at least 20% lower than the median for that occupation. We show that wage-underemployment is prevalent in the UK affecting over a fifth of working men and almost a third of working women, with levels persistent over time. It impacts most heavily on younger workers, people working in accommodation and food service industries, and, perhaps surprisingly, managers and professionals.</p>

