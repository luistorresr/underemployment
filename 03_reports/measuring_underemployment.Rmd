---
title: "Measuring Underemployment"
author: "The Underemployment Project"
date: "`r Sys.Date()`"
subtitle: Trends from 2006 to 2022
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
	warning = FALSE,
  embed_fonts = TRUE,
  fig.align = "center",
  fig_caption= TRUE,
  use_bookdown= TRUE,
  toc= FALSE,
  toc_depth= 3
)
```

```{r libraries, include=FALSE}

#### packages needed
if(!require(tidyverse)) install.packages("tidyverse", repos = "http://cran.us.r-project.org")
if(!require(gridExtra)) install.packages("girdExtra", repos = "http://cran.us.r-project.org")
if(!require(Hmisc)) install.packages("Hmisc", repos = "http://cran.us.r-project.org")
if(!require(sjlabelled)) install.packages("sjlabelled", repos = "http://cran.us.r-project.org")
if(!require(ggthemes)) install.packages("ggthemes", repos = "http://cran.us.r-project.org")
if(!require(ggtext)) install.packages("ggtext", repos = "http://cran.us.r-project.org")
if(!require(ggrepel)) install.packages("ggrepel", repos = "http://cran.us.r-project.org")
if(!require(doBy)) install.packages("doBy", repos = "http://cran.us.r-project.org")
if(!require(sjmisc)) install.packages("sjmisc", repos = "http://cran.us.r-project.org")
if(!require(plotly)) install.packages("plotly", repos = "http://cran.us.r-project.org")
if(!require(scales)) install.packages("scales", repos = "http://cran.us.r-project.org")
if(!require(ggalt)) install.packages("ggalt", repos = "http://cran.us.r-project.org")
if(!require(janitor)) install.packages("janitor", repos = "http://cran.us.r-project.org")
if(!require(bookdown)) install.packages("bookdown", repos = "http://cran.us.r-project.org")
if(!require(blogdown)) install.packages("blogdown", repos = "http://cran.us.r-project.org")
if(!require(rmdformats)) install.packages("rmdformats", repos = "http://cran.us.r-project.org")
if(!require(htmlwidgets)) install.packages("htmlwidgets", repos = "http://cran.us.r-project.org")
if(!require(widgetframe)) install.packages("widgetframe", repos = "http://cran.us.r-project.org")
if(!require(officer)) install.packages("officer", repos = "http://cran.us.r-project.org")
if(!require(showtext)) install.packages("showtext", repos = "http://cran.us.r-project.org")
if(!require(colorspace)) install.packages("colorspace", repos = "http://cran.us.r-project.org")
if(!require(patchwork)) install.packages("patchwork", repos = "http://cran.us.r-project.org")
if(!require(ggpubr)) install.packages("ggpubr", repos = "http://cran.us.r-project.org")
if(!require(flextable)) install.packages("flextable", repos = "http://cran.us.r-project.org")
if(!require(gt)) install.packages("gt", repos = "http://cran.us.r-project.org")
if(!require(htmltools)) install.packages("htmltools", repos = "http://cran.us.r-project.org")

library(ggalt) # contingency table
library(tidyverse) # several tools for data manipulation
library(haven) # read SPSS, Stata, and SAS data
library(gridExtra) # arrange multiple grid-based plots on a page
library(Hmisc) # many functions useful for data analysis
library(sjmisc) # useful to set Na's
library(sjlabelled) # get_labels function
library(ggthemes) # themes for ggplot2
library(ggtext) # fancy text
library(ggrepel) # help with the position of the labels on ggplot2 graph
library(doBy) # 'do' something to data stratified 'by' some variables
library(scales) # add scale symbols and colour to axis
library(janitor) # add totals to tables
library(bookdown) # add totals to tables
library(blogdown) # add totals to tables
#library(rmdformats)
#library(htmlwidgets)
#library(widgetframe)
#library(plotly) # interactive plots
library(colorspace) # colour blind friendly pallettes 
library(officer) # to add additional formatting to tables 
library(patchwork) # to put graphs side by side
library(ggpubr) # easy-to-use functions for creating and customizing ‘ggplot2’- based publication ready plots.
#library(flextable) # formatting tables for word and html 
library(gt) #  creation of interactive data tables
library(htmltools) # tools for creating, manipulating, and writing HTML 
library(showtext)
  font_add_google("Lato")
  showtext_auto()


```

```{r load data, include=FALSE}

load("../data/LFS_clean.rda")

```


# Background
<p align="justify">This study examines if and how indicators of underemployment overlap and accumulate over time in the UK. We ask about the characteristics of those workers who experience the various forms and combinations of underemployment, as well as those with no underemployment. We understand underemployment as a complex and multidimensional phenomenon including insufficient hours of employment, low wages, and limited use of skills at work. Most official measures of underemployment are limited to hours worked. Time-related underemployment exists when the hours of work of an employed person are insufficient in relation to an alternative employment situation in which the person is willing and available to engage. However, this understanding does not provide any information on the adequacy of wages and skills. The limitation of time-related underemployment is evident, for instance, in the case of workers who, although having a full-time job, have low wages or may feel that their skills as underutilised. We consider all these three indicators and their interaction to provide a complete picture of underemployment in the UK.</p>

# Data
<p align="justify">This report aims at mapping underemployment trends for employees and self-employed workers in the UK. We use the UK’s largest study on employment circumstances, the Labour Force Survey (LFS), drawing on analysis from the 2006 to 2022 releases (calendar quarters). Our analyses consider only those in employment (employees and self-employed)  between 18 and 64 years old. By taking a pseudo-longitudinal approach, analyses will allow us to describe long-term trends in prevalence, characteristics of and social inequalities in underemployment, its various dimensions, and interrelations.</p>


```{r sample, echo=FALSE}

N_total <- LFS_clean %>% 
  group_by(as_factor(year), 
           as_label(quarter)) %>%
  summarise(Active = sum(na.omit(PWT[ILODEFR <=2 & AGE >= 18 & AGE <= 64])), # in employment and unemployed between 18 to 64
            Workers = sum(na.omit(PWT[ILODEFR == 1 & INECAC05 <= 2 & AGE >= 18 & AGE <= 64])),
            Women_workers = sum(na.omit(PWT[ILODEFR == 1 & INECAC05 <= 2 & SEX == 2 & AGE >= 18 & AGE <= 64])),
            Men_workers = sum(na.omit(PWT[ILODEFR == 1 & INECAC05 <= 2 & SEX == 1 & AGE >= 18 & AGE <= 64]))) %>% # employee and self-employees
  mutate(across(c(Active, Workers, Women_workers, Men_workers), comma)) %>%
  rename(Year = `as_factor(year)`,
         Quarter = `as_label(quarter)`,
         "Active population" = Active,
         "In employment" = Workers,
         "Female workers" = Women_workers,
         "Male workers" = Men_workers) %>% # Total population estimates
  group_by(Year)

```

```{r table html}

N_total %>% gt(groupname_col = NULL) %>% 
   tab_header(
    title = md("**Calendar quarters from 2006 to 2022**"),
    subtitle = md("Population weights are used")) %>% 
  tab_source_note(source_note = "Source: UK Labour Force Survey") %>%
  tab_options(ihtml.active = TRUE,
              ihtml.use_pagination = TRUE,
              ihtml.page_size_default = 4)
    
```


# Time-related underemployment

<p align="justify">Time-related underemployment is broadly defined as a situation where people are working fewer hours than they wish. This is typically measured in terms of the number of people who could not find a full-time job. However, measuring underemployment in this way does not consider the actual number of hours currently worked or the actual number of additional hours desired, and it fails to recognise that full-time workers may also want additional hours. The International Labour Organisation (ILO) furthers this definition by considering as underemployed those wanting to work more hours, available to do so, and currently working a number of hours below a specified threshold. The Office of National Statistics (ONS) in the UK operationalises this by considered as underemployed those who:</p>
- are looking for an additional job or replacement job with longer hours, or who wanted to work longer hours in their current (main) job
- were available to start working longer hours within two weeks
- whose usual weekly hours were 40 or less for people aged under 18 years or 48 or less for people aged 18 years and over

<p align="justify">The underemployment rate is then calculated as the proportion of underemployed people of the total active population.</p>

<p align="justify">We follow a similar approach by measuring time-related underemployment using three main indicators:</p>
- Part-timers who could not find a full-time job
- Workers who would like to work longer hours in current job
- Workers seeking replacement job with more hours

<p align="justify">We do not use the total active population to calculate the underemployment rate, but only those in in employment (employees and self-employed).</p>


## Indicator 1: Involuntary part-time

<p align="justify">People in employment can work on a full-time or a part-time basis. A part-time worker is someone who works fewer hours than a full-time worker. There is no specific number of hours that makes someone full or part-time, but a full-time worker will usually work 35 hours or more a week.In the UK Labour Force Survey, the split between full-time and part-time employment is based on respondents’ self-classification. The average hours worked by part-timers, for all the periods included in this analysis, is 20 hours.</p>

<p align="justify">Part-time jobs are lower paid than full-time jobs, on the whole, and they bring a range of career penalties. There are various reasons for working on a part-time basis. The Labour Force Survey disaggregates part-time employment by reason as follows:</p>

- those who could not find full-time jobs
- those who did not want full-time jobs
- those who were ill or were disabled
- those who were students or were at school

<p align="justify">We focus on those workers who could not find a full-time jod as our first indicator of underemployment. Our analysis explores trends by personal characteristics, job arrangements, and sector division (geographic and industrial).</p>  


### Trends by personal characteristics 

#### Male and female part-timers

<p align="justify"> Figure 1 shows us the part-timers who could not find a full-time job. We find more female workers in a part-time job in the UK compared to men. As we find more female than male part-timers, it is not surprising that we have more females workers not being able to find a full-time work compared to men (see bottom figure). However, the percentage of those who could not find a full-time job remains much lower (around 10% in most periods) than for men (between 20% to 40%) (top figure). Most female part-timers say they do not want a full-time job, while most male workers wanted one but could not find it. This is because women are invariably working part-time to fit around other roles in their lives.</p>

```{r involuntary part time by sex table, echo=FALSE}

options(digits = 3)

t_ptime <- LFS_clean %>% # summary table
  filter(AGE >= 18 & AGE <= 64) %>% 
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c(1, 2)) %>% #only employees and self-employed
  filter(FTPTWK == 2) %>% # only part-timers
  group_by(year, sequence, quarter, SEX, YPTJOB) %>% 
  summarise(count = sum(PWT)) %>% 
  group_by(year, sequence, quarter, SEX) %>% # calculate % per group
  # percentage part-time per quarter
  mutate(percentage = count/sum(count)) %>% 
  filter(YPTJOB == 3) %>% # could not find full time only
  as_label(.)


```

```{r plot involuntary part time by sex, fig.width=7, fig.height=5, fig.fullwidth=TRUE, fig.cap= "Figure 1: Part-time workers who could not find a full-time job"}

p_ptime <- t_ptime %>% 
  ggplot(aes(x = sequence, y = percentage, colour = factor(SEX))) + 
  geom_line(size = 0.5, show.legend = FALSE) +  
  geom_point(shape = 20, show.legend = TRUE) +
  geom_vline(xintercept = 4.5, color = "gray80") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "gray80") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "gray80") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "gray80") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "gray80") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "gray80") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "gray80") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "gray80") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "gray80") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "gray80") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "gray80") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "gray80") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "gray80") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "gray80") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "gray80") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "gray80") + # gridline 2021

  # scale and colour
  scale_color_discrete_qualitative(palette = "Dark 3") +
  scale_y_continuous(breaks = seq(0,1, 0.1), limits = c(0, 1), labels =
                       scales::percent_format(accuracy = 1L), expand = c(0,0)) +
  scale_x_continuous(breaks=c(1:68), position = "top",
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
    # annotation
  labs(x = "", 
       y = "Percentage", 
       #title ="Figure 1: Part-time workers who could not find a full-time job",
       #subtitle  = "",
       caption = c("Note: Could not find a full-time job as a percentage of all part-time workers in the group")
       ) +
  annotate('rect', xmin=10, xmax=14, ymin=0, ymax=1, alpha=.2, fill='brown1') + # Great Recession
  annotate(geom = "text", x = 10, y = 0.85, label = "Great Recession", hjust = 0, size = 3.5, colour = "darkred") +
  geom_vline(xintercept = 31, color = "darkgreen",linewidth = .2) + # gridline 2013
  annotate(geom = "text", x = 31.2, y = 0.85, label = "UK economy gets back\nto pre-downturn size", hjust = 0, size = 3.5, colour = "darkgreen", lineheight = .7) +
  annotate('rect', xmin=56.5, xmax=58, ymin=0, ymax=1, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 56.5, y = 0.85, label = "Covid-19\nrecession", hjust = 0, size = 3.5, colour = "darkred", lineheight = .7) +
  annotate('rect', xmin=63, xmax=68, ymin=0, ymax=1, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 63, y = 0.85, label = "Cost of\nliving crisis", hjust = 0, size = 3.5, colour = "darkred", lineheight = .7) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0, 0), "lines"),
        plot.title = element_text(size = 12, margin = ggplot2::margin(0, 0, 0, 0)),
        plot.subtitle = element_text(size = 10, hjust = 0, margin = ggplot2::margin(0, 0, 0, 0), colour = "gray50"),
        plot.caption = element_text(size = 10, hjust = 1, margin = ggplot2::margin(2, 0, 0, 0), colour = "gray50"),
        axis.title.x = element_text(margin = ggplot2::margin(t = 10), size = 9),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 10),
        axis.text.x = element_text(size = 8, margin = margin(t = 2)),
        axis.text.y = element_text(size = 10),
        axis.text.y.right =  element_text(margin = margin(l = 2)),
        axis.title.y.right = element_blank(),
        axis.text.y.left = element_text(margin = margin(r = 2)),
        axis.ticks.length.x = unit(0.1, "cm"), 
        strip.text = element_text(face = "bold", hjust = 0, margin = margin(b= 7), size = 12),
        legend.position = "none", 
        legend.title = element_blank(),
        legend.text = element_text(size = 11),
        panel.spacing = unit(.5, "cm"),
        panel.grid.major = element_line(color = "gray90", linewidth = .06)) +
  guides(col = guide_legend(nrow = 1, byrow = TRUE, override.aes = list(size = 5)))


p_ptime_total <- t_ptime %>% 
  ggplot() + 
  geom_bar(aes(x = sequence, y = count, fill = factor(SEX)), stat="identity", position = "dodge", width=0.6) +  
  geom_vline(xintercept = 4.5, color = "gray80") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "gray80") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "gray80") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "gray80") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "gray80") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "gray80") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "gray80") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "gray80") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "gray80") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "gray80") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "gray80") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "gray80") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "gray80") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "gray80") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "gray80") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "gray80") + # gridline 2021

  # scale and colour
  scale_fill_discrete_qualitative(palette = "Dark 3") +
  scale_y_continuous(breaks = seq(0,2000000, 200000), limits = c(0, 2000000), labels = comma, expand = c(0,0)) +
  scale_x_continuous(breaks=c(1:68),
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
  # annotation
  labs(x = "Year", 
       y = "Total", 
       #title ="",
       #subtitle  = "",
       #caption = c("")
       ) +
  annotate('rect', xmin=10, xmax=14, ymin=0, ymax=2000000, alpha=.2, fill='brown1') + # Great Recession
  annotate(geom = "text", x = 10, y = 1750000, label = "Great Recession", hjust = 0, size = 3.5, colour = "darkred") +
  geom_vline(xintercept = 31, color = "darkgreen",linewidth = .2) + # gridline 2013
  annotate(geom = "text", x = 31.2, y = 1750000, label = "UK economy gets back\nto pre-downturn size", hjust = 0, size = 3.5, colour = "darkgreen", lineheight = .7) +
  annotate('rect', xmin=56.5, xmax=58, ymin=0, ymax=2000000, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 56.5, y = 1750000, label = "Covid-19\nrecession", hjust = 0, size = 3.5, colour = "darkred", lineheight = .7) +
  annotate('rect', xmin=63, xmax=68, ymin=0, ymax=2000000, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 63, y = 1750000, label = "Cost of\nliving crisis", hjust = 0, size = 3.5, colour = "darkred", lineheight = .7) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0.5, 0, 0, 0), "lines"),
        plot.title = element_text(size = 14, margin = ggplot2::margin(0, 0, 0, 0)),
        plot.subtitle = element_text(size = 10, hjust = 0, margin = ggplot2::margin(0, 0, 0, 0), colour = "gray50"),
        plot.caption = element_text(size = 9, hjust = 1, margin = ggplot2::margin(0, 0, 0, 0), colour = "gray50"),
        axis.title.x = element_text(margin = ggplot2::margin(t = 10), size = 9),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 10),
        axis.text.x = element_text(size = 8, margin = margin(t = 2)),
        axis.text.y = element_text(size = 10),
        axis.text.y.right =  element_text(margin = margin(l = 2)),
        axis.title.y.right = element_blank(),
        axis.text.y.left = element_text(margin = margin(r = 2)),
        axis.ticks.length.x = unit(0.1, "cm"), 
        strip.text = element_text(face = "bold", hjust = 0, margin = margin(b= 7), size = 12),
        legend.position = "top", 
        legend.title = element_blank(),
        legend.text = element_text(size = 10),
        panel.spacing = unit(.2, "cm"),
        legend.key.size = unit(0.4, 'cm'),
        panel.grid.major = element_line(color = "gray90", linewidth = .06)) +
  guides(col = guide_legend(nrow = 1, byrow = TRUE, override.aes = list(size = 4)))

p_ptime / p_ptime_total

```


#### Young workers struggle the most to find full-time jobs 


```{r involuntary part time by age table, echo=FALSE}

options(digits = 3)

t_ptime_age <- LFS_clean %>% # summary table
  filter(AGE >= 18 & AGE <= 64) %>% 
  #creating age categories
  mutate(AGE_cat = case_when(AGE %in% 18:24 ~ "Aged 18 to 24",
                             AGE %in% 25:34 ~ "Aged 25 to 34",
                             AGE %in% 35:44 ~ "Aged 35 to 44",
                             AGE %in% 45:54 ~ "Aged 45 to 54",
                             AGE %in% 55:64 ~ "Aged 55 to 64",
                             is.na(AGE) ~ NA)) %>%
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c(1, 2)) %>% #only employees and self-employed
  group_by(year, sequence, quarter, AGE_cat, YPTJOB) %>% 
  summarise(count = sum(PWT)) %>% 
  group_by(year, sequence, quarter, AGE_cat) %>% # calculate % per group
  # percentage per quarter
  mutate(percentage = count/sum(count)) %>% 
  filter(YPTJOB == 3) %>%  
  as_label(.)

```


```{r plot involuntary part time age, fig.width=7, fig.height=3, fig.fullwidth=TRUE, fig.cap= "Figure 2: Young workers struggle the most to find full-time jobs"}

p_ptime_age  <- t_ptime_age  %>% 
  ggplot() + 
  geom_line(aes(x = sequence, y = percentage, colour = factor(AGE_cat)), size = 0.5, show.legend = FALSE) +  
  geom_point(aes(x = sequence, y = percentage, colour = factor(AGE_cat)), shape = 20, show.legend = TRUE) +
  geom_vline(xintercept = 4.5, color = "#c9c9c9") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "#c9c9c9") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "#c9c9c9") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "#c9c9c9") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "#c9c9c9") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "#c9c9c9") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "#c9c9c9") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "#c9c9c9") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "#c9c9c9") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "#c9c9c9") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "#c9c9c9") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "#c9c9c9") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "#c9c9c9") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "#c9c9c9") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "#c9c9c9") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "#c9c9c9") + # gridline 2021

  # scale and colour
  scale_color_discrete_qualitative(palette = "Dark 3") +
  scale_y_continuous(breaks = seq(0,0.25, 0.025), limits = c(0, 0.25), labels =
                       scales::percent_format(accuracy = 1L), expand = c(0,0)) +
  scale_x_continuous(breaks=c(1:68), position = "bottom",
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
  # annotation
  labs(x = "", 
       y = "Percentage", 
       #title ="Figure 2: Young workers struggle the most to find full-time jobs",
       #subtitle  = "",
       caption = "Note: Could not find a full-time job as a percentage of all part-time workers in the age group"
       ) +
  annotate('rect', xmin=10, xmax=14, ymin=0, ymax=0.25, alpha=.2, fill='brown1') + # Great Recession
  annotate(geom = "text", x = 10, y = 0.20, label = "Great Recession", hjust = 0, size = 3.5, colour = "darkred") +
  geom_vline(xintercept = 31, color = "darkgreen",linewidth = .2) + # gridline 2013
  annotate(geom = "text", x = 31.2, y = 0.20, label = "UK economy gets back\nto pre-downturn size", hjust = 0, size = 3.5, colour = "darkgreen", lineheight = .7) +
  annotate('rect', xmin=56.5, xmax=58, ymin=0, ymax=0.25, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 56.5, y = 0.20, label = "Covid-19\nrecession", hjust = 0, size = 3.5, colour = "darkred", lineheight = .7) +
  annotate('rect', xmin=63, xmax=68, ymin=0, ymax=0.25, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 63, y = 0.20, label = "Cost of\nliving crisis", hjust = 0, size = 3.5, colour = "darkred", lineheight = .7) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0, 0), "lines"),
        plot.title = element_text(size = 13, margin = ggplot2::margin(0, 0, 0, 0)),
        plot.subtitle = element_text(size = 11, hjust = 0, margin = ggplot2::margin(0, 0, 0, 0)),
        plot.caption = element_text(size = 9, hjust = 1, margin = ggplot2::margin(0, 0, 0, 0), colour = "gray50"),
        axis.title.x = element_text(margin = ggplot2::margin(t = 8), size = 10),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 10),
        axis.text.x = element_text(size = 10, margin = margin(t = 2)),
        axis.text.y = element_text(size = 10),
        axis.text.y.right =  element_text(margin = margin(l = 4)),
        axis.title.y.right = element_blank(),
        axis.text.y.left = element_text(margin = margin(r = 2)),
        axis.ticks.length.x = unit(0.1, "cm"), 
        strip.text = element_text(face = "bold", hjust = 0, margin = margin(b= 7), size = 10),
        legend.position = "top", 
        legend.title = element_blank(),
        legend.text = element_text(size = 10),
        legend.key.size = unit(0.4, 'cm'),
        panel.grid.major = element_line(color = "gray90", linewidth = .5)) +
  guides(col = guide_legend(nrow = 1, byrow = TRUE, override.aes = list(size = 5)))

p_ptime_age

```


#### Ethnic-minority groups more likely to find themselves in involuntary part-time


```{r involuntary part time by ethnicity table, echo=FALSE}

t_ptime_eth <- LFS_clean %>% # summary table
  filter(AGE >= 18 & AGE <= 64) %>% 
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c(1, 2)) %>% #only employees and self-employed
  group_by(year, sequence, quarter, ETH, YPTJOB) %>% 
  summarise(count = sum(PWT)) %>% 
  group_by(year, sequence, quarter, ETH) %>% 
  # percentage per quarter
  mutate(percentage = count/sum(count)) %>% 
  filter(YPTJOB == 3) %>%  
  filter(!is.na(ETH)) %>%  # remove NAs from the ethnicity variable
  as_label(.)

```

```{r plot involuntary part time ethnicity, fig.width=7, fig.height=3, fig.fullwidth=TRUE, fig.cap= "Figure 3: Ethnic-minority groups more likely to find themselves in involuntary part-time"}

p_ptime_eth  <- t_ptime_eth  %>% 
  ggplot(aes(x = sequence, y = percentage, colour = factor(ETH))) + 
  geom_line(size = 0.5, show.legend = FALSE) +  
  geom_point(shape = 20, show.legend = TRUE) +
  geom_vline(xintercept = 4.5, color = "#c9c9c9") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "#c9c9c9") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "#c9c9c9") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "#c9c9c9") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "#c9c9c9") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "#c9c9c9") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "#c9c9c9") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "#c9c9c9") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "#c9c9c9") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "#c9c9c9") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "#c9c9c9") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "#c9c9c9") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "#c9c9c9") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "#c9c9c9") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "#c9c9c9") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "#c9c9c9") + # gridline 2021
  #facet_wrap(vars(SEX), nrow = 2) +

  # scale and colour
  scale_color_discrete_qualitative(palette = "Dark 3") +
  scale_y_continuous(breaks = seq(0,0.30, 0.025), limits = c(0, 0.30), labels =
                       scales::percent_format(accuracy = 1L), expand = c(0,0)) +
  scale_x_continuous(breaks=c(1:68), position = "bottom",
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
  # annotation
  labs(x = "Year", 
       y = "Percentage", 
       #title ="Figure 3: Ethnic-minority groups more likely to find themselves in involuntary part-time",
       #subtitle  = "",
       caption = "Note: Could not find a full-time job as a percentage of all part-time workers in the ethnic group"
       ) +
  annotate('rect', xmin=10, xmax=14, ymin=0, ymax=0.30, alpha=.2, fill='brown1') + # Great Recession
  annotate(geom = "text", x = 10, y = 0.25, label = "Great Recession", hjust = 0, size = 3.5, colour = "darkred") +
  geom_vline(xintercept = 31, color = "darkgreen",linewidth = .2) + # gridline 2013
  annotate(geom = "text", x = 31.2, y = 0.25, label = "UK economy gets back\nto pre-downturn size", hjust = 0, size = 3.5, colour = "darkgreen", lineheight = .7) +
  annotate('rect', xmin=56.5, xmax=58, ymin=0, ymax=0.30, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 56.5, y = 0.25, label = "Covid-19\nrecession", hjust = 0, size = 3.5, colour = "darkred", lineheight = .7) +
  annotate('rect', xmin=63, xmax=68, ymin=0, ymax=.30, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 63, y = 0.25, label = "Cost of\nliving crisis", hjust = 0, size = 3.5, colour = "darkred", lineheight = .7) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0, 0), "lines"),
        plot.title = element_text(size = 13, margin = ggplot2::margin(0, 0, 0, 0)),
        plot.subtitle = element_text(size = 11, hjust = 0, margin = ggplot2::margin(0, 0, 0, 0)),
        plot.caption = element_text(size = 9, hjust = 1, margin = ggplot2::margin(0, 0, 2, 0), colour = "gray50"),
        axis.title.x = element_text(margin = ggplot2::margin(t = 8), size = 10),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 10),
        axis.text.x = element_text(size = 10, margin = margin(t = 2)),
        axis.text.y = element_text(size = 10),
        axis.text.y.right =  element_text(margin = margin(l = 4)),
        axis.title.y.right = element_blank(),
        axis.text.y.left = element_text(margin = margin(r = 2)),
        axis.ticks.length.x = unit(0.1, "cm"), 
        strip.text = element_text(face = "bold", hjust = 0, margin = margin(b= 7), size = 10),
        legend.position = "top", 
        legend.title = element_blank(),
        legend.text = element_text(size = 10),
        legend.key.size = unit(0.5, 'cm'),
        legend.spacing.y = unit(0.05, 'cm'),
        panel.grid.major = element_line(color = "gray90", linewidth = .5)) +
  guides(col = guide_legend(nrow = 2, byrow = TRUE, override.aes = list(size = 4)))

p_ptime_eth

```


#### Workers with no formal qualification find it difficult to find full-time work

```{r involuntary part time table education, echo=FALSE}

options(digits = 3)

t_ptime_quali <- LFS_clean %>% # summary table
  filter(AGE >= 18 & AGE <= 64) %>% 
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c(1, 2)) %>% #only employees and self-employed
  filter(FTPTWK == 2) %>% # only part-timers
  group_by(year, sequence, quarter, quali, YPTJOB) %>% 
  summarise(count = sum(PWT)) %>% 
  group_by(year, sequence, quarter, quali) %>% 
  # percentage part-time per quarter
  mutate(percentage = count/sum(count)) %>% 
  filter(YPTJOB %in% c("3") & !is.na(quali) & !quali %in% c("7")) %>% # could not find
  filter(YPTJOB == 3) %>% # could not find  
  as_label(.)


```

```{r plot involuntary part time education, fig.width=7, fig.height=3, fig.fullwidth=TRUE, fig.cap= "Figure 4: Workers with no formal qualification find it difficult to find full-time work"}

p_ptime_quali <- t_ptime_quali %>% 
  ggplot(aes(x = sequence, y = percentage, colour = factor(quali))) + 
  geom_line(size = 0.5, show.legend = FALSE) +  
  geom_point(size = 0.5, shape = 20, show.legend = TRUE) +
  geom_vline(xintercept = 4.5, color = "#c9c9c9") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "#c9c9c9") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "#c9c9c9") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "#c9c9c9") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "#c9c9c9") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "#c9c9c9") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "#c9c9c9") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "#c9c9c9") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "#c9c9c9") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "#c9c9c9") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "#c9c9c9") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "#c9c9c9") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "#c9c9c9") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "#c9c9c9") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "#c9c9c9") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "#c9c9c9") + # gridline 2021

  # scale and colour
  scale_color_discrete_qualitative(palette = "Dark 3") +
  scale_y_continuous(breaks = seq(0,0.50, 0.05), limits = c(0, 0.50), labels =
                       scales::percent_format(accuracy = 1L), expand = c(0,0)) +
  scale_x_continuous(breaks=c(1:68), 
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
  # annotation
  labs(x = "", 
       y = "Percentage", 
       #title ="Figure 4: Workers with no formal qualification find it difficult to find full-time work",
       #subtitle  = "",
       caption = c("Note: Could not find a full-time job as a percentage of part-time workers in the category")
       ) +
  annotate('rect', xmin=10, xmax=14, ymin=0, ymax=0.50, alpha=.2, fill='brown1') + # Great Recession
  annotate(geom = "text", x = 10, y = 0.45, label = "Great Recession", hjust = 0, size = 3.5, colour = "darkred") +
  geom_vline(xintercept = 31, color = "darkgreen",linewidth = .2) + # gridline 2006
  annotate(geom = "text", x = 31.2, y = 0.45, label = "UK economy gets back\nto pre-downturn size", hjust = 0, size = 3.5, colour = "darkgreen", lineheight = .7) +
  annotate('rect', xmin=56.5, xmax=58, ymin=0, ymax=0.50, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 56.5, y = 0.45, label = "Covid-19", hjust = 0, size = 3.5, colour = "darkred") +
  annotate('rect', xmin=63, xmax=68, ymin=0, ymax=.50, alpha=.2, fill='brown1') +
  annotate(geom = "text", x = 63, y = 0.45, label = "Cost of\nliving crisis", hjust = 0, size = 3.5, colour = "darkred", lineheight = .7) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0, 0), "lines"),
        plot.title = element_text(size = 13, margin = ggplot2::margin(0, 0, 0, 0)),
        plot.subtitle = element_text(size = 11, hjust = 0, margin = ggplot2::margin(0, 0, 0, 0)),
        plot.caption = element_text(size = 9, hjust = 1, margin = ggplot2::margin(0, 0, 2, 0), colour = "gray50"),
        axis.title.x = element_text(margin = ggplot2::margin(t = 8), size = 10),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 10),
        axis.text.x = element_text(size = 10, margin = margin(t = 2)),
        axis.text.y = element_text(size = 10),
        axis.text.y.right =  element_text(margin = margin(l = 4)),
        axis.title.y.right = element_blank(),
        axis.text.y.left = element_text(margin = margin(r = 2)),
        axis.ticks.length.x = unit(0.1, "cm"), 
        strip.text = element_text(face = "bold", hjust = 0, margin = margin(b= 7), size = 10),
        legend.position = "top", 
        legend.title = element_blank(),
        legend.text = element_text(size = 10),
        legend.key.size = unit(0.5, 'cm'),
        legend.spacing.y = unit(0.05, 'cm'),
        panel.grid.major = element_line(color = "gray90", linewidth = .5)) +
  guides(col = guide_legend(nrow = 2, byrow = TRUE, override.aes = list(size = 4)))

p_ptime_quali


```


#### Intersections matter

```{r table intersections, echo=FALSE}

t_ptime_quali <- LFS_clean %>% # summary table
  filter(AGE >= 18 & AGE <= 64) %>% 
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c(1, 2)) %>% #only employees and self-employed
  filter(FTPTWK == 2) %>% # only part-timers
  group_by(year, sequence, quarter, quali, YPTJOB) %>% 
  summarise(count = sum(PWT)) %>% 
  group_by(year, sequence, quarter, quali) %>% 
  # percentage part-time per quarter
  mutate(percentage = count/sum(count)) %>% 
  filter(YPTJOB %in% c("3") & !is.na(quali) & !quali %in% c("7")) %>% # could not find
  filter(YPTJOB == 3) %>% # could not find  
  as_label(.)

```


```{r plot intersections, fig.width=7, fig.height=3, fig.fullwidth=TRUE, fig.cap= "Figure 5: Intersections matter"}




```



### Trends by job characteristics 


#### Occupational category

```{r involuntary part time table NSEC, echo=FALSE}

options(digits = 3)

t_ptime_nsec <- LFS_clean %>% # summary table
  filter(AGE >= 18 & AGE <= 64) %>% 
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c(1, 2)) %>% #only employees and self-employed
  filter(FTPTWK == 2) %>% # only part-timers
  group_by(year, sequence, quarter, NSEC2, YPTJOB) %>% 
  summarise(count = sum(PWT)) %>% 
  group_by(year, sequence, quarter, NSEC2) %>% 
  # percentage part-time per quarter
  mutate(percentage = count/sum(count)) %>% 
  filter(!is.na(NSEC2) & !NSEC2 == 6) %>%  # omit no answers and no apply
  filter(YPTJOB == 3) %>% # could not find  
  as_label(.)


```

```{r plot involuntary part time nsec, fig.width=9, fig.height=3.5, fig.fullwidth=TRUE, fig.cap= ""}

p_ptime_nsec <- t_ptime_nsec %>% 
  ggplot() + 
  geom_line(aes(x = sequence, y = percentage, colour = factor(NSEC2)), size = 0.5, show.legend = FALSE) +  
  geom_point(aes(x = sequence, y = percentage, colour = factor(NSEC2)), size = 0.5, shape = 15, show.legend = TRUE) +
  geom_vline(xintercept = 4.5, color = "#c9c9c9") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "#c9c9c9") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "#c9c9c9") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "#c9c9c9") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "#c9c9c9") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "#c9c9c9") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "#c9c9c9") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "#c9c9c9") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "#c9c9c9") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "#c9c9c9") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "#c9c9c9") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "#c9c9c9") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "#c9c9c9") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "#c9c9c9") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "#c9c9c9") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "#c9c9c9") + # gridline 2021

  # scale and colour
  scale_color_discrete_qualitative(palette = "Dynamic") +
  scale_y_continuous(breaks = seq(0,0.50, 0.05), limits = c(0, 0.50), labels =
                       scales::percent_format(accuracy = 1L), expand = c(0,0), sec.axis = dup_axis()) +
  scale_x_continuous(breaks=c(1:68), position = "top",
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
  # annotation
  labs(x = "", 
       y = "Percentage", 
       title ="Part-time workers who could not find a full-time job by occupational category",
       subtitle  = "",
       caption = c("Note: Could not find a full-time job as a percentage of part-time workers in the category")
       ) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0.2, 0), "lines"),
        plot.title = element_text(size = 14, margin = ggplot2::margin(5, 0, 0, 0)),
        plot.subtitle = element_text(size = 12, hjust = 0, margin = ggplot2::margin(5, 0, 15, 0)),
        plot.caption = element_text(size = 10, hjust = 1, margin = ggplot2::margin(2, 0, 2, 0)),
        axis.title.x = element_text(margin = ggplot2::margin(t = 8), size = 12),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 12),
        axis.text.x = element_text(size = 12, margin = margin(t = 2)),
        axis.text.y = element_text(size = 12),
        axis.text.y.right =  element_text(margin = margin(l = 4)),
        axis.title.y.right = element_blank(),
        axis.ticks.length.x = unit(0.1, "cm"), 
        legend.position = "top", 
        legend.title = element_blank(),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(color = "gray90", linewidth = .5)) +
  guides(col = guide_legend(nrow = 1, byrow = TRUE, override.aes = list(size = 5)))



p_ptime_nsec


```


####  Work arrangements



### Sectoral division 


#### Geographic


#### Industry 




## Indicator 2: Workers wo would like to work longer hours


### Personal characteristics 


#### Men and women

```{r under gender table, echo=FALSE}

options(digits = 3)

# Would like to work longer hours, at current basic rate of pay, given the opportunity

t_undemp <- LFS_clean %>% # summary table
  filter(AGE >= 18 & AGE <= 64) %>% 
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c(1, 2)) %>% #only employees and self-employed
  filter(DIFJOB == 2) %>% # Applies to all respondents who are not looking for a different or additional job
  group_by(year, sequence, quarter, SEX, UNDEMP) %>% 
  summarise(count = sum(PWT)) %>% 
  group_by(year, sequence, quarter, SEX) %>% 
  # percentage part-time per quarter
  mutate(percentage = count/sum(count)) %>% 
  filter(!is.na(UNDEMP)) %>% # remove NAs. Only responses to the question
  filter(UNDEMP == 1) %>% # only those wating to work additional hours
  as_label(.)


```


```{r index 1, fig.width= 9, fig.height=6, fig.fullwidth=TRUE, fig.cap= "Would like to work longer hours, at current basic rate of pay, given the opportunity"}

p_undemp_rate <- t_undemp %>% 
  ggplot() + 
  geom_line(aes(x = sequence, y = percentage, colour = factor(SEX)), size = 0.5, show.legend = FALSE) +  
  geom_point(aes(x = sequence, y = percentage, colour = factor(SEX)), shape = 15, show.legend = TRUE) +
  geom_vline(xintercept = 4.5, color = "#c9c9c9") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "#c9c9c9") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "#c9c9c9") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "#c9c9c9") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "#c9c9c9") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "#c9c9c9") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "#c9c9c9") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "#c9c9c9") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "#c9c9c9") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "#c9c9c9") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "#c9c9c9") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "#c9c9c9") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "#c9c9c9") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "#c9c9c9") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "#c9c9c9") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "#c9c9c9") + # gridline 2021

  # scale and colour
  scale_color_discrete_qualitative(palette = "Dark 3") +
  scale_y_continuous(breaks = seq(0,0.20, 0.02), limits = c(0, 0.20), labels =
                       scales::percent_format(accuracy = 1L), expand = c(0,0), sec.axis = dup_axis()) +
  scale_x_continuous(breaks=c(1:68), position = "top",
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
  # annotation
  labs(x = "", 
       y = "Percentage", 
       title ="Wants to work more hours in current job",
       subtitle  = " ",
       caption = c("")
       ) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0, 0), "lines"),
        plot.title = element_text(size = 14, margin = ggplot2::margin(5, 0, 0, 0)),
        plot.subtitle = element_text(size = 12, hjust = 0, margin = ggplot2::margin(5, 0, 2, 0)),
        plot.caption = element_text(size = 10, hjust = 1, margin = ggplot2::margin(2, 0, 2, 0)),
        axis.title.x = element_text(margin = ggplot2::margin(t = 8), size = 12),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 12),
        axis.text.x = element_text(size = 12, margin = margin(t = 2)),
        axis.text.y = element_text(size = 12),
        axis.text.y.right =  element_text(margin = margin(l = 4)),
        axis.title.y.right = element_blank(),
        axis.ticks.length.x = unit(0.1, "cm"), 
        legend.position = "top", 
        legend.title = element_blank(),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(color = "gray90", linewidth = .5)) +
  guides(col = guide_legend(nrow = 1, byrow = TRUE, override.aes = list(size = 5)))


p_undemp_total <- t_undemp %>% 
  ggplot() + 
  geom_bar(aes(x = sequence, y = count, fill = factor(SEX)), stat="identity", position = "dodge", width=0.8) +  
  geom_vline(xintercept = 4.5, color = "#c9c9c9") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "#c9c9c9") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "#c9c9c9") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "#c9c9c9") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "#c9c9c9") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "#c9c9c9") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "#c9c9c9") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "#c9c9c9") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "#c9c9c9") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "#c9c9c9") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "#c9c9c9") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "#c9c9c9") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "#c9c9c9") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "#c9c9c9") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "#c9c9c9") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "#c9c9c9") + # gridline 2021

  # scale and colour
  scale_fill_discrete_qualitative(palette = "Dark 3") +
  scale_y_continuous(breaks = seq(0,2000000, 200000), limits = c(0, 2000000), labels = comma, expand = c(0,0), sec.axis = dup_axis()) +
  scale_x_continuous(breaks=c(1:68),
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
  # annotation
  labs(x = "Year", 
       y = "Total", 
       title ="",
       #subtitle  = "",
       #caption = c("Note: Only workers who are not looking for a different or additional job")
       ) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0, 0), "lines"),
        plot.title = element_text(size = 14, margin = ggplot2::margin(5, 0, 0, 0)),
        plot.subtitle = element_text(size = 12, hjust = 0, margin = ggplot2::margin(5, 0, 2, 0)),
        plot.caption = element_text(size = 10, hjust = 1, margin = ggplot2::margin(2, 0, 2, 0)),
        axis.title.x = element_text(margin = ggplot2::margin(t = 8), size = 12),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 12),
        axis.text.x = element_text(size = 12, margin = margin(t = 2)),
        axis.text.y = element_text(size = 12),
        axis.text.y.right =  element_text(margin = margin(l = 4)),
        axis.title.y.right = element_blank(),
        axis.ticks.length.x = unit(0.1, "cm"), 
        legend.position = "none", 
        legend.title = element_blank(),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(color = "gray90", linewidth = .5)) +
  guides(col = guide_legend(nrow = 1, byrow = TRUE, override.aes = list(size = 5)))


p_undemp_rate / p_undemp_total



```


#### Age


#### Ethnicity


#### Education



### Job characteristics

#### Occupational category


```{r extra hours table by nsec, echo=FALSE}

options(digits = 3)

# Would like to work longer hours, at current basic rate of pay, given the opportunity

t_undemp_nsec <- LFS_clean %>% # summary table
  filter(AGE >= 18 & AGE <= 64) %>% 
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c(1, 2)) %>% #only employees and self-employed
  filter(DIFJOB == 2) %>% # Applies to all respondents who are not looking for a different or additional job
  group_by(year, sequence, quarter, NSEC2, UNDEMP) %>% 
  summarise(count = sum(PWT)) %>% 
  group_by(year, sequence, quarter, NSEC2) %>% 
  # percentage part-time per quarter
  mutate(percentage = count/sum(count)) %>% 
  filter(!is.na(UNDEMP)) %>% # remove NAs. Only responses to the question
  filter(!is.na(NSEC2) & !NSEC2 == 6) %>%  # omit no answers and no apply
  filter(UNDEMP == 1) %>% # only those wating to work additional hours
  as_label(.)

```


```{r plot involuntary part time nsec, fig.width=9, fig.height=3.5, fig.fullwidth=TRUE, fig.cap= ""}

p_undemp_nsec <- t_undemp_nsec %>% 
  ggplot() + 
  geom_line(aes(x = sequence, y = percentage, colour = factor(NSEC2)), size = 0.5, show.legend = FALSE) +  
  geom_point(aes(x = sequence, y = percentage, colour = factor(NSEC2)), size = 0.5, shape = 15, show.legend = TRUE) +
  geom_vline(xintercept = 4.5, color = "#c9c9c9") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "#c9c9c9") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "#c9c9c9") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "#c9c9c9") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "#c9c9c9") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "#c9c9c9") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "#c9c9c9") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "#c9c9c9") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "#c9c9c9") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "#c9c9c9") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "#c9c9c9") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "#c9c9c9") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "#c9c9c9") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "#c9c9c9") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "#c9c9c9") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "#c9c9c9") + # gridline 2021

  # scale and colour
  scale_color_discrete_qualitative(palette = "Dynamic") +
  scale_y_continuous(breaks = seq(0,0.50, 0.05), limits = c(0, 0.50), labels =
                       scales::percent_format(accuracy = 1L), expand = c(0,0), sec.axis = dup_axis()) +
  scale_x_continuous(breaks=c(1:68), position = "top",
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
  # annotation
  labs(x = "", 
       y = "Percentage", 
       title ="Wants to work more hours in current job by occupational category",
       subtitle  = "",
       caption = c("")
       ) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0, 0), "lines"),
        plot.title = element_text(size = 14, margin = ggplot2::margin(5, 0, 0, 0)),
        plot.subtitle = element_text(size = 12, hjust = 0, margin = ggplot2::margin(5, 0, 15, 0)),
        plot.caption = element_text(size = 10, hjust = 1, margin = ggplot2::margin(2, 0, 2, 0)),
        axis.title.x = element_text(margin = ggplot2::margin(t = 8), size = 12),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 12),
        axis.text.x = element_text(size = 12, margin = margin(t = 2)),
        axis.text.y = element_text(size = 12),
        axis.text.y.right =  element_text(margin = margin(l = 4)),
        axis.title.y.right = element_blank(),
        axis.ticks.length.x = unit(0.1, "cm"), 
        legend.position = "top", 
        legend.title = element_blank(),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(color = "gray90", linewidth = .5)) +
  guides(col = guide_legend(nrow = 2, byrow = TRUE, override.aes = list(size = 5)))


p_undemp_nsec


```


##### Part-time vs full time workers

```{r under ptime/ftime table, echo=FALSE}

options(digits = 3)

t_undemp_ptime <- LFS_clean %>% # summary table
  filter(AGE >= 18 & AGE <= 64) %>% 
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c(1, 2)) %>% #only employees and self-employed
  filter(DIFJOB == 2) %>% # Applies to all respondents who are not looking for a different or additional job
  group_by(year, sequence, quarter, SEX, FTPTWK, YPTJOB, UNDEMP) %>% 
  summarise(count = sum(PWT)) %>% 
  group_by(year, sequence, quarter, SEX, FTPTWK, YPTJOB) %>% 
  # percentage part-time per quarter
  mutate(percentage = count/sum(count)) %>% 
  filter(!is.na(UNDEMP) & !is.na(FTPTWK)) %>% # remove NAs. Only responses to the question
  filter(UNDEMP == 1) %>%
  as_label(.)

t_undemp_ptime <- t_undemp_ptime %>% 
  mutate(YPTJOB = case_when(FTPTWK == "Full-time" ~ "Full-time", TRUE ~  YPTJOB)) %>% 
  filter(YPTJOB %in% c("Full-time", "Could not find full-time job", "Did not want full-time job"))


```


```{r index 1, fig.width= 8, fig.height=6, fig.fullwidth=TRUE, fig.cap= ""}

p_undemp_rate_ptime <- t_undemp_ptime %>% 
  ggplot() + 
  geom_line(aes(x = sequence, y = percentage, colour = factor(YPTJOB)), size = 0.5, show.legend = FALSE) +  
  geom_point(aes(x = sequence, y = percentage, colour = factor(YPTJOB)), shape = 15, size = 1, show.legend = TRUE) +
  geom_vline(xintercept = 4.5, color = "#c9c9c9") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "#c9c9c9") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "#c9c9c9") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "#c9c9c9") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "#c9c9c9") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "#c9c9c9") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "#c9c9c9") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "#c9c9c9") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "#c9c9c9") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "#c9c9c9") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "#c9c9c9") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "#c9c9c9") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "#c9c9c9") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "#c9c9c9") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "#c9c9c9") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "#c9c9c9") + # gridline 2021
  facet_wrap(. ~ SEX, ncol=1, strip.position = "top") +
  
  # scale and colour
  scale_color_discrete_qualitative(palette = "Harmonic") +
  scale_y_continuous(breaks = seq(0,1, 0.1), limits = c(0, 1), labels =
                       scales::percent_format(accuracy = 1L), expand = c(0,0), sec.axis = dup_axis()) +
  scale_x_continuous(breaks=c(1:68), position = "bottom",
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
  # annotation
  labs(x = "", 
       y = "Percentage", 
       title ="Wants to work more hours in current job",
       subtitle  = "Part-time vs full-time employed and self-employed workers",
       caption = c("")
       ) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0, 0), "lines"),
        plot.title = element_text(size = 14, margin = ggplot2::margin(5, 0, 0, 0)),
        plot.subtitle = element_text(size = 12, hjust = 0, margin = ggplot2::margin(5, 0, 2, 0)),
        plot.caption = element_text(size = 10, hjust = 1, margin = ggplot2::margin(2, 0, 2, 0)),
        axis.title.x = element_text(margin = ggplot2::margin(t = 8), size = 12),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 12),
        axis.text.x = element_text(size = 12, margin = margin(t = 2)),
        axis.text.y = element_text(size = 12),
        axis.ticks.length.x = unit(0.1, "cm"), 
        axis.text.y.right =  element_text(margin = margin(l = 4)),
        axis.title.y.right = element_blank(),
        legend.position = "top", 
        legend.title = element_blank(),
        legend.text = element_text(size = 12),
        panel.spacing = unit(0.5, "cm"),
        strip.text = element_text(size = 14, face="bold", margin = margin(b = 2)),
        strip.background = element_blank(),
        panel.grid.major = element_line(color = "gray90", linewidth = .5)) +
  guides(col = guide_legend(nrow = 1, byrow = TRUE, override.aes = list(size = 5)))

p_undemp_rate_ptime



```


#### Extra hours wanting to work by part-time and full-time workers


```{r table extra hours}

t_extra_hours <- LFS_clean %>% 
  filter(AGE >= 18 & AGE <= 64) %>%
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c(1, 2)) %>% #only employees and self-employed
  select(year, sequence, quarter, SEX, FTPTWK, YPTJOB, UNDEMP, UNDHRS) %>%
  filter(UNDEMP == 1) %>%
  filter(!is.na(UNDHRS)) %>%
  as_label(FTPTWK, YPTJOB, UNDEMP) %>%
  mutate(YPTJOB = case_when(FTPTWK == "Full-time" ~ "Full-time", TRUE ~  YPTJOB)) %>% 
  filter(YPTJOB %in% c("Full-time", "Could not find full-time job", "Did not want full-time job"))

t_extra_hours2 <- t_extra_hours %>% 
  group_by(year, sequence, quarter, SEX, YPTJOB) %>%
  summarise(median = median(UNDHRS), sd = sd(UNDHRS)) 


```


```{r extra hours line plot, fig.width=8, fig.height=6, fig.fullwidth=TRUE, fig.cap= "Median extra hours wished to work"}


p_more_hours2 <- t_extra_hours2 %>% 
  ggplot() +
  geom_line(aes(x = sequence, y = median, colour = factor(YPTJOB)), size = 0.5, show.legend = FALSE) +  
  geom_point(aes(x = factor(sequence), y = median, colour = factor(YPTJOB)), shape = 15, size = 1, show.legend = TRUE) +
  geom_vline(xintercept = 4.5, color = "#c9c9c9") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "#c9c9c9") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "#c9c9c9") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "#c9c9c9") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "#c9c9c9") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "#c9c9c9") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "#c9c9c9") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "#c9c9c9") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "#c9c9c9") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "#c9c9c9") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "#c9c9c9") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "#c9c9c9") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "#c9c9c9") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "#c9c9c9") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "#c9c9c9") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "#c9c9c9") + # gridline 2021
  facet_wrap(. ~ as_label(SEX), ncol=1, strip.position = "top") +

  # scale and colour
  scale_color_discrete_qualitative(palette = "Harmonic") + # Pastel 1, Dark 2, Dark 3, Set 2, Set 3, Warm, Cold, Harmonic, Dynamic
  scale_y_continuous(breaks = seq(0,25, 5), limits = c(0, 25), expand = c(0,0), sec.axis = dup_axis()) +
  scale_x_discrete(breaks=c(1:68), position = "bottom",
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
  # annotation
  labs(x = "", 
       y = "Hours", 
       title ="Median extra hours wished to work",
       #subtitle  = "Extra hours for those who could not find a full-time job",
       #caption = c("Note: People in employment (employees and self-employed) between 2006 and 2022")
       ) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0, 0), "lines"),
        plot.title = element_text(size = 14, margin = ggplot2::margin(5, 0, 0, 0)),
        plot.subtitle = element_text(size = 12, hjust = 0, margin = ggplot2::margin(5, 0, 15, 0)),
        plot.caption = element_text(size = 10, hjust = 1, margin = ggplot2::margin(2, 0, 2, 0)),
        axis.title.x = element_text(margin = ggplot2::margin(t = 8), size = 12),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 12),
        axis.text.x = element_text(size = 12, margin = margin(t = 2)),
        axis.text.y = element_text(size = 12),
        axis.ticks.length.x = unit(0.1, "cm"),
        axis.text.y.right =  element_text(margin = margin(l = 4)),
        axis.title.y.right = element_blank(),
        legend.position = "top", 
        legend.title = element_blank(),
        strip.text = element_text(size = 14, face="bold", margin = margin(b = 2)),
        strip.background = element_blank(),
        panel.spacing = unit(0.5, "cm"),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(color = "gray90", linewidth = .5)) +
  guides(col = guide_legend(nrow = 1, byrow = TRUE, override.aes = list(size = 5)))

p_more_hours2


```


### Sectoral division 


#### Geographic


#### Industry 




## Indicator 3: Seeking replacement job

### Personal characteristics

#### Men and women


```{r table seeking job, echo=FALSE}

options(digits = 3)

t_seeking <- LFS_clean %>% # summary table
  filter(AGE >= 18 & AGE <= 64) %>% 
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c(1, 2)) %>% #only employees and self-employed
  group_by(year, sequence, quarter, SEX, DIFJOB, ADDJOB) %>% 
  summarise(count = sum(PWT)) %>% 
  group_by(year, sequence, quarter, SEX, DIFJOB) %>% 
  # percentage part-time per quarter
  mutate(percentage = count/sum(count)) %>% 
  filter(!is.na(DIFJOB) & !is.na(ADDJOB)) %>%
  filter(DIFJOB == 1) %>%
  filter(ADDJOB == 1) %>%
  as_label(.)

#t_seeking <-  t_seeking %>% pivot_wider(names_from = SEX, values_from = count)



```


```{r plot seeking job, fig.width=9, fig.height=3, fig.fullwidth=TRUE, fig.cap= ""}

p_seeking <- t_seeking %>% 
  ggplot() + 
  geom_bar(aes(x = sequence, y = count, fill = SEX), stat="identity", position = "dodge", width=0.8) +
  geom_vline(xintercept = 4.5, color = "#c9c9c9") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "#c9c9c9") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "#c9c9c9") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "#c9c9c9") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "#c9c9c9") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "#c9c9c9") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "#c9c9c9") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "#c9c9c9") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "#c9c9c9") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "#c9c9c9") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "#c9c9c9") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "#c9c9c9") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "#c9c9c9") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "#c9c9c9") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "#c9c9c9") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "#c9c9c9") + # gridline 2021

  # scale and colour
  scale_fill_discrete_qualitative(palette = "Dark 3") +
  scale_y_continuous(breaks = seq(0,2000000, 200000), limits = c(0, 2000000), labels = comma, expand = c(0,0), sec.axis = dup_axis()) +
  scale_x_continuous(breaks=c(1:68), position = "bottom", 
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
  # annotation
  labs(x = "Year", 
       y = "Total", 
       title ="Seeking replacement job",
       #subtitle  = "Totals based on people in employment between 2006 and 2022",
       caption = c("")
       ) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0, 0), "lines"),
        plot.title = element_text(size = 14, margin = ggplot2::margin(5, 0, 0, 0)),
        plot.subtitle = element_text(size = 12, hjust = 0, margin = ggplot2::margin(5, 0, 2, 0)),
        plot.caption = element_text(size = 10, hjust = 1, margin = ggplot2::margin(2, 0, 2, 0)),
        axis.title.x = element_text(margin = ggplot2::margin(t = 8), size = 12),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 12),
        axis.text.x = element_text(size = 12, margin = margin(t = 2)),
        axis.text.y = element_text(size = 12),
        axis.text.y.right =  element_text(margin = margin(l = 4)),
        axis.title.y.right = element_blank(),
        axis.ticks.length.x = unit(0.1, "cm"), 
        legend.position = "top", 
        legend.title = element_blank(),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(color = "gray90", linewidth = .5)) +
  guides(col = guide_legend(nrow = 1, byrow = TRUE, override.aes = list(size = 5)))


p_seeking


```


#### Age


#### Ethinicity


#### Education



### Job characteristics

#### Occupational group


## Preferred working hours in the job being looked for


```{r additional job hours}

t_seeking_hours <- LFS_clean %>% 
  filter(AGE >= 18 & AGE <= 64) %>%
  filter(ILODEFR == 1) %>% # only people in employment
  filter(INECAC05 %in% c(1, 2)) %>% #only employees and self-employed
  filter(DIFJOB == 1) %>%
  filter(ADDJOB == 1) %>%
  group_by(year, sequence, quarter, PREFHR) %>% 
  summarise(count = sum(PWT)) %>% 
  group_by(year, sequence, quarter) %>% 
  # percentage part-time per quarter
  mutate(percentage = count/sum(count)) %>% 
  filter(!is.na(PREFHR) & PREFHR %in% c("1", "2", "3")) %>% 
  as_label(.)


```


```{r additional job hours, fig.width=8, fig.height=4, fig.fullwidth=TRUE, fig.cap= "Extra hours wished to work"}


p_seeking_hours <- t_seeking_hours %>% 
  ggplot() + 
  geom_line(aes(x = sequence, y = percentage, colour = factor(PREFHR)), size = 0.5, show.legend = FALSE) +  
  geom_point(aes(x = sequence, y = percentage, colour = factor(PREFHR)), shape = 15, size = 1, show.legend = TRUE) +
  geom_vline(xintercept = 4.5, color = "#c9c9c9") + # gridline 2006
  geom_vline(xintercept = 8.5, color = "#c9c9c9") + # gridline 2007
  geom_vline(xintercept = 12.5, color = "#c9c9c9") + # gridline 2008
  geom_vline(xintercept = 16.5, color = "#c9c9c9") + # gridline 2009
  geom_vline(xintercept = 20.5, color = "#c9c9c9") + # gridline 2010
  geom_vline(xintercept = 24.5, color = "#c9c9c9") + # gridline 2011
  geom_vline(xintercept = 28.5, color = "#c9c9c9") + # gridline 2012
  geom_vline(xintercept = 32.5, color = "#c9c9c9") + # gridline 2013
  geom_vline(xintercept = 36.5, color = "#c9c9c9") + # gridline 2014
  geom_vline(xintercept = 40.5, color = "#c9c9c9") + # gridline 2015
  geom_vline(xintercept = 44.5, color = "#c9c9c9") + # gridline 2016
  geom_vline(xintercept = 48.5, color = "#c9c9c9") + # gridline 2017
  geom_vline(xintercept = 52.5, color = "#c9c9c9") + # gridline 2018
  geom_vline(xintercept = 56.5, color = "#c9c9c9") + # gridline 2019
  geom_vline(xintercept = 60.5, color = "#c9c9c9") + # gridline 2020
  geom_vline(xintercept = 64.5, color = "#c9c9c9") + # gridline 2021
  #facet_wrap(. ~ SEX, ncol=1, strip.position = "top") +
  
  # scale and colour
  scale_color_discrete_qualitative(palette = "Set 2") + # Pastel 1, Dark 2, Dark 3, Set 2, Set 3, Warm, Cold, Harmonic, Dynamic
  scale_y_continuous(breaks = seq(0,1, 0.1), limits = c(0, 1), labels =
                       scales::percent_format(accuracy = 1L), expand = c(0,0), sec.axis = dup_axis()) +
  scale_x_continuous(breaks=c(1:68), position = "bottom",
                     labels=c("","2006","", "", "", "2007", "", "", "", "2008", "", "", "", "2009", "", 
                            "", "", "2010", "", "", "", "2011", "", "", "", "2012", "", "", 
                            "", "2013", "", "", "", "2014", "", "", "", "2015", "", "", "", 
                            "2016", "", "", "", "2017", "", "", "", "2018", "", "", "", "2019", "",
                            "", "", "2020", "", "", "", "2021", "", "", "", "2022", "", ""), expand = c(0,0)) +
  # annotation
  labs(x = "", 
       y = "Percentage", 
       title ="Preferred working hours in new job being looked for",
       #subtitle  = " ",
       caption = c("")
       ) +

  # theme
  theme_economist_white(gray_bg = FALSE, base_family = "Lato") +
  theme(plot.margin = unit(c(0, 0, 0, 0), "lines"),
        plot.title = element_text(size = 14, margin = ggplot2::margin(5, 0, 8, 0)),
        plot.subtitle = element_text(size = 12, hjust = 0, margin = ggplot2::margin(5, 0, 2, 0)),
        plot.caption = element_text(size = 10, hjust = 1, margin = ggplot2::margin(2, 0, 2, 0)),
        axis.title.x = element_text(margin = ggplot2::margin(t = 8), size = 12),
        axis.title.y = element_text(margin = ggplot2::margin(r = 5), size = 12),
        axis.text.x = element_text(size = 12, margin = margin(t = 2)),
        axis.text.y = element_text(size = 12),
        axis.text.y.right =  element_text(margin = margin(l = 4)),
        axis.title.y.right = element_blank(),
        axis.ticks.length.x = unit(0.1, "cm"), 
        legend.position = "top", 
        legend.title = element_blank(),
        legend.text = element_text(size = 12),
        panel.spacing = unit(0.5, "cm"),
        strip.text = element_text(size = 14, face="bold", margin = margin(b = 2)),
        strip.background = element_blank(),
        panel.grid.major = element_line(color = "gray90", linewidth = .5)) +
  guides(col = guide_legend(nrow = 1, byrow = TRUE, override.aes = list(size = 5)))


p_seeking_hours

```


### Sectoral division 


#### Geographic


#### Industry 